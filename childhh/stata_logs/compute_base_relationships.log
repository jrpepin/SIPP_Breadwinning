-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_logs/compute_base_relationships.log
  log type:  text
 opened on:   5 Dec 2019, 19:55:53

. 
. 
. * I would love to turn off line wrap so the state is a single
. * continuous string.  This seems not to be possible.  The best
. * we can do is set the line length to 255.  That's about 20 times
. * too short so why bother.
. *
. * Also, I considered saving the state as a note in the dataset
. * but this generic do file can't assume there is a dataset at all.
. display "Starting random number generator state"
Starting random number generator state

. display "`c(rngstate)'"
XAA0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 000000000000000000000000000000000000000000000000000000000000000000000001000001391839

. 
. 
. set varabbrev off

. 
. macro list
S_FNDATE:        5 Dec 2019 19:55
S_FN:           C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/demo_long_interviews.dta
ReS_Call:       version 15.1:
max_tc:         1
refmon:         4
adult_age:      18
penultimate_wave:
                14
second_wave:    2
final_wave:     15
first_wave:     1
replace:        replace
SIPP08keep:     C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/SIPP08_Processed
tempdir:        C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp
results:        C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//results
sipp2008_logs:  C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_logs
sipp2008_code:  C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//SIPP2008
childhh_base_code:
                C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh/
SIPP2008:       C:\Users\Joanna/Dropbox/Data/SIPP/SIPP2008
homedir:        C:\Users\Joanna
S_level:        95
F1:             help advice;
F2:             describe;
F7:             save
F8:             use
S_ADO:          BASE;SITE;.;PERSONAL;PLUS;OLDPLACE
S_StataMP:      MP
S_StataSE:      SE
S_FLAVOR:       Intercooled
S_OS:           Windows
S_OSDTL:        64-bit
S_MACH:         PC (64-bit x86-64)
_fname:         compute_base_relationships
_logdir:        C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_logs
_2:             compute_base_relationships
_1:             C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_logs
_0:             "C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_logs" "compute_base_relationships"

. 
. pwd
C:\Users\Joanna\Dropbox\Repositories\SIPP_Breadwinning\childhh

. 
end of do-file

. 
. 
. do "`codedir'/`fname'"

. //========================================================================================================//
. //===== Children's Household Instability Project                                     
. //===== Dataset: SIPP2008                                                            
. //===== Purpose: Compute relationships of ego to other household members using epnmom, epndad, epnspouse and errp 
. //========================================================================================================//
. 
. ********************************************************************************
. * Section: Start by creating programs to process data
. ********************************************************************************
. 
. ** Program to create process data from all waves and save a record for EGO and coresident (bio/step/adoptive mother/father) 
. ** Each relationship type is saved in a different file.
. ** The program also creates inverse relationships (i.e. relationships of other people to ego). 
. 
. capture program drop compute_relationships

. program define compute_relationships
  1.     args person1 person2 relationship_1_2 relationship_2_1 reason condition filename_1_2 filename_2_1 /* local macro */
  2. 
.     preserve
  3.     gen relfrom = `person1' if `condition'
  4.     gen relto = `person2' if `condition'
  5.     gen relationship_tc0 = "`relationship_1_2'":relationship if `condition'
  6.     label values relationship_tc0 relationship
  7.     gen reason_tc0 = "`reason'" if `condition'
  8.     tab relationship_tc0 swave
  9.     keep ssuid shhadid swave relfrom relto relationship_tc0 reason_tc0
 10.     drop if missing(relationship_tc0)
 11.     drop if (relfrom == relto)
 12.     save "$tempdir/`filename_1_2'", $replace
 13.     restore
 14. 
.     preserve
 15.     gen relfrom = `person2' if `condition'
 16.     gen relto = `person1' if `condition'
 17.     gen relationship_tc0 = "`relationship_2_1'":relationship if `condition'
 18.     label values relationship_tc0 relationship
 19.     gen reason_tc0 = "`reason'" if `condition'
 20.     tab relationship_tc0 swave
 21.     keep ssuid shhadid swave relfrom relto relationship_tc0 reason_tc0
 22.     drop if missing(relationship_tc0)
 23.     drop if (relfrom == relto)
 24.     save "$tempdir/`filename_2_1'", $replace
 25.     restore
 26. end

. 
. ** Program to fix conflicting relationship pairs, taking the first as preferable to the second. Conflicting relationships are
. ** possible when relationship identified with the parent pointer is not the same as the relationship identified with the
. ** relationship to householder variable. 
. 
. capture program drop fixup_rel_pair

. program define fixup_rel_pair
  1.     args preferred_rel second_rel /*local macro, the first relationship is preferred */
  2. 
.     display "Preferring `preferred_rel' over `second_rel'"
  3.     
.     gen meets_condition = (((relationship_tc01 == "`preferred_rel'":relationship) & (relationship_tc02 == "`second_rel'":relationship)) | ((relationship_tc02 == "`preferred_rel'":relationship) & (r
> elationship_tc01 == "`second_rel'":relationship)))
  4.     gen needs_swap = ((relationship_tc02 == "`preferred_rel'":relationship) & (relationship_tc01 == "`second_rel'":relationship))
  5. 
.     replace numrels_tc0 = 1 if (meets_condition == 1)
  6.     replace relationship_tc01 = "`preferred_rel'":relationship if ((meets_condition == 1) & (needs_swap == 1))
  7.     replace relationship_tc02 = . if (meets_condition == 1)
  8.     replace reason_tc01 = reason_tc02 if ((meets_condition == 1) & (needs_swap == 1))
  9.     replace reason_tc02 = "" if (meets_condition == 1)
 10. 
.     drop meets_condition needs_swap
 11. end

. 
. ********************************************************************************
. * Read in and label data
. use "$tempdir/allwaves"

. 
. do "$sipp2008_code/relationship_label"

. 
. *** This builds a label for relationships (the most complicated form).
. * It numbers the labels starting at 1, incrementing by 1.
. * You can look at the output of the "label list" in the log to see what number means what.
. local lnum = 1

. local llist ""

. foreach r in biochild biomom biodad stepchild stepmom stepdad adoptchild adoptmom adoptdad mom dad spouse grandchild grandchild_p grandparent grandparent_p sibling partner childofpartner f_child ch
> ild f_parent parent auntuncle auntuncle_or_parent parent_or_relative greatgrandchild greatgrandparent nephewniece child_or_nephewniece child_or_relative cousin sibling_or_cousin f_sib other_rel oth
> er_rel_p norel  foster confused dontknow {
  2.     local llist = `"`llist' `lnum' "`r'""'
  3.     local lnum = `lnum' + 1
  4. }

. label define relationship `llist'

. display "String for relationship label"
String for relationship label

. display `"`llist'"'
 1 "biochild" 2 "biomom" 3 "biodad" 4 "stepchild" 5 "stepmom" 6 "stepdad" 7 "adoptchild" 8 "adoptmom" 9 "adoptdad" 10 "mom" 11 "dad" 12 "spouse" 13 "grandchild" 14 "grandchild_p" 15 "grandparent" 16 
> "grandparent_p" 17 "sibling" 18 "partner" 19 "childofpartner" 20 "f_child" 21 "child" 22 "f_parent" 23 "parent" 24 "auntuncle" 25 "auntuncle_or_parent" 26 "parent_or_relative" 27 "greatgrandchild" 
> 28 "greatgrandparent" 29 "nephewniece" 30 "child_or_nephewniece" 31 "child_or_relative" 32 "cousin" 33 "sibling_or_cousin" 34 "f_sib" 35 "other_rel" 36 "other_rel_p" 37 "norel" 38 "foster" 39 "conf
> used" 40 "dontknow"

. display "Label for relationships"
Label for relationships

. label list relationship
relationship:
           1 biochild
           2 biomom
           3 biodad
           4 stepchild
           5 stepmom
           6 stepdad
           7 adoptchild
           8 adoptmom
           9 adoptdad
          10 mom
          11 dad
          12 spouse
          13 grandchild
          14 grandchild_p
          15 grandparent
          16 grandparent_p
          17 sibling
          18 partner
          19 childofpartner
          20 f_child
          21 child
          22 f_parent
          23 parent
          24 auntuncle
          25 auntuncle_or_parent
          26 parent_or_relative
          27 greatgrandchild
          28 greatgrandparent
          29 nephewniece
          30 child_or_nephewniece
          31 child_or_relative
          32 cousin
          33 sibling_or_cousin
          34 f_sib
          35 other_rel
          36 other_rel_p
          37 norel
          38 foster
          39 confused
          40 dontknow

. 
end of do-file

. ********************************************************************************
. 
. * A small number of cases identified themselves as their own mother, father, or spouse
. destring epppnum, generate(epppnum_n)
epppnum: all characters numeric; epppnum_n generated as int

. drop epppnum

. rename epppnum_n epppnum

. 
. replace epnmom=.   if epppnum==epnmom
(2 real changes made, 2 to missing)

. replace epndad=.   if epppnum==epndad
(12 real changes made, 12 to missing)

. replace epnspous=. if epppnum==epnspous
(0 real changes made)

. 
. ********************************************************************************
. ** Section: Process parent/child relationships from epnmom, epndad, and epnspous.
. **
. ** Use Program: compute_relationships
. **        args: person1 person2 relationship_1_2 relationship_2_1 reason condition filename_1_2 filename_2_1
. ********************************************************************************
. compute_relationships epppnum epnmom biochild biomom epnmom "((!missing(epnmom)) & (epnmom != 9999) & (etypmom == 1))" biochild_of_mom biomom
(892,258 missing values generated)
(892,258 missing values generated)
(892,258 missing values generated)
(892,258 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
            biochild |    31,786     29,687     28,835     27,436     27,390     26,726     25,836     25,653     25,013     24,080     23,695     23,414     22,983     22,728     21,951 |   387,213 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    31,786     29,687     28,835     27,436     27,390     26,726     25,836     25,653     25,013     24,080     23,695     23,414     22,983     22,728     21,951 |   387,213 
(892,258 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/biochild_of_mom.dta saved
(892,258 missing values generated)
(892,258 missing values generated)
(892,258 missing values generated)
(892,258 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
              biomom |    31,786     29,687     28,835     27,436     27,390     26,726     25,836     25,653     25,013     24,080     23,695     23,414     22,983     22,728     21,951 |   387,213 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    31,786     29,687     28,835     27,436     27,390     26,726     25,836     25,653     25,013     24,080     23,695     23,414     22,983     22,728     21,951 |   387,213 
(892,258 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/biomom.dta saved

. compute_relationships epppnum epndad biochild biodad epndad "((!missing(epndad)) & (epndad != 9999) & (etypdad == 1))" biochild_of_dad biodad
(1,005,195 missing values generated)
(1,005,195 missing values generated)
(1,005,195 missing values generated)
(1,005,195 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
            biochild |    22,217     20,905     20,381     19,417     19,265     18,809     18,346     18,176     17,709     17,114     16,898     16,691     16,380     16,199     15,769 |   274,276 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    22,217     20,905     20,381     19,417     19,265     18,809     18,346     18,176     17,709     17,114     16,898     16,691     16,380     16,199     15,769 |   274,276 
(1,005,195 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/biochild_of_dad.dta saved
(1,005,195 missing values generated)
(1,005,195 missing values generated)
(1,005,195 missing values generated)
(1,005,195 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
              biodad |    22,217     20,905     20,381     19,417     19,265     18,809     18,346     18,176     17,709     17,114     16,898     16,691     16,380     16,199     15,769 |   274,276 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    22,217     20,905     20,381     19,417     19,265     18,809     18,346     18,176     17,709     17,114     16,898     16,691     16,380     16,199     15,769 |   274,276 
(1,005,195 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/biodad.dta saved

. compute_relationships epppnum epnmom stepchild stepmom epnmom "((!missing(epnmom)) & (epnmom != 9999) & (etypmom == 2))" stepchild_of_mom stepmom
(1,262,777 missing values generated)
(1,262,777 missing values generated)
(1,262,777 missing values generated)
(1,262,777 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
           stepchild |     1,255      1,215      1,157      1,154      1,140      1,112      1,104      1,094      1,111      1,067      1,081      1,076      1,086      1,053        989 |    16,694 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     1,255      1,215      1,157      1,154      1,140      1,112      1,104      1,094      1,111      1,067      1,081      1,076      1,086      1,053        989 |    16,694 
(1,262,777 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/stepchild_of_mom.dta saved
(1,262,777 missing values generated)
(1,262,777 missing values generated)
(1,262,777 missing values generated)
(1,262,777 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
             stepmom |     1,255      1,215      1,157      1,154      1,140      1,112      1,104      1,094      1,111      1,067      1,081      1,076      1,086      1,053        989 |    16,694 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     1,255      1,215      1,157      1,154      1,140      1,112      1,104      1,094      1,111      1,067      1,081      1,076      1,086      1,053        989 |    16,694 
(1,262,777 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/stepmom.dta saved

. compute_relationships epppnum epndad stepchild stepdad epndad "((!missing(epndad)) & (epndad != 9999) & (etypdad == 2))" stepchild_of_dad stepdad
(1,249,090 missing values generated)
(1,249,090 missing values generated)
(1,249,090 missing values generated)
(1,249,090 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
           stepchild |     2,484      2,332      2,275      2,152      2,116      2,118      2,048      2,010      1,994      1,897      1,881      1,858      1,799      1,707      1,710 |    30,381 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     2,484      2,332      2,275      2,152      2,116      2,118      2,048      2,010      1,994      1,897      1,881      1,858      1,799      1,707      1,710 |    30,381 
(1,249,090 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/stepchild_of_dad.dta saved
(1,249,090 missing values generated)
(1,249,090 missing values generated)
(1,249,090 missing values generated)
(1,249,090 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
             stepdad |     2,484      2,332      2,275      2,152      2,116      2,118      2,048      2,010      1,994      1,897      1,881      1,858      1,799      1,707      1,710 |    30,381 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     2,484      2,332      2,275      2,152      2,116      2,118      2,048      2,010      1,994      1,897      1,881      1,858      1,799      1,707      1,710 |    30,381 
(1,249,090 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/stepdad.dta saved

. compute_relationships epppnum epnmom adoptchild adoptmom epnmom "((!missing(epnmom)) & (epnmom != 9999) & (etypmom == 3))" adoptchild_of_mom adoptmom
(1,272,731 missing values generated)
(1,272,731 missing values generated)
(1,272,731 missing values generated)
(1,272,731 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
          adoptchild |       577        539        525        496        484        468        442        445        426        409        391        389        390        384        375 |     6,740 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       577        539        525        496        484        468        442        445        426        409        391        389        390        384        375 |     6,740 
(1,272,731 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/adoptchild_of_mom.dta saved
(1,272,731 missing values generated)
(1,272,731 missing values generated)
(1,272,731 missing values generated)
(1,272,731 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
            adoptmom |       577        539        525        496        484        468        442        445        426        409        391        389        390        384        375 |     6,740 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       577        539        525        496        484        468        442        445        426        409        391        389        390        384        375 |     6,740 
(1,272,731 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/adoptmom.dta saved

. compute_relationships epppnum epndad adoptchild adoptdad epndad "((!missing(epndad)) & (epndad != 9999) & (etypdad == 3))" adoptchild_of_dad adoptdad
(1,273,223 missing values generated)
(1,273,223 missing values generated)
(1,273,223 missing values generated)
(1,273,223 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
          adoptchild |       540        506        497        464        463        441        414        417        397        373        360        357        347        341        331 |     6,248 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       540        506        497        464        463        441        414        417        397        373        360        357        347        341        331 |     6,248 
(1,273,223 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/adoptchild_of_dad.dta saved
(1,273,223 missing values generated)
(1,273,223 missing values generated)
(1,273,223 missing values generated)
(1,273,223 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
            adoptdad |       540        506        497        464        463        441        414        417        397        373        360        357        347        341        331 |     6,248 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       540        506        497        464        463        441        414        417        397        373        360        357        347        341        331 |     6,248 
(1,273,223 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/adoptdad.dta saved

. compute_relationships epppnum epnspous spouse spouse epnspous "((!missing(epnspous)) & (epnspous != 9999) & (esex == 1))" epnspous1 epnspous2 
(1,021,318 missing values generated)
(1,021,318 missing values generated)
(1,021,318 missing values generated)
(1,021,318 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
              spouse |    21,420     20,028     19,342     18,552     18,267     17,699     17,255     16,940     16,491     16,013     15,690     15,521     15,284     15,028     14,623 |   258,153 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    21,420     20,028     19,342     18,552     18,267     17,699     17,255     16,940     16,491     16,013     15,690     15,521     15,284     15,028     14,623 |   258,153 
(1,021,318 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/epnspous1.dta saved
(1,021,318 missing values generated)
(1,021,318 missing values generated)
(1,021,318 missing values generated)
(1,021,318 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
              spouse |    21,420     20,028     19,342     18,552     18,267     17,699     17,255     16,940     16,491     16,013     15,690     15,521     15,284     15,028     14,623 |   258,153 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    21,420     20,028     19,342     18,552     18,267     17,699     17,255     16,940     16,491     16,013     15,690     15,521     15,284     15,028     14,623 |   258,153 
(1,021,318 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/epnspous2.dta saved

. 
. ********************************************************************************
. ** Section: Merge in errp, a variable indicating the reference person for the household.
. **          ref_person_long was created with make_auxiliary_datasets
. ********************************************************************************
. 
. merge m:1 ssuid shhadid swave using "$tempdir/ref_person_long"
(label esex already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                         1,279,471  (_merge==3)
    -----------------------------------------

. assert missing(ref_person) if (_merge == 2)
(null assertion)

. drop if (_merge == 2)
(0 observations deleted)

. assert (_merge == 3)

. drop _merge

. ********************************************************************************
. 
. 
. ********************************************************************************
. ** Section: Generate records for spouse, child, grandchild, parent, sibling, 
. **          others, foster child, partener, no relation based errp. 
. ** Note: The 1 and 2 suffixes below are convenient but not very descriptive.
. **        1 means the relationship as stated; 2 means the reverse.  
. **        E.g., errp_child_of_mom2 are moms of children identified by errp == 4.
. **
. ** Use Program: compute_relationships
. **        args: person1 person2 relationship_1_2 relationship_2_1 reason condition filename_1_2 filename_2_1
. ***********************************************************************************************************************
. destring ref_person, generate(ref_person_n)
ref_person: all characters numeric; ref_person_n generated as int

. drop ref_person

. rename ref_person_n ref_person

. 
. * Spouse of reference person.
. compute_relationships epppnum ref_person spouse spouse errp_3 "(errp == 3)" errp_spouse1 errp_spouse2
(1,028,443 missing values generated)
(1,028,443 missing values generated)
(1,028,443 missing values generated)
(1,028,443 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
              spouse |    20,898     19,511     18,837     18,052     17,753     17,184     16,747     16,462     16,020     15,534     15,231     15,087     14,865     14,625     14,222 |   251,028 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    20,898     19,511     18,837     18,052     17,753     17,184     16,747     16,462     16,020     15,534     15,231     15,087     14,865     14,625     14,222 |   251,028 
(1,028,443 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_spouse1.dta saved
(1,028,443 missing values generated)
(1,028,443 missing values generated)
(1,028,443 missing values generated)
(1,028,443 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
              spouse |    20,898     19,511     18,837     18,052     17,753     17,184     16,747     16,462     16,020     15,534     15,231     15,087     14,865     14,625     14,222 |   251,028 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    20,898     19,511     18,837     18,052     17,753     17,184     16,747     16,462     16,020     15,534     15,231     15,087     14,865     14,625     14,222 |   251,028 
(1,028,443 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_spouse2.dta saved

. 
. * Child of reference person.  You'd expect epnmom/dad to capture this, too.
. compute_relationships epppnum ref_person child mom errp_4 "((errp == 4) & (ref_person_sex == 2))" errp_child_of_mom1 errp_child_of_mom2
(1,052,804 missing values generated)
(1,052,804 missing values generated)
(1,052,804 missing values generated)
(1,052,804 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               child |    18,854     17,659     17,009     16,120     16,047     15,625     15,013     14,992     14,628     13,957     13,749     13,565     13,459     13,269     12,721 |   226,667 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    18,854     17,659     17,009     16,120     16,047     15,625     15,013     14,992     14,628     13,957     13,749     13,565     13,459     13,269     12,721 |   226,667 
(1,052,804 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_child_of_mom1.dta saved
(1,052,804 missing values generated)
(1,052,804 missing values generated)
(1,052,804 missing values generated)
(1,052,804 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
                 mom |    18,854     17,659     17,009     16,120     16,047     15,625     15,013     14,992     14,628     13,957     13,749     13,565     13,459     13,269     12,721 |   226,667 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    18,854     17,659     17,009     16,120     16,047     15,625     15,013     14,992     14,628     13,957     13,749     13,565     13,459     13,269     12,721 |   226,667 
(1,052,804 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_child_of_mom2.dta saved

. compute_relationships epppnum ref_person child dad errp_4 "((errp == 4) & (ref_person_sex == 1))" errp_child_of_dad1 errp_child_of_dad2
(1,114,765 missing values generated)
(1,114,765 missing values generated)
(1,114,765 missing values generated)
(1,114,765 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               child |    13,198     12,364     12,202     11,584     11,488     11,275     11,067     10,958     10,664     10,316     10,218     10,147      9,902      9,774      9,549 |   164,706 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    13,198     12,364     12,202     11,584     11,488     11,275     11,067     10,958     10,664     10,316     10,218     10,147      9,902      9,774      9,549 |   164,706 
(1,114,765 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_child_of_dad1.dta saved
(1,114,765 missing values generated)
(1,114,765 missing values generated)
(1,114,765 missing values generated)
(1,114,765 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
                 dad |    13,198     12,364     12,202     11,584     11,488     11,275     11,067     10,958     10,664     10,316     10,218     10,147      9,902      9,774      9,549 |   164,706 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    13,198     12,364     12,202     11,584     11,488     11,275     11,067     10,958     10,664     10,316     10,218     10,147      9,902      9,774      9,549 |   164,706 
(1,114,765 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_child_of_dad2.dta saved

. 
. * Grandchild of reference person.
. compute_relationships epppnum ref_person grandchild grandparent errp_5 "(errp == 5)" errp_grandchild1 errp_grandchild2
(1,248,290 missing values generated)
(1,248,290 missing values generated)
(1,248,290 missing values generated)
(1,248,290 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
          grandchild |     2,147      2,131      2,112      2,137      2,213      2,135      2,094      2,025      2,068      2,047      2,048      2,018      2,060      2,050      1,896 |    31,181 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     2,147      2,131      2,112      2,137      2,213      2,135      2,094      2,025      2,068      2,047      2,048      2,018      2,060      2,050      1,896 |    31,181 
(1,248,290 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_grandchild1.dta saved
(1,248,290 missing values generated)
(1,248,290 missing values generated)
(1,248,290 missing values generated)
(1,248,290 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
         grandparent |     2,147      2,131      2,112      2,137      2,213      2,135      2,094      2,025      2,068      2,047      2,048      2,018      2,060      2,050      1,896 |    31,181 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     2,147      2,131      2,112      2,137      2,213      2,135      2,094      2,025      2,068      2,047      2,048      2,018      2,060      2,050      1,896 |    31,181 
(1,248,290 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_grandchild2.dta saved

. 
. * Parent of reference person.
. compute_relationships epppnum ref_person mom child errp_6 "((errp == 6) & (esex == 2))" errp_mom1 errp_mom2
(1,270,903 missing values generated)
(1,270,903 missing values generated)
(1,270,903 missing values generated)
(1,270,903 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
                 mom |       686        642        606        589        591        614        568        566        557        542        529        535        525        509        509 |     8,568 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       686        642        606        589        591        614        568        566        557        542        529        535        525        509        509 |     8,568 
(1,270,903 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_mom1.dta saved
(1,270,903 missing values generated)
(1,270,903 missing values generated)
(1,270,903 missing values generated)
(1,270,903 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               child |       686        642        606        589        591        614        568        566        557        542        529        535        525        509        509 |     8,568 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       686        642        606        589        591        614        568        566        557        542        529        535        525        509        509 |     8,568 
(1,270,903 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_mom2.dta saved

. compute_relationships epppnum ref_person dad child errp_6 "((errp == 6) & (esex == 1))" errp_dad1 errp_dad2
(1,276,449 missing values generated)
(1,276,449 missing values generated)
(1,276,449 missing values generated)
(1,276,449 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
                 dad |       241        222        217        206        217        235        223        200        202        188        193        173        170        168        167 |     3,022 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       241        222        217        206        217        235        223        200        202        188        193        173        170        168        167 |     3,022 
(1,276,449 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_dad1.dta saved
(1,276,449 missing values generated)
(1,276,449 missing values generated)
(1,276,449 missing values generated)
(1,276,449 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               child |       241        222        217        206        217        235        223        200        202        188        193        173        170        168        167 |     3,022 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       241        222        217        206        217        235        223        200        202        188        193        173        170        168        167 |     3,022 
(1,276,449 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_dad2.dta saved

. 
. * Sibling of reference person.
. compute_relationships epppnum ref_person sibling sibling errp_7 "(errp == 7)" errp_sibling1 errp_sibling2
(1,268,490 missing values generated)
(1,268,490 missing values generated)
(1,268,490 missing values generated)
(1,268,490 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
             sibling |       889        846        819        801        776        822        766        744        714        688        660        628        595        607        626 |    10,981 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       889        846        819        801        776        822        766        744        714        688        660        628        595        607        626 |    10,981 
(1,268,490 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_sibling1.dta saved
(1,268,490 missing values generated)
(1,268,490 missing values generated)
(1,268,490 missing values generated)
(1,268,490 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
             sibling |       889        846        819        801        776        822        766        744        714        688        660        628        595        607        626 |    10,981 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       889        846        819        801        776        822        766        744        714        688        660        628        595        607        626 |    10,981 
(1,268,490 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_sibling2.dta saved

. 
. * Other relative.
. compute_relationships epppnum ref_person other_rel other_rel errp_8 "(errp == 8)" errp_otherrel1 errp_otherrel2
(1,254,343 missing values generated)
(1,254,343 missing values generated)
(1,254,343 missing values generated)
(1,254,343 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
           other_rel |     1,867      1,920      1,844      1,836      1,798      1,793      1,719      1,682      1,602      1,612      1,554      1,547      1,510      1,449      1,395 |    25,128 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     1,867      1,920      1,844      1,836      1,798      1,793      1,719      1,682      1,602      1,612      1,554      1,547      1,510      1,449      1,395 |    25,128 
(1,254,343 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_otherrel1.dta saved
(1,254,343 missing values generated)
(1,254,343 missing values generated)
(1,254,343 missing values generated)
(1,254,343 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
           other_rel |     1,867      1,920      1,844      1,836      1,798      1,793      1,719      1,682      1,602      1,612      1,554      1,547      1,510      1,449      1,395 |    25,128 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     1,867      1,920      1,844      1,836      1,798      1,793      1,719      1,682      1,602      1,612      1,554      1,547      1,510      1,449      1,395 |    25,128 
(1,254,343 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_otherrel2.dta saved

. 
. * Foster child.
. compute_relationships epppnum ref_person f_child f_parent errp_9 "(errp == 9)" errp_fosterchild1 errp_fosterchild2
(1,277,948 missing values generated)
(1,277,948 missing values generated)
(1,277,948 missing values generated)
(1,277,948 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
             f_child |       122        110        106        109        109        113        107        108        107         88         97         92         87         87         81 |     1,523 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       122        110        106        109        109        113        107        108        107         88         97         92         87         87         81 |     1,523 
(1,277,948 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_fosterchild1.dta saved
(1,277,948 missing values generated)
(1,277,948 missing values generated)
(1,277,948 missing values generated)
(1,277,948 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
            f_parent |       122        110        106        109        109        113        107        108        107         88         97         92         87         87         81 |     1,523 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       122        110        106        109        109        113        107        108        107         88         97         92         87         87         81 |     1,523 
(1,277,948 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_fosterchild2.dta saved

. 
. * Partner of reference person.
. compute_relationships epppnum ref_person partner partner errp_10 "(errp == 10)" errp_partner1 errp_partner2
(1,255,873 missing values generated)
(1,255,873 missing values generated)
(1,255,873 missing values generated)
(1,255,873 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
             partner |     2,283      2,009      1,891      1,725      1,697      1,642      1,531      1,529      1,485      1,360      1,352      1,333      1,280      1,291      1,190 |    23,598 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     2,283      2,009      1,891      1,725      1,697      1,642      1,531      1,529      1,485      1,360      1,352      1,333      1,280      1,291      1,190 |    23,598 
(1,255,873 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_partner1.dta saved
(1,255,873 missing values generated)
(1,255,873 missing values generated)
(1,255,873 missing values generated)
(1,255,873 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
             partner |     2,283      2,009      1,891      1,725      1,697      1,642      1,531      1,529      1,485      1,360      1,352      1,333      1,280      1,291      1,190 |    23,598 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     2,283      2,009      1,891      1,725      1,697      1,642      1,531      1,529      1,485      1,360      1,352      1,333      1,280      1,291      1,190 |    23,598 
(1,255,873 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_partner2.dta saved

. 
. * No relation.
. compute_relationships epppnum ref_person norel norel errp_ge_11 "((errp == 11) | (errp == 12) | (errp == 13))" errp_norelation1 errp_norelation2
(1,253,280 missing values generated)
(1,253,280 missing values generated)
(1,253,280 missing values generated)
(1,253,280 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               norel |     2,448      2,160      2,026      1,913      1,976      1,876      1,767      1,755      1,689      1,571      1,506      1,491      1,413      1,329      1,271 |    26,191 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     2,448      2,160      2,026      1,913      1,976      1,876      1,767      1,755      1,689      1,571      1,506      1,491      1,413      1,329      1,271 |    26,191 
(1,253,280 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_norelation1.dta saved
(1,253,280 missing values generated)
(1,253,280 missing values generated)
(1,253,280 missing values generated)
(1,253,280 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               norel |     2,448      2,160      2,026      1,913      1,976      1,876      1,767      1,755      1,689      1,571      1,506      1,491      1,413      1,329      1,271 |    26,191 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     2,448      2,160      2,026      1,913      1,976      1,876      1,767      1,755      1,689      1,571      1,506      1,491      1,413      1,329      1,271 |    26,191 
(1,253,280 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_norelation2.dta saved

. 
. clear

. 
. *******************************************************************************
. ** Section: Append all relationship data sets together.
. *******************************************************************************
. use "$tempdir/biochild_of_mom"

. append using "$tempdir/biomom"
(label relationship already defined)

. append using "$tempdir/biochild_of_dad"
(label relationship already defined)

. append using "$tempdir/biodad"
(label relationship already defined)

. append using "$tempdir/stepchild_of_mom"
(label relationship already defined)

. append using "$tempdir/stepmom"
(label relationship already defined)

. append using "$tempdir/stepchild_of_dad"
(label relationship already defined)

. append using "$tempdir/stepdad"
(label relationship already defined)

. append using "$tempdir/adoptchild_of_mom"
(label relationship already defined)

. append using "$tempdir/adoptmom"
(label relationship already defined)

. append using "$tempdir/adoptchild_of_dad"
(label relationship already defined)

. append using "$tempdir/adoptdad"
(label relationship already defined)

. append using "$tempdir/errp_spouse1"
(label relationship already defined)

. append using "$tempdir/errp_spouse2"
(label relationship already defined)

. append using "$tempdir/errp_child_of_mom1"
(label relationship already defined)

. append using "$tempdir/errp_child_of_mom2"
(label relationship already defined)

. append using "$tempdir/errp_child_of_dad1"
(label relationship already defined)

. append using "$tempdir/errp_child_of_dad2"
(label relationship already defined)

. append using "$tempdir/errp_grandchild1"
(label relationship already defined)

. append using "$tempdir/errp_grandchild2"
(label relationship already defined)

. append using "$tempdir/errp_mom1"
(label relationship already defined)

. append using "$tempdir/errp_mom2"
(label relationship already defined)

. append using "$tempdir/errp_dad1"
(label relationship already defined)

. append using "$tempdir/errp_dad2"
(label relationship already defined)

. append using "$tempdir/errp_sibling1"
(label relationship already defined)

. append using "$tempdir/errp_sibling2"
(label relationship already defined)

. append using "$tempdir/errp_otherrel1"
(label relationship already defined)

. append using "$tempdir/errp_otherrel2"
(label relationship already defined)

. append using "$tempdir/errp_fosterchild1"
(label relationship already defined)

. append using "$tempdir/errp_fosterchild2"
(label relationship already defined)

. append using "$tempdir/errp_partner1"
(note: variable reason_tc0 was str6, now str7 to accommodate using data's values)
(label relationship already defined)

. append using "$tempdir/errp_partner2"
(label relationship already defined)

. append using "$tempdir/errp_norelation1"
(note: variable reason_tc0 was str7, now str10 to accommodate using data's values)
(label relationship already defined)

. append using "$tempdir/errp_norelation2"
(label relationship already defined)

. append using "$tempdir/epnspous1"
(label relationship already defined)

. append using "$tempdir/epnspous2"
(label relationship already defined)

. 
. 
. * Force drop when we have more than one reason for the SAME relationship 
. duplicates drop ssuid shhadid swave relfrom relto relationship_tc0, force

Duplicates in terms of ssuid shhadid swave relfrom relto relationship_tc0

(502,056 observations deleted)

. 
. save "$tempdir/relationships_tc0_all", $replace
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/relationships_tc0_all.dta saved

. 
. ********************************************************************************
. ** Section: Find pairs for which we have more than one relationship type in a single wave.
. **           Select the more specific one
. ********************************************************************************
. sort ssuid shhadid swave relfrom relto

. by ssuid shhadid swave relfrom relto:  gen numrels_tc0 = _N /* total number of relationships */

. by ssuid shhadid swave relfrom relto:  gen relnum_tc0 = _n

. 
. assert (numrels_tc0 <= 2)

. 
. *reshape so that we can compare relationships for pairs (within wave) with more than one relationship type
. reshape wide relationship_tc0 reason_tc0, i(ssuid shhadid swave relfrom relto) j(relnum_tc0)
(note: j = 1 2)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                  3.0e+06   -> 2.2e+06
Number of variables                   9   ->      10
j variable (2 values)        relnum_tc0   ->   (dropped)
xij variables:
                       relationship_tc0   ->   relationship_tc01 relationship_tc02
                             reason_tc0   ->   reason_tc01 reason_tc02
-----------------------------------------------------------------------------

. 
. display "Number of relationships in a wave before any fix-ups"
Number of relationships in a wave before any fix-ups

. tab numrels_tc0

numrels_tc0 |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |  1,389,908       63.29       63.29
          2 |    806,316       36.71      100.00
------------+-----------------------------------
      Total |  2,196,224      100.00

. 
. ** Use program: fixup_rel_pair args: args preferred_rel second_rel
. * start with biological parents
. fixup_rel_pair biomom mom
Preferring biomom over mom
(219,801 real changes made)
(87,319 real changes made)
(219,801 real changes made, 219,801 to missing)
(87,319 real changes made)
(219,801 real changes made)

. fixup_rel_pair biodad dad
Preferring biodad over dad
(148,701 real changes made)
(58,782 real changes made)
(148,701 real changes made, 148,701 to missing)
(58,782 real changes made)
(148,701 real changes made)

. fixup_rel_pair biochild child
Preferring biochild over child
(368,502 real changes made)
(146,977 real changes made)
(368,502 real changes made, 368,502 to missing)
(146,977 real changes made)
(368,502 real changes made)

. 
. display "Number of relationships in a wave after bio fixes"
Number of relationships in a wave after bio fixes

. tab numrels_tc0

numrels_tc0 |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |  2,126,912       96.84       96.84
          2 |     69,312        3.16      100.00
------------+-----------------------------------
      Total |  2,196,224      100.00

. 
. * Fix adopt and step. 
. fixup_rel_pair stepmom mom
Preferring stepmom over mom
(11,441 real changes made)
(4,564 real changes made)
(11,441 real changes made, 11,441 to missing)
(4,564 real changes made)
(11,441 real changes made)

. fixup_rel_pair stepdad dad
Preferring stepdad over dad
(15,784 real changes made)
(6,356 real changes made)
(15,784 real changes made, 15,784 to missing)
(6,356 real changes made)
(15,784 real changes made)

. fixup_rel_pair stepchild child
Preferring stepchild over child
(27,225 real changes made)
(10,705 real changes made)
(27,225 real changes made, 27,225 to missing)
(10,705 real changes made)
(27,225 real changes made)

. fixup_rel_pair adoptmom mom
Preferring adoptmom over mom
(3,987 real changes made)
(1,549 real changes made)
(3,987 real changes made, 3,987 to missing)
(1,549 real changes made)
(3,987 real changes made)

. fixup_rel_pair adoptdad dad
Preferring adoptdad over dad
(3,237 real changes made)
(1,289 real changes made)
(3,237 real changes made, 3,237 to missing)
(1,289 real changes made)
(3,237 real changes made)

. fixup_rel_pair adoptchild child
Preferring adoptchild over child
(7,224 real changes made)
(2,932 real changes made)
(7,224 real changes made, 7,224 to missing)
(2,932 real changes made)
(7,224 real changes made)

. 
. display "Number of relationships in a wave after step and adopt fixes"
Number of relationships in a wave after step and adopt fixes

. tab numrels_tc0

numrels_tc0 |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |  2,195,810       99.98       99.98
          2 |        414        0.02      100.00
------------+-----------------------------------
      Total |  2,196,224      100.00

. 
. tab relationship_tc01 relationship_tc02 if (numrels_tc0 > 1)

                     |                                   2 relationship_tc0
  1 relationship_tc0 |  biochild     biomom     biodad  stepchild    stepmom    stepdad     spouse  other_rel |     Total
---------------------+----------------------------------------------------------------------------------------+----------
            biochild |         0          0          0          0          0          3         37         55 |        95 
              biomom |         0          0          0          1          0          0         24         25 |        50 
              biodad |         0          0          0          2          0          0          9         46 |        57 
           stepchild |         0          3          0          0          7          6          1         15 |        32 
             stepmom |         0          0          0          7          0          0          0          1 |         8 
             stepdad |         3          0          0          8          0          0          0         14 |        25 
              spouse |        24         15         13          0          1          0          0          0 |        53 
           other_rel |        52          9         27          3          2          1          0          0 |        94 
---------------------+----------------------------------------------------------------------------------------+----------
               Total |        79         27         40         21         10         10         71        156 |       414 

. 
. * Save a data set with remaining conflicted relationships.
. preserve

. keep if (numrels_tc0 > 1)
(2,195,810 observations deleted)

. save "$tempdir/relationships_tc0_lost", $replace 
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/relationships_tc0_lost.dta saved

. restore

. 
. rename relationship_tc01 relationship

. rename reason_tc01 reason

. 
. drop relationship_tc02 reason_tc02

. 
. replace relationship=. if numrels_tc0 > 1
(414 real changes made, 414 to missing)

. 
. *Despite the name, this file is still long. One record per pair per wave.
. save "$tempdir/relationships_tc0_wide", $replace
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/relationships_tc0_wide.dta saved

. 
. 
. 
. 
end of do-file

. 
. 
. do "$childhh_base_code/childhh_epilog" "`logdir'" "`fname'"

. * Boilerplate epilog for ChildHH project.
. 
. display "Ending random number generator state"
Ending random number generator state

. display "`c(rngstate)'"
XAA0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 000000000000000000000000000000000000000000000000000000000000000000000001000001391839

. log close
      name:  <unnamed>
       log:  C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_logs/compute_base_relationships.log
  log type:  text
 closed on:   5 Dec 2019, 19:59:44
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
