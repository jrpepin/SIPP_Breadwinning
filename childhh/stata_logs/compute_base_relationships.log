-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_logs/compute_base_relationships.log
  log type:  text
 opened on:   5 Dec 2019, 16:26:39

. 
. 
. * I would love to turn off line wrap so the state is a single
. * continuous string.  This seems not to be possible.  The best
. * we can do is set the line length to 255.  That's about 20 times
. * too short so why bother.
. *
. * Also, I considered saving the state as a note in the dataset
. * but this generic do file can't assume there is a dataset at all.
. display "Starting random number generator state"
Starting random number generator state

. display "`c(rngstate)'"
XAA0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 000000000000000000000000000000000000000000000000000000000000000000000001000001391839

. 
. 
. set varabbrev off

. 
. macro list
S_FNDATE:        5 Dec 2019 16:26
S_FN:           C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/demo_long_interviews.dta
ReS_Call:       version 15.1:
max_tc:         1
refmon:         4
adult_age:      18
penultimate_wave:
                14
second_wave:    2
final_wave:     15
first_wave:     1
replace:        replace
SIPP08keep:     C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/SIPP08_Processed
tempdir:        C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp
results:        C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//results
sipp2008_logs:  C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_logs
sipp2008_code:  C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//SIPP2008
childhh_base_code:
                C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh/
SIPP2008:       C:\Users\Joanna/Dropbox/Data/SIPP/SIPP2008
homedir:        C:\Users\Joanna
S_level:        95
F1:             help advice;
F2:             describe;
F7:             save
F8:             use
S_ADO:          BASE;SITE;.;PERSONAL;PLUS;OLDPLACE
S_StataMP:      MP
S_StataSE:      SE
S_FLAVOR:       Intercooled
S_OS:           Windows
S_OSDTL:        64-bit
S_MACH:         PC (64-bit x86-64)
_fname:         compute_base_relationships
_logdir:        C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_logs
_2:             compute_base_relationships
_1:             C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_logs
_0:             "C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_logs" "compute_base_relationships"

. 
. pwd
C:\Users\Joanna\Dropbox\Repositories\SIPP_Breadwinning\childhh

. 
end of do-file

. 
. 
. do "`codedir'/`fname'"

. //========================================================================================================//
. //===== Children's Household Instability Project                                     
. //===== Dataset: SIPP2008                                                            
. //===== Purpose: Compute relationships of ego to other household members using epnmom, epndad, epnspouse and errp 
. //========================================================================================================//
. 
. ********************************************************************************
. * Section: Start by creating programs to process data
. ********************************************************************************
. 
. ** Program to create process data from all waves and save a record for EGO and coresident (bio/step/adoptive mother/father) 
. ** Each relationship type is saved in a different file.
. ** The program also creates inverse relationships (i.e. relationships of other people to ego). 
. 
. capture program drop compute_relationships

. program define compute_relationships
  1.     args person1 person2 relationship_1_2 relationship_2_1 reason condition filename_1_2 filename_2_1 /* local macro */
  2. 
.     preserve
  3.     gen relfrom = `person1' if `condition'
  4.     gen relto = `person2' if `condition'
  5.     gen relationship_tc0 = "`relationship_1_2'":relationship if `condition'
  6.     label values relationship_tc0 relationship
  7.     gen reason_tc0 = "`reason'" if `condition'
  8.     tab relationship_tc0 swave
  9.     keep ssuid shhadid swave relfrom relto relationship_tc0 reason_tc0
 10.     drop if missing(relationship_tc0)
 11.     drop if (relfrom == relto)
 12.     save "$tempdir/`filename_1_2'", $replace
 13.     restore
 14. 
.     preserve
 15.     gen relfrom = `person2' if `condition'
 16.     gen relto = `person1' if `condition'
 17.     gen relationship_tc0 = "`relationship_2_1'":relationship if `condition'
 18.     label values relationship_tc0 relationship
 19.     gen reason_tc0 = "`reason'" if `condition'
 20.     tab relationship_tc0 swave
 21.     keep ssuid shhadid swave relfrom relto relationship_tc0 reason_tc0
 22.     drop if missing(relationship_tc0)
 23.     drop if (relfrom == relto)
 24.     save "$tempdir/`filename_2_1'", $replace
 25.     restore
 26. end

. 
. ** Program to fix conflicting relationship pairs, taking the first as preferable to the second. Conflicting relationships are
. ** possible when relationship identified with the parent pointer is not the same as the relationship identified with the
. ** relationship to householder variable. 
. 
. capture program drop fixup_rel_pair

. program define fixup_rel_pair
  1.     args preferred_rel second_rel /*local macro, the first relationship is preferred */
  2. 
.     display "Preferring `preferred_rel' over `second_rel'"
  3.     
.     gen meets_condition = (((relationship_tc01 == "`preferred_rel'":relationship) & (relationship_tc02 == "`second_rel'":relationship)) | ((relationship_tc02 == "`preferred_rel'":relationship) & (r
> elationship_tc01 == "`second_rel'":relationship)))
  4.     gen needs_swap = ((relationship_tc02 == "`preferred_rel'":relationship) & (relationship_tc01 == "`second_rel'":relationship))
  5. 
.     replace numrels_tc0 = 1 if (meets_condition == 1)
  6.     replace relationship_tc01 = "`preferred_rel'":relationship if ((meets_condition == 1) & (needs_swap == 1))
  7.     replace relationship_tc02 = . if (meets_condition == 1)
  8.     replace reason_tc01 = reason_tc02 if ((meets_condition == 1) & (needs_swap == 1))
  9.     replace reason_tc02 = "" if (meets_condition == 1)
 10. 
.     drop meets_condition needs_swap
 11. end

. 
. ********************************************************************************
. * Read in and label data
. use "$tempdir/allwaves"

. 
. do "$sipp2008_code/relationship_label"

. 
. *** This builds a label for relationships (the most complicated form).
. * It numbers the labels starting at 1, incrementing by 1.
. * You can look at the output of the "label list" in the log to see what number means what.
. local lnum = 1

. local llist ""

. foreach r in BIOCHILD BIOMOM BIODAD STEPCHILD STEPMOM STEPDAD ADOPTCHILD ADOPTMOM ADOPTDAD MOM DAD SPOUSE GRANDCHILD GRANDCHILD_P GRANDPARENT GRANDPARENT_P SIBLING PARTNER CHILDOFPARTNER F_CHILD CH
> ILD F_PARENT PARENT AUNTUNCLE AUNTUNCLE_OR_PARENT PARENT_OR_RELATIVE GREATGRANDCHILD GREATGRANDPARENT NEPHEWNIECE CHILD_OR_NEPHEWNIECE CHILD_OR_RELATIVE COUSIN SIBLING_OR_COUSIN F_SIB OTHER_REL OTH
> ER_REL_P NOREL  FOSTER CONFUSED DONTKNOW {
  2.     local llist = `"`llist' `lnum' "`r'""'
  3.     local lnum = `lnum' + 1
  4. }

. label define relationship `llist'

. display "String for relationship label"
String for relationship label

. display `"`llist'"'
 1 "BIOCHILD" 2 "BIOMOM" 3 "BIODAD" 4 "STEPCHILD" 5 "STEPMOM" 6 "STEPDAD" 7 "ADOPTCHILD" 8 "ADOPTMOM" 9 "ADOPTDAD" 10 "MOM" 11 "DAD" 12 "SPOUSE" 13 "GRANDCHILD" 14 "GRANDCHILD_P" 15 "GRANDPARENT" 16 
> "GRANDPARENT_P" 17 "SIBLING" 18 "PARTNER" 19 "CHILDOFPARTNER" 20 "F_CHILD" 21 "CHILD" 22 "F_PARENT" 23 "PARENT" 24 "AUNTUNCLE" 25 "AUNTUNCLE_OR_PARENT" 26 "PARENT_OR_RELATIVE" 27 "GREATGRANDCHILD" 
> 28 "GREATGRANDPARENT" 29 "NEPHEWNIECE" 30 "CHILD_OR_NEPHEWNIECE" 31 "CHILD_OR_RELATIVE" 32 "COUSIN" 33 "SIBLING_OR_COUSIN" 34 "F_SIB" 35 "OTHER_REL" 36 "OTHER_REL_P" 37 "NOREL" 38 "FOSTER" 39 "CONF
> USED" 40 "DONTKNOW"

. display "Label for relationships"
Label for relationships

. label list relationship
relationship:
           1 BIOCHILD
           2 BIOMOM
           3 BIODAD
           4 STEPCHILD
           5 STEPMOM
           6 STEPDAD
           7 ADOPTCHILD
           8 ADOPTMOM
           9 ADOPTDAD
          10 MOM
          11 DAD
          12 SPOUSE
          13 GRANDCHILD
          14 GRANDCHILD_P
          15 GRANDPARENT
          16 GRANDPARENT_P
          17 SIBLING
          18 PARTNER
          19 CHILDOFPARTNER
          20 F_CHILD
          21 CHILD
          22 F_PARENT
          23 PARENT
          24 AUNTUNCLE
          25 AUNTUNCLE_OR_PARENT
          26 PARENT_OR_RELATIVE
          27 GREATGRANDCHILD
          28 GREATGRANDPARENT
          29 NEPHEWNIECE
          30 CHILD_OR_NEPHEWNIECE
          31 CHILD_OR_RELATIVE
          32 COUSIN
          33 SIBLING_OR_COUSIN
          34 F_SIB
          35 OTHER_REL
          36 OTHER_REL_P
          37 NOREL
          38 FOSTER
          39 CONFUSED
          40 DONTKNOW

. 
end of do-file

. ********************************************************************************
. 
. * A small number of cases identified themselves as their own mother, father, or spouse
. destring epppnum, generate(epppnum_n)
epppnum: all characters numeric; epppnum_n generated as int

. drop epppnum

. rename epppnum_n epppnum

. 
. replace epnmom=.   if epppnum==epnmom
(2 real changes made, 2 to missing)

. replace epndad=.   if epppnum==epndad
(12 real changes made, 12 to missing)

. replace epnspous=. if epppnum==epnspous
(0 real changes made)

. 
. ********************************************************************************
. ** Section: Process parent/child relationships from epnmom, epndad, and epnspous.
. **
. ** Use Program: compute_relationships
. **        args: person1 person2 relationship_1_2 relationship_2_1 reason condition filename_1_2 filename_2_1
. ********************************************************************************
. compute_relationships epppnum epnmom biochild biomom epnmom "((!missing(epnmom)) & (epnmom != 9999) & (etypmom == 1))" biochild_of_mom biomom
(892,258 missing values generated)
(892,258 missing values generated)
(value label dereference "biochild":relationship not found)
(1,279,471 missing values generated)
(892,258 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/biochild_of_mom.dta saved
(892,258 missing values generated)
(892,258 missing values generated)
(value label dereference "biomom":relationship not found)
(1,279,471 missing values generated)
(892,258 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/biomom.dta saved

. compute_relationships epppnum epndad biochild biodad epndad "((!missing(epndad)) & (epndad != 9999) & (etypdad == 1))" biochild_of_dad biodad
(1,005,195 missing values generated)
(1,005,195 missing values generated)
(value label dereference "biochild":relationship not found)
(1,279,471 missing values generated)
(1,005,195 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/biochild_of_dad.dta saved
(1,005,195 missing values generated)
(1,005,195 missing values generated)
(value label dereference "biodad":relationship not found)
(1,279,471 missing values generated)
(1,005,195 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/biodad.dta saved

. compute_relationships epppnum epnmom stepchild stepmom epnmom "((!missing(epnmom)) & (epnmom != 9999) & (etypmom == 2))" stepchild_of_mom stepmom
(1,262,777 missing values generated)
(1,262,777 missing values generated)
(value label dereference "stepchild":relationship not found)
(1,279,471 missing values generated)
(1,262,777 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/stepchild_of_mom.dta saved
(1,262,777 missing values generated)
(1,262,777 missing values generated)
(value label dereference "stepmom":relationship not found)
(1,279,471 missing values generated)
(1,262,777 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/stepmom.dta saved

. compute_relationships epppnum epndad stepchild stepdad epndad "((!missing(epndad)) & (epndad != 9999) & (etypdad == 2))" stepchild_of_dad stepdad
(1,249,090 missing values generated)
(1,249,090 missing values generated)
(value label dereference "stepchild":relationship not found)
(1,279,471 missing values generated)
(1,249,090 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/stepchild_of_dad.dta saved
(1,249,090 missing values generated)
(1,249,090 missing values generated)
(value label dereference "stepdad":relationship not found)
(1,279,471 missing values generated)
(1,249,090 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/stepdad.dta saved

. compute_relationships epppnum epnmom adoptchild adoptmom epnmom "((!missing(epnmom)) & (epnmom != 9999) & (etypmom == 3))" adoptchild_of_mom adoptmom
(1,272,731 missing values generated)
(1,272,731 missing values generated)
(value label dereference "adoptchild":relationship not found)
(1,279,471 missing values generated)
(1,272,731 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/adoptchild_of_mom.dta saved
(1,272,731 missing values generated)
(1,272,731 missing values generated)
(value label dereference "adoptmom":relationship not found)
(1,279,471 missing values generated)
(1,272,731 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/adoptmom.dta saved

. compute_relationships epppnum epndad adoptchild adoptdad epndad "((!missing(epndad)) & (epndad != 9999) & (etypdad == 3))" adoptchild_of_dad adoptdad
(1,273,223 missing values generated)
(1,273,223 missing values generated)
(value label dereference "adoptchild":relationship not found)
(1,279,471 missing values generated)
(1,273,223 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/adoptchild_of_dad.dta saved
(1,273,223 missing values generated)
(1,273,223 missing values generated)
(value label dereference "adoptdad":relationship not found)
(1,279,471 missing values generated)
(1,273,223 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/adoptdad.dta saved

. compute_relationships epppnum epnspous spouse spouse epnspous "((!missing(epnspous)) & (epnspous != 9999) & (esex == 1))" epnspous1 epnspous2 
(1,021,318 missing values generated)
(1,021,318 missing values generated)
(value label dereference "spouse":relationship not found)
(1,279,471 missing values generated)
(1,021,318 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/epnspous1.dta saved
(1,021,318 missing values generated)
(1,021,318 missing values generated)
(value label dereference "spouse":relationship not found)
(1,279,471 missing values generated)
(1,021,318 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/epnspous2.dta saved

. 
. ********************************************************************************
. ** Section: Merge in errp, a variable indicating the reference person for the household.
. **          ref_person_long was created with make_auxiliary_datasets
. ********************************************************************************
. 
. merge m:1 ssuid shhadid swave using "$tempdir/ref_person_long"
(label esex already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                         1,279,471  (_merge==3)
    -----------------------------------------

. assert missing(ref_person) if (_merge == 2)
(null assertion)

. drop if (_merge == 2)
(0 observations deleted)

. assert (_merge == 3)

. drop _merge

. ********************************************************************************
. 
. 
. ********************************************************************************
. ** Section: Generate records for spouse, child, grandchild, parent, sibling, 
. **          others, foster child, partener, no relation based errp. 
. ** Note: The 1 and 2 suffixes below are convenient but not very descriptive.
. **        1 means the relationship as stated; 2 means the reverse.  
. **        E.g., errp_child_of_mom2 are moms of children identified by errp == 4.
. **
. ** Use Program: compute_relationships
. **        args: person1 person2 relationship_1_2 relationship_2_1 reason condition filename_1_2 filename_2_1
. ***********************************************************************************************************************
. 
. * Spouse of reference person.
. compute_relationships epppnum ref_person spouse spouse errp_3 "(errp == 3)" errp_spouse1 errp_spouse2
(1,028,443 missing values generated)
(1,028,443 missing values generated)
(value label dereference "spouse":relationship not found)
(1,279,471 missing values generated)
(1,028,443 missing values generated)
no observations
(1,279,471 observations deleted)
type mismatch
r(109);

end of do-file
r(109);

end of do-file
r(109);

end of do-file

r(109);

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. capture program drop compute_relationships

. program define compute_relationships
  1.     args person1 person2 relationship_1_2 relationship_2_1 reason condition filename_1_2 filename_2_1 /* local macro */
  2. 
.     preserve
  3.     gen relfrom = `person1' if `condition'
  4.     gen relto = `person2' if `condition'
  5.     gen relationship_tc0 = "`relationship_1_2'":relationship if `condition'
  6.     label values relationship_tc0 relationship
  7.     gen reason_tc0 = "`reason'" if `condition'
  8.     tab relationship_tc0 swave
  9.     keep ssuid shhadid swave relfrom relto relationship_tc0 reason_tc0
 10.     drop if missing(relationship_tc0)
 11.     drop if (relfrom == relto)
 12.     save "$tempdir/`filename_1_2'", $replace
 13.     restore
 14. 
.     preserve
 15.     gen relfrom = `person2' if `condition'
 16.     gen relto = `person1' if `condition'
 17.     gen relationship_tc0 = "`relationship_2_1'":relationship if `condition'
 18.     label values relationship_tc0 relationship
 19.     gen reason_tc0 = "`reason'" if `condition'
 20.     tab relationship_tc0 swave
 21.     keep ssuid shhadid swave relfrom relto relationship_tc0 reason_tc0
 22.     drop if missing(relationship_tc0)
 23.     drop if (relfrom == relto)
 24.     save "$tempdir/`filename_2_1'", $replace
 25.     restore
 26. end

. 
end of do-file

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. capture program drop fixup_rel_pair

. program define fixup_rel_pair
  1.     args preferred_rel second_rel /*local macro, the first relationship is preferred */
  2. 
.     display "Preferring `preferred_rel' over `second_rel'"
  3.     
.     gen meets_condition = (((relationship_tc01 == "`preferred_rel'":relationship) & (relationship_tc02 == "`second_rel'":relationship)) | ((relationship_tc02 == "`preferred_rel'":relationship) & (r
> elationship_tc01 == "`second_rel'":relationship)))
  4.     gen needs_swap = ((relationship_tc02 == "`preferred_rel'":relationship) & (relationship_tc01 == "`second_rel'":relationship))
  5. 
.     replace numrels_tc0 = 1 if (meets_condition == 1)
  6.     replace relationship_tc01 = "`preferred_rel'":relationship if ((meets_condition == 1) & (needs_swap == 1))
  7.     replace relationship_tc02 = . if (meets_condition == 1)
  8.     replace reason_tc01 = reason_tc02 if ((meets_condition == 1) & (needs_swap == 1))
  9.     replace reason_tc02 = "" if (meets_condition == 1)
 10. 
.     drop meets_condition needs_swap
 11. end

. 
end of do-file

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. use "$tempdir/allwaves"
no; data in memory would be lost
r(4);

end of do-file

r(4);

. clear

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. //========================================================================================================//
. //===== Children's Household Instability Project                                     
. //===== Dataset: SIPP2008                                                            
. //===== Purpose: Compute relationships of ego to other household members using epnmom, epndad, epnspouse and errp 
. //========================================================================================================//
. 
. ********************************************************************************
. * Section: Start by creating programs to process data
. ********************************************************************************
. 
. ** Program to create process data from all waves and save a record for EGO and coresident (bio/step/adoptive mother/father) 
. ** Each relationship type is saved in a different file.
. ** The program also creates inverse relationships (i.e. relationships of other people to ego). 
. 
. capture program drop compute_relationships

. program define compute_relationships
  1.     args person1 person2 relationship_1_2 relationship_2_1 reason condition filename_1_2 filename_2_1 /* local macro */
  2. 
.     preserve
  3.     gen relfrom = `person1' if `condition'
  4.     gen relto = `person2' if `condition'
  5.     gen relationship_tc0 = "`relationship_1_2'":relationship if `condition'
  6.     label values relationship_tc0 relationship
  7.     gen reason_tc0 = "`reason'" if `condition'
  8.     tab relationship_tc0 swave
  9.     keep ssuid shhadid swave relfrom relto relationship_tc0 reason_tc0
 10.     drop if missing(relationship_tc0)
 11.     drop if (relfrom == relto)
 12.     save "$tempdir/`filename_1_2'", $replace
 13.     restore
 14. 
.     preserve
 15.     gen relfrom = `person2' if `condition'
 16.     gen relto = `person1' if `condition'
 17.     gen relationship_tc0 = "`relationship_2_1'":relationship if `condition'
 18.     label values relationship_tc0 relationship
 19.     gen reason_tc0 = "`reason'" if `condition'
 20.     tab relationship_tc0 swave
 21.     keep ssuid shhadid swave relfrom relto relationship_tc0 reason_tc0
 22.     drop if missing(relationship_tc0)
 23.     drop if (relfrom == relto)
 24.     save "$tempdir/`filename_2_1'", $replace
 25.     restore
 26. end

. 
. ** Program to fix conflicting relationship pairs, taking the first as preferable to the second. Conflicting relationships are
. ** possible when relationship identified with the parent pointer is not the same as the relationship identified with the
. ** relationship to householder variable. 
. 
. capture program drop fixup_rel_pair

. program define fixup_rel_pair
  1.     args preferred_rel second_rel /*local macro, the first relationship is preferred */
  2. 
.     display "Preferring `preferred_rel' over `second_rel'"
  3.     
.     gen meets_condition = (((relationship_tc01 == "`preferred_rel'":relationship) & (relationship_tc02 == "`second_rel'":relationship)) | ((relationship_tc02 == "`preferred_rel'":relationship) & (r
> elationship_tc01 == "`second_rel'":relationship)))
  4.     gen needs_swap = ((relationship_tc02 == "`preferred_rel'":relationship) & (relationship_tc01 == "`second_rel'":relationship))
  5. 
.     replace numrels_tc0 = 1 if (meets_condition == 1)
  6.     replace relationship_tc01 = "`preferred_rel'":relationship if ((meets_condition == 1) & (needs_swap == 1))
  7.     replace relationship_tc02 = . if (meets_condition == 1)
  8.     replace reason_tc01 = reason_tc02 if ((meets_condition == 1) & (needs_swap == 1))
  9.     replace reason_tc02 = "" if (meets_condition == 1)
 10. 
.     drop meets_condition needs_swap
 11. end

. 
. ********************************************************************************
. * Read in and label data
. use "$tempdir/allwaves"

. 
end of do-file

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. * You can look at the output of the "label list" in the log to see what number means what.
. local lnum = 1

. local llist ""

. foreach r in BIOCHILD BIOMOM BIODAD STEPCHILD STEPMOM STEPDAD ADOPTCHILD ADOPTMOM ADOPTDAD MOM DAD SPOUSE GRANDCHILD GRANDCHILD_P GRANDPARENT GRANDPARENT_P SIBLING PARTNER CHILDOFPARTNER F_CHILD CH
> ILD F_PARENT PARENT AUNTUNCLE AUNTUNCLE_OR_PARENT PARENT_OR_RELATIVE GREATGRANDCHILD GREATGRANDPARENT NEPHEWNIECE CHILD_OR_NEPHEWNIECE CHILD_OR_RELATIVE COUSIN SIBLING_OR_COUSIN F_SIB OTHER_REL OTH
> ER_REL_P NOREL  FOSTER CONFUSED DONTKNOW {
  2.     local llist = `"`llist' `lnum' "`r'""'
  3.     local lnum = `lnum' + 1
  4. }

. label define relationship `llist'

. display "String for relationship label"
String for relationship label

. display `"`llist'"'
 1 "BIOCHILD" 2 "BIOMOM" 3 "BIODAD" 4 "STEPCHILD" 5 "STEPMOM" 6 "STEPDAD" 7 "ADOPTCHILD" 8 "ADOPTMOM" 9 "ADOPTDAD" 10 "MOM" 11 "DAD" 12 "SPOUSE" 13 "GRANDCHILD" 14 "GRANDCHILD_P" 15 "GRANDPARENT" 16 
> "GRANDPARENT_P" 17 "SIBLING" 18 "PARTNER" 19 "CHILDOFPARTNER" 20 "F_CHILD" 21 "CHILD" 22 "F_PARENT" 23 "PARENT" 24 "AUNTUNCLE" 25 "AUNTUNCLE_OR_PARENT" 26 "PARENT_OR_RELATIVE" 27 "GREATGRANDCHILD" 
> 28 "GREATGRANDPARENT" 29 "NEPHEWNIECE" 30 "CHILD_OR_NEPHEWNIECE" 31 "CHILD_OR_RELATIVE" 32 "COUSIN" 33 "SIBLING_OR_COUSIN" 34 "F_SIB" 35 "OTHER_REL" 36 "OTHER_REL_P" 37 "NOREL" 38 "FOSTER" 39 "CONF
> USED" 40 "DONTKNOW"

. display "Label for relationships"
Label for relationships

. label list relationship
relationship:
           1 BIOCHILD
           2 BIOMOM
           3 BIODAD
           4 STEPCHILD
           5 STEPMOM
           6 STEPDAD
           7 ADOPTCHILD
           8 ADOPTMOM
           9 ADOPTDAD
          10 MOM
          11 DAD
          12 SPOUSE
          13 GRANDCHILD
          14 GRANDCHILD_P
          15 GRANDPARENT
          16 GRANDPARENT_P
          17 SIBLING
          18 PARTNER
          19 CHILDOFPARTNER
          20 F_CHILD
          21 CHILD
          22 F_PARENT
          23 PARENT
          24 AUNTUNCLE
          25 AUNTUNCLE_OR_PARENT
          26 PARENT_OR_RELATIVE
          27 GREATGRANDCHILD
          28 GREATGRANDPARENT
          29 NEPHEWNIECE
          30 CHILD_OR_NEPHEWNIECE
          31 CHILD_OR_RELATIVE
          32 COUSIN
          33 SIBLING_OR_COUSIN
          34 F_SIB
          35 OTHER_REL
          36 OTHER_REL_P
          37 NOREL
          38 FOSTER
          39 CONFUSED
          40 DONTKNOW

. 
end of do-file

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. local lnum = 1

. local llist ""

. foreach r in biochild BIOMOM BIODAD STEPCHILD STEPMOM STEPDAD ADOPTCHILD ADOPTMOM ADOPTDAD MOM DAD SPOUSE GRANDCHILD GRANDCHILD_P GRANDPARENT GRANDPARENT_P SIBLING PARTNER CHILDOFPARTNER F_CHILD CH
> ILD F_PARENT PARENT AUNTUNCLE AUNTUNCLE_OR_PARENT PARENT_OR_RELATIVE GREATGRANDCHILD GREATGRANDPARENT NEPHEWNIECE CHILD_OR_NEPHEWNIECE CHILD_OR_RELATIVE COUSIN SIBLING_OR_COUSIN F_SIB OTHER_REL OTH
> ER_REL_P NOREL  FOSTER CONFUSED DONTKNOW {
  2.     local llist = `"`llist' `lnum' "`r'""'
  3.     local lnum = `lnum' + 1
  4. }

. label define relationship `llist'
label relationship already defined
r(110);

end of do-file

r(110);

. label drop values relationship
value label values not found
r(111);

. label drop relationship

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. local lnum = 1

. local llist ""

. foreach r in biochild BIOMOM BIODAD STEPCHILD STEPMOM STEPDAD ADOPTCHILD ADOPTMOM ADOPTDAD MOM DAD SPOUSE GRANDCHILD GRANDCHILD_P GRANDPARENT GRANDPARENT_P SIBLING PARTNER CHILDOFPARTNER F_CHILD CH
> ILD F_PARENT PARENT AUNTUNCLE AUNTUNCLE_OR_PARENT PARENT_OR_RELATIVE GREATGRANDCHILD GREATGRANDPARENT NEPHEWNIECE CHILD_OR_NEPHEWNIECE CHILD_OR_RELATIVE COUSIN SIBLING_OR_COUSIN F_SIB OTHER_REL OTH
> ER_REL_P NOREL  FOSTER CONFUSED DONTKNOW {
  2.     local llist = `"`llist' `lnum' "`r'""'
  3.     local lnum = `lnum' + 1
  4. }

. label define relationship `llist'

. display "String for relationship label"
String for relationship label

. display `"`llist'"'
 1 "biochild" 2 "BIOMOM" 3 "BIODAD" 4 "STEPCHILD" 5 "STEPMOM" 6 "STEPDAD" 7 "ADOPTCHILD" 8 "ADOPTMOM" 9 "ADOPTDAD" 10 "MOM" 11 "DAD" 12 "SPOUSE" 13 "GRANDCHILD" 14 "GRANDCHILD_P" 15 "GRANDPARENT" 16 
> "GRANDPARENT_P" 17 "SIBLING" 18 "PARTNER" 19 "CHILDOFPARTNER" 20 "F_CHILD" 21 "CHILD" 22 "F_PARENT" 23 "PARENT" 24 "AUNTUNCLE" 25 "AUNTUNCLE_OR_PARENT" 26 "PARENT_OR_RELATIVE" 27 "GREATGRANDCHILD" 
> 28 "GREATGRANDPARENT" 29 "NEPHEWNIECE" 30 "CHILD_OR_NEPHEWNIECE" 31 "CHILD_OR_RELATIVE" 32 "COUSIN" 33 "SIBLING_OR_COUSIN" 34 "F_SIB" 35 "OTHER_REL" 36 "OTHER_REL_P" 37 "NOREL" 38 "FOSTER" 39 "CONF
> USED" 40 "DONTKNOW"

. display "Label for relationships"
Label for relationships

. label list relationship
relationship:
           1 biochild
           2 BIOMOM
           3 BIODAD
           4 STEPCHILD
           5 STEPMOM
           6 STEPDAD
           7 ADOPTCHILD
           8 ADOPTMOM
           9 ADOPTDAD
          10 MOM
          11 DAD
          12 SPOUSE
          13 GRANDCHILD
          14 GRANDCHILD_P
          15 GRANDPARENT
          16 GRANDPARENT_P
          17 SIBLING
          18 PARTNER
          19 CHILDOFPARTNER
          20 F_CHILD
          21 CHILD
          22 F_PARENT
          23 PARENT
          24 AUNTUNCLE
          25 AUNTUNCLE_OR_PARENT
          26 PARENT_OR_RELATIVE
          27 GREATGRANDCHILD
          28 GREATGRANDPARENT
          29 NEPHEWNIECE
          30 CHILD_OR_NEPHEWNIECE
          31 CHILD_OR_RELATIVE
          32 COUSIN
          33 SIBLING_OR_COUSIN
          34 F_SIB
          35 OTHER_REL
          36 OTHER_REL_P
          37 NOREL
          38 FOSTER
          39 CONFUSED
          40 DONTKNOW

. 
end of do-file

. label drop relationship

. label drop relationship
value label relationship not found
r(111);

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. local lnum = 1

. local llist ""

. foreach r in biochild biomom BIODAD STEPCHILD STEPMOM STEPDAD ADOPTCHILD ADOPTMOM ADOPTDAD MOM DAD SPOUSE GRANDCHILD GRANDCHILD_P GRANDPARENT GRANDPARENT_P SIBLING PARTNER CHILDOFPARTNER F_CHILD CH
> ILD F_PARENT PARENT AUNTUNCLE AUNTUNCLE_OR_PARENT PARENT_OR_RELATIVE GREATGRANDCHILD GREATGRANDPARENT NEPHEWNIECE CHILD_OR_NEPHEWNIECE CHILD_OR_RELATIVE COUSIN SIBLING_OR_COUSIN F_SIB OTHER_REL OTH
> ER_REL_P NOREL  FOSTER CONFUSED DONTKNOW {
  2.     local llist = `"`llist' `lnum' "`r'""'
  3.     local lnum = `lnum' + 1
  4. }

. label define relationship `llist'

. display "String for relationship label"
String for relationship label

. display `"`llist'"'
 1 "biochild" 2 "biomom" 3 "BIODAD" 4 "STEPCHILD" 5 "STEPMOM" 6 "STEPDAD" 7 "ADOPTCHILD" 8 "ADOPTMOM" 9 "ADOPTDAD" 10 "MOM" 11 "DAD" 12 "SPOUSE" 13 "GRANDCHILD" 14 "GRANDCHILD_P" 15 "GRANDPARENT" 16 
> "GRANDPARENT_P" 17 "SIBLING" 18 "PARTNER" 19 "CHILDOFPARTNER" 20 "F_CHILD" 21 "CHILD" 22 "F_PARENT" 23 "PARENT" 24 "AUNTUNCLE" 25 "AUNTUNCLE_OR_PARENT" 26 "PARENT_OR_RELATIVE" 27 "GREATGRANDCHILD" 
> 28 "GREATGRANDPARENT" 29 "NEPHEWNIECE" 30 "CHILD_OR_NEPHEWNIECE" 31 "CHILD_OR_RELATIVE" 32 "COUSIN" 33 "SIBLING_OR_COUSIN" 34 "F_SIB" 35 "OTHER_REL" 36 "OTHER_REL_P" 37 "NOREL" 38 "FOSTER" 39 "CONF
> USED" 40 "DONTKNOW"

. display "Label for relationships"
Label for relationships

. label list relationship
relationship:
           1 biochild
           2 biomom
           3 BIODAD
           4 STEPCHILD
           5 STEPMOM
           6 STEPDAD
           7 ADOPTCHILD
           8 ADOPTMOM
           9 ADOPTDAD
          10 MOM
          11 DAD
          12 SPOUSE
          13 GRANDCHILD
          14 GRANDCHILD_P
          15 GRANDPARENT
          16 GRANDPARENT_P
          17 SIBLING
          18 PARTNER
          19 CHILDOFPARTNER
          20 F_CHILD
          21 CHILD
          22 F_PARENT
          23 PARENT
          24 AUNTUNCLE
          25 AUNTUNCLE_OR_PARENT
          26 PARENT_OR_RELATIVE
          27 GREATGRANDCHILD
          28 GREATGRANDPARENT
          29 NEPHEWNIECE
          30 CHILD_OR_NEPHEWNIECE
          31 CHILD_OR_RELATIVE
          32 COUSIN
          33 SIBLING_OR_COUSIN
          34 F_SIB
          35 OTHER_REL
          36 OTHER_REL_P
          37 NOREL
          38 FOSTER
          39 CONFUSED
          40 DONTKNOW

. 
end of do-file

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. destring epppnum, generate(epppnum_n)
epppnum: all characters numeric; epppnum_n generated as int

. drop epppnum

. rename epppnum_n epppnum

. 
. replace epnmom=.   if epppnum==epnmom
(2 real changes made, 2 to missing)

. replace epndad=.   if epppnum==epndad
(12 real changes made, 12 to missing)

. replace epnspous=. if epppnum==epnspous
(0 real changes made)

. 
end of do-file

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. compute_relationships epppnum epnmom biochild biomom epnmom "((!missing(epnmom)) & (epnmom != 9999) & (etypmom == 1))" biochild_of_mom biomom
(892,258 missing values generated)
(892,258 missing values generated)
(892,258 missing values generated)
(892,258 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
            biochild |    31,786     29,687     28,835     27,436     27,390     26,726     25,836     25,653     25,013     24,080     23,695     23,414     22,983     22,728     21,951 |   387,213 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    31,786     29,687     28,835     27,436     27,390     26,726     25,836     25,653     25,013     24,080     23,695     23,414     22,983     22,728     21,951 |   387,213 
(892,258 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/biochild_of_mom.dta saved
(892,258 missing values generated)
(892,258 missing values generated)
(892,258 missing values generated)
(892,258 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
              biomom |    31,786     29,687     28,835     27,436     27,390     26,726     25,836     25,653     25,013     24,080     23,695     23,414     22,983     22,728     21,951 |   387,213 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    31,786     29,687     28,835     27,436     27,390     26,726     25,836     25,653     25,013     24,080     23,695     23,414     22,983     22,728     21,951 |   387,213 
(892,258 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/biomom.dta saved

. 
end of do-file

. label drop relationship

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. *** This builds a label for relationships (the most complicated form).
. * It numbers the labels starting at 1, incrementing by 1.
. * You can look at the output of the "label list" in the log to see what number means what.
. local lnum = 1

. local llist ""

. foreach r in biochild biomom biodad stepchild stepmom stepdad adoptchild adoptmom adoptdad mom dad spouse grandchild grandchild_p grandparent grandparent_p sibling partner childofpartner f_child ch
> ild f_parent parent auntuncle auntuncle_or_parent parent_or_relative greatgrandchild greatgrandparent nephewniece child_or_nephewniece child_or_relative cousin sibling_or_cousin f_sib other_rel oth
> er_rel_p norel  foster confused dontknow {
  2.     local llist = `"`llist' `lnum' "`r'""'
  3.     local lnum = `lnum' + 1
  4. }

. label define relationship `llist'

. display "String for relationship label"
String for relationship label

. display `"`llist'"'
 1 "biochild" 2 "biomom" 3 "biodad" 4 "stepchild" 5 "stepmom" 6 "stepdad" 7 "adoptchild" 8 "adoptmom" 9 "adoptdad" 10 "mom" 11 "dad" 12 "spouse" 13 "grandchild" 14 "grandchild_p" 15 "grandparent" 16 
> "grandparent_p" 17 "sibling" 18 "partner" 19 "childofpartner" 20 "f_child" 21 "child" 22 "f_parent" 23 "parent" 24 "auntuncle" 25 "auntuncle_or_parent" 26 "parent_or_relative" 27 "greatgrandchild" 
> 28 "greatgrandparent" 29 "nephewniece" 30 "child_or_nephewniece" 31 "child_or_relative" 32 "cousin" 33 "sibling_or_cousin" 34 "f_sib" 35 "other_rel" 36 "other_rel_p" 37 "norel" 38 "foster" 39 "conf
> used" 40 "dontknow"

. display "Label for relationships"
Label for relationships

. label list relationship
relationship:
           1 biochild
           2 biomom
           3 biodad
           4 stepchild
           5 stepmom
           6 stepdad
           7 adoptchild
           8 adoptmom
           9 adoptdad
          10 mom
          11 dad
          12 spouse
          13 grandchild
          14 grandchild_p
          15 grandparent
          16 grandparent_p
          17 sibling
          18 partner
          19 childofpartner
          20 f_child
          21 child
          22 f_parent
          23 parent
          24 auntuncle
          25 auntuncle_or_parent
          26 parent_or_relative
          27 greatgrandchild
          28 greatgrandparent
          29 nephewniece
          30 child_or_nephewniece
          31 child_or_relative
          32 cousin
          33 sibling_or_cousin
          34 f_sib
          35 other_rel
          36 other_rel_p
          37 norel
          38 foster
          39 confused
          40 dontknow

. 
end of do-file

. clear

. label drop relationship
value label relationship not found
r(111);

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. //========================================================================================================//
. //===== Children's Household Instability Project                                     
. //===== Dataset: SIPP2008                                                            
. //===== Purpose: Compute relationships of ego to other household members using epnmom, epndad, epnspouse and errp 
. //========================================================================================================//
. 
. ********************************************************************************
. * Section: Start by creating programs to process data
. ********************************************************************************
. 
. ** Program to create process data from all waves and save a record for EGO and coresident (bio/step/adoptive mother/father) 
. ** Each relationship type is saved in a different file.
. ** The program also creates inverse relationships (i.e. relationships of other people to ego). 
. 
. capture program drop compute_relationships

. program define compute_relationships
  1.     args person1 person2 relationship_1_2 relationship_2_1 reason condition filename_1_2 filename_2_1 /* local macro */
  2. 
.     preserve
  3.     gen relfrom = `person1' if `condition'
  4.     gen relto = `person2' if `condition'
  5.     gen relationship_tc0 = "`relationship_1_2'":relationship if `condition'
  6.     label values relationship_tc0 relationship
  7.     gen reason_tc0 = "`reason'" if `condition'
  8.     tab relationship_tc0 swave
  9.     keep ssuid shhadid swave relfrom relto relationship_tc0 reason_tc0
 10.     drop if missing(relationship_tc0)
 11.     drop if (relfrom == relto)
 12.     save "$tempdir/`filename_1_2'", $replace
 13.     restore
 14. 
.     preserve
 15.     gen relfrom = `person2' if `condition'
 16.     gen relto = `person1' if `condition'
 17.     gen relationship_tc0 = "`relationship_2_1'":relationship if `condition'
 18.     label values relationship_tc0 relationship
 19.     gen reason_tc0 = "`reason'" if `condition'
 20.     tab relationship_tc0 swave
 21.     keep ssuid shhadid swave relfrom relto relationship_tc0 reason_tc0
 22.     drop if missing(relationship_tc0)
 23.     drop if (relfrom == relto)
 24.     save "$tempdir/`filename_2_1'", $replace
 25.     restore
 26. end

. 
. ** Program to fix conflicting relationship pairs, taking the first as preferable to the second. Conflicting relationships are
. ** possible when relationship identified with the parent pointer is not the same as the relationship identified with the
. ** relationship to householder variable. 
. 
. capture program drop fixup_rel_pair

. program define fixup_rel_pair
  1.     args preferred_rel second_rel /*local macro, the first relationship is preferred */
  2. 
.     display "Preferring `preferred_rel' over `second_rel'"
  3.     
.     gen meets_condition = (((relationship_tc01 == "`preferred_rel'":relationship) & (relationship_tc02 == "`second_rel'":relationship)) | ((relationship_tc02 == "`preferred_rel'":relationship) & (r
> elationship_tc01 == "`second_rel'":relationship)))
  4.     gen needs_swap = ((relationship_tc02 == "`preferred_rel'":relationship) & (relationship_tc01 == "`second_rel'":relationship))
  5. 
.     replace numrels_tc0 = 1 if (meets_condition == 1)
  6.     replace relationship_tc01 = "`preferred_rel'":relationship if ((meets_condition == 1) & (needs_swap == 1))
  7.     replace relationship_tc02 = . if (meets_condition == 1)
  8.     replace reason_tc01 = reason_tc02 if ((meets_condition == 1) & (needs_swap == 1))
  9.     replace reason_tc02 = "" if (meets_condition == 1)
 10. 
.     drop meets_condition needs_swap
 11. end

. 
. ********************************************************************************
. * Read in and label data
. use "$tempdir/allwaves"

. 
. do "$sipp2008_code/relationship_label"

. 
. *** This builds a label for relationships (the most complicated form).
. * It numbers the labels starting at 1, incrementing by 1.
. * You can look at the output of the "label list" in the log to see what number means what.
. local lnum = 1

. local llist ""

. foreach r in biochild biomom biodad stepchild stepmom stepdad adoptchild adoptmom adoptdad mom dad spouse grandchild grandchild_p grandparent grandparent_p sibling partner childofpartner f_child ch
> ild f_parent parent auntuncle auntuncle_or_parent parent_or_relative greatgrandchild greatgrandparent nephewniece child_or_nephewniece child_or_relative cousin sibling_or_cousin f_sib other_rel oth
> er_rel_p norel  foster confused dontknow {
  2.     local llist = `"`llist' `lnum' "`r'""'
  3.     local lnum = `lnum' + 1
  4. }

. label define relationship `llist'

. display "String for relationship label"
String for relationship label

. display `"`llist'"'
 1 "biochild" 2 "biomom" 3 "biodad" 4 "stepchild" 5 "stepmom" 6 "stepdad" 7 "adoptchild" 8 "adoptmom" 9 "adoptdad" 10 "mom" 11 "dad" 12 "spouse" 13 "grandchild" 14 "grandchild_p" 15 "grandparent" 16 
> "grandparent_p" 17 "sibling" 18 "partner" 19 "childofpartner" 20 "f_child" 21 "child" 22 "f_parent" 23 "parent" 24 "auntuncle" 25 "auntuncle_or_parent" 26 "parent_or_relative" 27 "greatgrandchild" 
> 28 "greatgrandparent" 29 "nephewniece" 30 "child_or_nephewniece" 31 "child_or_relative" 32 "cousin" 33 "sibling_or_cousin" 34 "f_sib" 35 "other_rel" 36 "other_rel_p" 37 "norel" 38 "foster" 39 "conf
> used" 40 "dontknow"

. display "Label for relationships"
Label for relationships

. label list relationship
relationship:
           1 biochild
           2 biomom
           3 biodad
           4 stepchild
           5 stepmom
           6 stepdad
           7 adoptchild
           8 adoptmom
           9 adoptdad
          10 mom
          11 dad
          12 spouse
          13 grandchild
          14 grandchild_p
          15 grandparent
          16 grandparent_p
          17 sibling
          18 partner
          19 childofpartner
          20 f_child
          21 child
          22 f_parent
          23 parent
          24 auntuncle
          25 auntuncle_or_parent
          26 parent_or_relative
          27 greatgrandchild
          28 greatgrandparent
          29 nephewniece
          30 child_or_nephewniece
          31 child_or_relative
          32 cousin
          33 sibling_or_cousin
          34 f_sib
          35 other_rel
          36 other_rel_p
          37 norel
          38 foster
          39 confused
          40 dontknow

. 
end of do-file

. ********************************************************************************
. 
. * A small number of cases identified themselves as their own mother, father, or spouse
. destring epppnum, generate(epppnum_n)
epppnum: all characters numeric; epppnum_n generated as int

. drop epppnum

. rename epppnum_n epppnum

. 
. replace epnmom=.   if epppnum==epnmom
(2 real changes made, 2 to missing)

. replace epndad=.   if epppnum==epndad
(12 real changes made, 12 to missing)

. replace epnspous=. if epppnum==epnspous
(0 real changes made)

. 
. ********************************************************************************
. ** Section: Process parent/child relationships from epnmom, epndad, and epnspous.
. **
. ** Use Program: compute_relationships
. **        args: person1 person2 relationship_1_2 relationship_2_1 reason condition filename_1_2 filename_2_1
. ********************************************************************************
. compute_relationships epppnum epnmom biochild biomom epnmom "((!missing(epnmom)) & (epnmom != 9999) & (etypmom == 1))" biochild_of_mom biomom
(892,258 missing values generated)
(892,258 missing values generated)
(892,258 missing values generated)
(892,258 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
            biochild |    31,786     29,687     28,835     27,436     27,390     26,726     25,836     25,653     25,013     24,080     23,695     23,414     22,983     22,728     21,951 |   387,213 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    31,786     29,687     28,835     27,436     27,390     26,726     25,836     25,653     25,013     24,080     23,695     23,414     22,983     22,728     21,951 |   387,213 
(892,258 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/biochild_of_mom.dta saved
(892,258 missing values generated)
(892,258 missing values generated)
(892,258 missing values generated)
(892,258 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
              biomom |    31,786     29,687     28,835     27,436     27,390     26,726     25,836     25,653     25,013     24,080     23,695     23,414     22,983     22,728     21,951 |   387,213 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    31,786     29,687     28,835     27,436     27,390     26,726     25,836     25,653     25,013     24,080     23,695     23,414     22,983     22,728     21,951 |   387,213 
(892,258 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/biomom.dta saved

. compute_relationships epppnum epndad biochild biodad epndad "((!missing(epndad)) & (epndad != 9999) & (etypdad == 1))" biochild_of_dad biodad
(1,005,195 missing values generated)
(1,005,195 missing values generated)
(1,005,195 missing values generated)
(1,005,195 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
            biochild |    22,217     20,905     20,381     19,417     19,265     18,809     18,346     18,176     17,709     17,114     16,898     16,691     16,380     16,199     15,769 |   274,276 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    22,217     20,905     20,381     19,417     19,265     18,809     18,346     18,176     17,709     17,114     16,898     16,691     16,380     16,199     15,769 |   274,276 
(1,005,195 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/biochild_of_dad.dta saved
(1,005,195 missing values generated)
(1,005,195 missing values generated)
(1,005,195 missing values generated)
(1,005,195 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
              biodad |    22,217     20,905     20,381     19,417     19,265     18,809     18,346     18,176     17,709     17,114     16,898     16,691     16,380     16,199     15,769 |   274,276 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    22,217     20,905     20,381     19,417     19,265     18,809     18,346     18,176     17,709     17,114     16,898     16,691     16,380     16,199     15,769 |   274,276 
(1,005,195 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/biodad.dta saved

. compute_relationships epppnum epnmom stepchild stepmom epnmom "((!missing(epnmom)) & (epnmom != 9999) & (etypmom == 2))" stepchild_of_mom stepmom
(1,262,777 missing values generated)
(1,262,777 missing values generated)
(1,262,777 missing values generated)
(1,262,777 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
           stepchild |     1,255      1,215      1,157      1,154      1,140      1,112      1,104      1,094      1,111      1,067      1,081      1,076      1,086      1,053        989 |    16,694 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     1,255      1,215      1,157      1,154      1,140      1,112      1,104      1,094      1,111      1,067      1,081      1,076      1,086      1,053        989 |    16,694 
(1,262,777 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/stepchild_of_mom.dta saved
(1,262,777 missing values generated)
(1,262,777 missing values generated)
(1,262,777 missing values generated)
(1,262,777 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
             stepmom |     1,255      1,215      1,157      1,154      1,140      1,112      1,104      1,094      1,111      1,067      1,081      1,076      1,086      1,053        989 |    16,694 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     1,255      1,215      1,157      1,154      1,140      1,112      1,104      1,094      1,111      1,067      1,081      1,076      1,086      1,053        989 |    16,694 
(1,262,777 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/stepmom.dta saved

. compute_relationships epppnum epndad stepchild stepdad epndad "((!missing(epndad)) & (epndad != 9999) & (etypdad == 2))" stepchild_of_dad stepdad
(1,249,090 missing values generated)
(1,249,090 missing values generated)
(1,249,090 missing values generated)
(1,249,090 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
           stepchild |     2,484      2,332      2,275      2,152      2,116      2,118      2,048      2,010      1,994      1,897      1,881      1,858      1,799      1,707      1,710 |    30,381 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     2,484      2,332      2,275      2,152      2,116      2,118      2,048      2,010      1,994      1,897      1,881      1,858      1,799      1,707      1,710 |    30,381 
(1,249,090 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/stepchild_of_dad.dta saved
(1,249,090 missing values generated)
(1,249,090 missing values generated)
(1,249,090 missing values generated)
(1,249,090 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
             stepdad |     2,484      2,332      2,275      2,152      2,116      2,118      2,048      2,010      1,994      1,897      1,881      1,858      1,799      1,707      1,710 |    30,381 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     2,484      2,332      2,275      2,152      2,116      2,118      2,048      2,010      1,994      1,897      1,881      1,858      1,799      1,707      1,710 |    30,381 
(1,249,090 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/stepdad.dta saved

. compute_relationships epppnum epnmom adoptchild adoptmom epnmom "((!missing(epnmom)) & (epnmom != 9999) & (etypmom == 3))" adoptchild_of_mom adoptmom
(1,272,731 missing values generated)
(1,272,731 missing values generated)
(1,272,731 missing values generated)
(1,272,731 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
          adoptchild |       577        539        525        496        484        468        442        445        426        409        391        389        390        384        375 |     6,740 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       577        539        525        496        484        468        442        445        426        409        391        389        390        384        375 |     6,740 
(1,272,731 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/adoptchild_of_mom.dta saved
(1,272,731 missing values generated)
(1,272,731 missing values generated)
(1,272,731 missing values generated)
(1,272,731 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
            adoptmom |       577        539        525        496        484        468        442        445        426        409        391        389        390        384        375 |     6,740 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       577        539        525        496        484        468        442        445        426        409        391        389        390        384        375 |     6,740 
(1,272,731 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/adoptmom.dta saved

. compute_relationships epppnum epndad adoptchild adoptdad epndad "((!missing(epndad)) & (epndad != 9999) & (etypdad == 3))" adoptchild_of_dad adoptdad
(1,273,223 missing values generated)
(1,273,223 missing values generated)
(1,273,223 missing values generated)
(1,273,223 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
          adoptchild |       540        506        497        464        463        441        414        417        397        373        360        357        347        341        331 |     6,248 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       540        506        497        464        463        441        414        417        397        373        360        357        347        341        331 |     6,248 
(1,273,223 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/adoptchild_of_dad.dta saved
(1,273,223 missing values generated)
(1,273,223 missing values generated)
(1,273,223 missing values generated)
(1,273,223 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
            adoptdad |       540        506        497        464        463        441        414        417        397        373        360        357        347        341        331 |     6,248 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       540        506        497        464        463        441        414        417        397        373        360        357        347        341        331 |     6,248 
(1,273,223 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/adoptdad.dta saved

. compute_relationships epppnum epnspous spouse spouse epnspous "((!missing(epnspous)) & (epnspous != 9999) & (esex == 1))" epnspous1 epnspous2 
(1,021,318 missing values generated)
(1,021,318 missing values generated)
(1,021,318 missing values generated)
(1,021,318 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
              spouse |    21,420     20,028     19,342     18,552     18,267     17,699     17,255     16,940     16,491     16,013     15,690     15,521     15,284     15,028     14,623 |   258,153 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    21,420     20,028     19,342     18,552     18,267     17,699     17,255     16,940     16,491     16,013     15,690     15,521     15,284     15,028     14,623 |   258,153 
(1,021,318 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/epnspous1.dta saved
(1,021,318 missing values generated)
(1,021,318 missing values generated)
(1,021,318 missing values generated)
(1,021,318 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
              spouse |    21,420     20,028     19,342     18,552     18,267     17,699     17,255     16,940     16,491     16,013     15,690     15,521     15,284     15,028     14,623 |   258,153 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    21,420     20,028     19,342     18,552     18,267     17,699     17,255     16,940     16,491     16,013     15,690     15,521     15,284     15,028     14,623 |   258,153 
(1,021,318 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/epnspous2.dta saved

. 
. ********************************************************************************
. ** Section: Merge in errp, a variable indicating the reference person for the household.
. **          ref_person_long was created with make_auxiliary_datasets
. ********************************************************************************
. 
. merge m:1 ssuid shhadid swave using "$tempdir/ref_person_long"
(label esex already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                         1,279,471  (_merge==3)
    -----------------------------------------

. assert missing(ref_person) if (_merge == 2)
(null assertion)

. drop if (_merge == 2)
(0 observations deleted)

. assert (_merge == 3)

. drop _merge

. ********************************************************************************
. 
. 
. ********************************************************************************
. ** Section: Generate records for spouse, child, grandchild, parent, sibling, 
. **          others, foster child, partener, no relation based errp. 
. ** Note: The 1 and 2 suffixes below are convenient but not very descriptive.
. **        1 means the relationship as stated; 2 means the reverse.  
. **        E.g., errp_child_of_mom2 are moms of children identified by errp == 4.
. **
. ** Use Program: compute_relationships
. **        args: person1 person2 relationship_1_2 relationship_2_1 reason condition filename_1_2 filename_2_1
. ***********************************************************************************************************************
. 
. * Spouse of reference person.
. compute_relationships epppnum ref_person spouse spouse errp_3 "(errp == 3)" errp_spouse1 errp_spouse2
(1,028,443 missing values generated)
(1,028,443 missing values generated)
(1,028,443 missing values generated)
(1,028,443 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
              spouse |    20,898     19,511     18,837     18,052     17,753     17,184     16,747     16,462     16,020     15,534     15,231     15,087     14,865     14,625     14,222 |   251,028 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    20,898     19,511     18,837     18,052     17,753     17,184     16,747     16,462     16,020     15,534     15,231     15,087     14,865     14,625     14,222 |   251,028 
(1,028,443 observations deleted)
type mismatch
r(109);

end of do-file

r(109);

. describe epppnum

              storage   display    value
variable name   type    format     label      variable label
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
epppnum         int     %10.0g                PE: Person number

. describe ref_person

              storage   display    value
variable name   type    format     label      variable label
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
ref_person      str4    %9s                   PE: Person number

. describe spouse
variable spouse not found
r(111);

. tab spouse
variable spouse not found
r(111);

. describe errp

              storage   display    value
variable name   type    format     label      variable label
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
errp            byte    %34.0g     errp       PE: Household relationship

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. destring ref_person, generate(ref_person_n)
ref_person: all characters numeric; ref_person_n generated as int

. 
end of do-file

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. drop ref_person

. 
end of do-file

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. rename ref_person_n ref_person

. 
end of do-file

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. compute_relationships epppnum ref_person spouse spouse errp_3 "(errp == 3)" errp_spouse1 errp_spouse2
(1,028,443 missing values generated)
(1,028,443 missing values generated)
(1,028,443 missing values generated)
(1,028,443 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
              spouse |    20,898     19,511     18,837     18,052     17,753     17,184     16,747     16,462     16,020     15,534     15,231     15,087     14,865     14,625     14,222 |   251,028 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    20,898     19,511     18,837     18,052     17,753     17,184     16,747     16,462     16,020     15,534     15,231     15,087     14,865     14,625     14,222 |   251,028 
(1,028,443 observations deleted)
(0 observations deleted)
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_spouse1.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_spouse1.dta saved
(1,028,443 missing values generated)
(1,028,443 missing values generated)
(1,028,443 missing values generated)
(1,028,443 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
              spouse |    20,898     19,511     18,837     18,052     17,753     17,184     16,747     16,462     16,020     15,534     15,231     15,087     14,865     14,625     14,222 |   251,028 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    20,898     19,511     18,837     18,052     17,753     17,184     16,747     16,462     16,020     15,534     15,231     15,087     14,865     14,625     14,222 |   251,028 
(1,028,443 observations deleted)
(0 observations deleted)
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_spouse2.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_spouse2.dta saved

. 
end of do-file

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. * Child of reference person.  You'd expect epnmom/dad to capture this, too.
. compute_relationships epppnum ref_person child mom errp_4 "((errp == 4) & (ref_person_sex == 2))" errp_child_of_mom1 errp_child_of_mom2
(1,052,804 missing values generated)
(1,052,804 missing values generated)
(1,052,804 missing values generated)
(1,052,804 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               child |    18,854     17,659     17,009     16,120     16,047     15,625     15,013     14,992     14,628     13,957     13,749     13,565     13,459     13,269     12,721 |   226,667 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    18,854     17,659     17,009     16,120     16,047     15,625     15,013     14,992     14,628     13,957     13,749     13,565     13,459     13,269     12,721 |   226,667 
(1,052,804 observations deleted)
(0 observations deleted)
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_child_of_mom1.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_child_of_mom1.dta saved
(1,052,804 missing values generated)
(1,052,804 missing values generated)
(1,052,804 missing values generated)
(1,052,804 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
                 mom |    18,854     17,659     17,009     16,120     16,047     15,625     15,013     14,992     14,628     13,957     13,749     13,565     13,459     13,269     12,721 |   226,667 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    18,854     17,659     17,009     16,120     16,047     15,625     15,013     14,992     14,628     13,957     13,749     13,565     13,459     13,269     12,721 |   226,667 
(1,052,804 observations deleted)
(0 observations deleted)
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_child_of_mom2.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_child_of_mom2.dta saved

. compute_relationships epppnum ref_person child dad errp_4 "((errp == 4) & (ref_person_sex == 1))" errp_child_of_dad1 errp_child_of_dad2
(1,114,765 missing values generated)
(1,114,765 missing values generated)
(1,114,765 missing values generated)
(1,114,765 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               child |    13,198     12,364     12,202     11,584     11,488     11,275     11,067     10,958     10,664     10,316     10,218     10,147      9,902      9,774      9,549 |   164,706 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    13,198     12,364     12,202     11,584     11,488     11,275     11,067     10,958     10,664     10,316     10,218     10,147      9,902      9,774      9,549 |   164,706 
(1,114,765 observations deleted)
(0 observations deleted)
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_child_of_dad1.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_child_of_dad1.dta saved
(1,114,765 missing values generated)
(1,114,765 missing values generated)
(1,114,765 missing values generated)
(1,114,765 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
                 dad |    13,198     12,364     12,202     11,584     11,488     11,275     11,067     10,958     10,664     10,316     10,218     10,147      9,902      9,774      9,549 |   164,706 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    13,198     12,364     12,202     11,584     11,488     11,275     11,067     10,958     10,664     10,316     10,218     10,147      9,902      9,774      9,549 |   164,706 
(1,114,765 observations deleted)
(0 observations deleted)
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_child_of_dad2.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_child_of_dad2.dta saved

. 
. * Grandchild of reference person.
. compute_relationships epppnum ref_person GRANDchild GRANDPARENT errp_5 "(errp == 5)" errp_grandchild1 errp_grandchild2
(1,248,290 missing values generated)
(1,248,290 missing values generated)
(value label dereference "GRANDchild":relationship not found)
(1,279,471 missing values generated)
(1,248,290 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_grandchild1.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_grandchild1.dta saved
(1,248,290 missing values generated)
(1,248,290 missing values generated)
(value label dereference "GRANDPARENT":relationship not found)
(1,279,471 missing values generated)
(1,248,290 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_grandchild2.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_grandchild2.dta saved

. 
. * Parent of reference person.
. compute_relationships epppnum ref_person mom child errp_6 "((errp == 6) & (esex == 2))" errp_mom1 errp_mom2
(1,270,903 missing values generated)
(1,270,903 missing values generated)
(1,270,903 missing values generated)
(1,270,903 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
                 mom |       686        642        606        589        591        614        568        566        557        542        529        535        525        509        509 |     8,568 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       686        642        606        589        591        614        568        566        557        542        529        535        525        509        509 |     8,568 
(1,270,903 observations deleted)
(0 observations deleted)
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_mom1.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_mom1.dta saved
(1,270,903 missing values generated)
(1,270,903 missing values generated)
(1,270,903 missing values generated)
(1,270,903 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               child |       686        642        606        589        591        614        568        566        557        542        529        535        525        509        509 |     8,568 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       686        642        606        589        591        614        568        566        557        542        529        535        525        509        509 |     8,568 
(1,270,903 observations deleted)
(0 observations deleted)
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_mom2.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_mom2.dta saved

. compute_relationships epppnum ref_person dad child errp_6 "((errp == 6) & (esex == 1))" errp_dad1 errp_dad2
(1,276,449 missing values generated)
(1,276,449 missing values generated)
(1,276,449 missing values generated)
(1,276,449 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
                 dad |       241        222        217        206        217        235        223        200        202        188        193        173        170        168        167 |     3,022 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       241        222        217        206        217        235        223        200        202        188        193        173        170        168        167 |     3,022 
(1,276,449 observations deleted)
(0 observations deleted)
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_dad1.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_dad1.dta saved
(1,276,449 missing values generated)
(1,276,449 missing values generated)
(1,276,449 missing values generated)
(1,276,449 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               child |       241        222        217        206        217        235        223        200        202        188        193        173        170        168        167 |     3,022 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       241        222        217        206        217        235        223        200        202        188        193        173        170        168        167 |     3,022 
(1,276,449 observations deleted)
(0 observations deleted)
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_dad2.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_dad2.dta saved

. 
. * Sibling of reference person.
. compute_relationships epppnum ref_person SIBLING SIBLING errp_7 "(errp == 7)" errp_sibling1 errp_sibling2
(1,268,490 missing values generated)
(1,268,490 missing values generated)
(value label dereference "SIBLING":relationship not found)
(1,279,471 missing values generated)
(1,268,490 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_sibling1.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_sibling1.dta saved
(1,268,490 missing values generated)
(1,268,490 missing values generated)
(value label dereference "SIBLING":relationship not found)
(1,279,471 missing values generated)
(1,268,490 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_sibling2.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_sibling2.dta saved

. 
. * Other relative.
. compute_relationships epppnum ref_person OTHER_REL OTHER_REL errp_8 "(errp == 8)" errp_otherrel1 errp_otherrel2
(1,254,343 missing values generated)
(1,254,343 missing values generated)
(value label dereference "OTHER_REL":relationship not found)
(1,279,471 missing values generated)
(1,254,343 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_otherrel1.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_otherrel1.dta saved
(1,254,343 missing values generated)
(1,254,343 missing values generated)
(value label dereference "OTHER_REL":relationship not found)
(1,279,471 missing values generated)
(1,254,343 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_otherrel2.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_otherrel2.dta saved

. 
. * Foster child.
. compute_relationships epppnum ref_person F_child F_PARENT errp_9 "(errp == 9)" errp_fosterchild1 errp_fosterchild2
(1,277,948 missing values generated)
(1,277,948 missing values generated)
(value label dereference "F_child":relationship not found)
(1,279,471 missing values generated)
(1,277,948 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_fosterchild1.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_fosterchild1.dta saved
(1,277,948 missing values generated)
(1,277,948 missing values generated)
(value label dereference "F_PARENT":relationship not found)
(1,279,471 missing values generated)
(1,277,948 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_fosterchild2.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_fosterchild2.dta saved

. 
. * Partner of reference person.
. compute_relationships epppnum ref_person PARTNER PARTNER errp_10 "(errp == 10)" errp_partner1 errp_partner2
(1,255,873 missing values generated)
(1,255,873 missing values generated)
(value label dereference "PARTNER":relationship not found)
(1,279,471 missing values generated)
(1,255,873 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_partner1.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_partner1.dta saved
(1,255,873 missing values generated)
(1,255,873 missing values generated)
(value label dereference "PARTNER":relationship not found)
(1,279,471 missing values generated)
(1,255,873 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_partner2.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_partner2.dta saved

. 
. * No relation.
. compute_relationships epppnum ref_person NOREL NOREL errp_GE_11 "((errp == 11) | (errp == 12) | (errp == 13))" errp_norelation1 errp_norelation2
(1,253,280 missing values generated)
(1,253,280 missing values generated)
(value label dereference "NOREL":relationship not found)
(1,279,471 missing values generated)
(1,253,280 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_norelation1.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_norelation1.dta saved
(1,253,280 missing values generated)
(1,253,280 missing values generated)
(value label dereference "NOREL":relationship not found)
(1,279,471 missing values generated)
(1,253,280 missing values generated)
no observations
(1,279,471 observations deleted)
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_norelation2.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_norelation2.dta saved

. 
. clear

. 
. 
end of do-file

. label drop relationship
value label relationship not found
r(111);

. clear

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. //========================================================================================================//
. //===== Children's Household Instability Project                                     
. //===== Dataset: SIPP2008                                                            
. //===== Purpose: Compute relationships of ego to other household members using epnmom, epndad, epnspouse and errp 
. //========================================================================================================//
. 
. ********************************************************************************
. * Section: Start by creating programs to process data
. ********************************************************************************
. 
. ** Program to create process data from all waves and save a record for EGO and coresident (bio/step/adoptive mother/father) 
. ** Each relationship type is saved in a different file.
. ** The program also creates inverse relationships (i.e. relationships of other people to ego). 
. 
. capture program drop compute_relationships

. program define compute_relationships
  1.     args person1 person2 relationship_1_2 relationship_2_1 reason condition filename_1_2 filename_2_1 /* local macro */
  2. 
.     preserve
  3.     gen relfrom = `person1' if `condition'
  4.     gen relto = `person2' if `condition'
  5.     gen relationship_tc0 = "`relationship_1_2'":relationship if `condition'
  6.     label values relationship_tc0 relationship
  7.     gen reason_tc0 = "`reason'" if `condition'
  8.     tab relationship_tc0 swave
  9.     keep ssuid shhadid swave relfrom relto relationship_tc0 reason_tc0
 10.     drop if missing(relationship_tc0)
 11.     drop if (relfrom == relto)
 12.     save "$tempdir/`filename_1_2'", $replace
 13.     restore
 14. 
.     preserve
 15.     gen relfrom = `person2' if `condition'
 16.     gen relto = `person1' if `condition'
 17.     gen relationship_tc0 = "`relationship_2_1'":relationship if `condition'
 18.     label values relationship_tc0 relationship
 19.     gen reason_tc0 = "`reason'" if `condition'
 20.     tab relationship_tc0 swave
 21.     keep ssuid shhadid swave relfrom relto relationship_tc0 reason_tc0
 22.     drop if missing(relationship_tc0)
 23.     drop if (relfrom == relto)
 24.     save "$tempdir/`filename_2_1'", $replace
 25.     restore
 26. end

. 
. ** Program to fix conflicting relationship pairs, taking the first as preferable to the second. Conflicting relationships are
. ** possible when relationship identified with the parent pointer is not the same as the relationship identified with the
. ** relationship to householder variable. 
. 
. capture program drop fixup_rel_pair

. program define fixup_rel_pair
  1.     args preferred_rel second_rel /*local macro, the first relationship is preferred */
  2. 
.     display "Preferring `preferred_rel' over `second_rel'"
  3.     
.     gen meets_condition = (((relationship_tc01 == "`preferred_rel'":relationship) & (relationship_tc02 == "`second_rel'":relationship)) | ((relationship_tc02 == "`preferred_rel'":relationship) & (r
> elationship_tc01 == "`second_rel'":relationship)))
  4.     gen needs_swap = ((relationship_tc02 == "`preferred_rel'":relationship) & (relationship_tc01 == "`second_rel'":relationship))
  5. 
.     replace numrels_tc0 = 1 if (meets_condition == 1)
  6.     replace relationship_tc01 = "`preferred_rel'":relationship if ((meets_condition == 1) & (needs_swap == 1))
  7.     replace relationship_tc02 = . if (meets_condition == 1)
  8.     replace reason_tc01 = reason_tc02 if ((meets_condition == 1) & (needs_swap == 1))
  9.     replace reason_tc02 = "" if (meets_condition == 1)
 10. 
.     drop meets_condition needs_swap
 11. end

. 
. ********************************************************************************
. * Read in and label data
. use "$tempdir/allwaves"

. 
. do "$sipp2008_code/relationship_label"

. 
. *** This builds a label for relationships (the most complicated form).
. * It numbers the labels starting at 1, incrementing by 1.
. * You can look at the output of the "label list" in the log to see what number means what.
. local lnum = 1

. local llist ""

. foreach r in biochild biomom biodad stepchild stepmom stepdad adoptchild adoptmom adoptdad mom dad spouse grandchild grandchild_p grandparent grandparent_p sibling partner childofpartner f_child ch
> ild f_parent parent auntuncle auntuncle_or_parent parent_or_relative greatgrandchild greatgrandparent nephewniece child_or_nephewniece child_or_relative cousin sibling_or_cousin f_sib other_rel oth
> er_rel_p norel  foster confused dontknow {
  2.     local llist = `"`llist' `lnum' "`r'""'
  3.     local lnum = `lnum' + 1
  4. }

. label define relationship `llist'

. display "String for relationship label"
String for relationship label

. display `"`llist'"'
 1 "biochild" 2 "biomom" 3 "biodad" 4 "stepchild" 5 "stepmom" 6 "stepdad" 7 "adoptchild" 8 "adoptmom" 9 "adoptdad" 10 "mom" 11 "dad" 12 "spouse" 13 "grandchild" 14 "grandchild_p" 15 "grandparent" 16 
> "grandparent_p" 17 "sibling" 18 "partner" 19 "childofpartner" 20 "f_child" 21 "child" 22 "f_parent" 23 "parent" 24 "auntuncle" 25 "auntuncle_or_parent" 26 "parent_or_relative" 27 "greatgrandchild" 
> 28 "greatgrandparent" 29 "nephewniece" 30 "child_or_nephewniece" 31 "child_or_relative" 32 "cousin" 33 "sibling_or_cousin" 34 "f_sib" 35 "other_rel" 36 "other_rel_p" 37 "norel" 38 "foster" 39 "conf
> used" 40 "dontknow"

. display "Label for relationships"
Label for relationships

. label list relationship
relationship:
           1 biochild
           2 biomom
           3 biodad
           4 stepchild
           5 stepmom
           6 stepdad
           7 adoptchild
           8 adoptmom
           9 adoptdad
          10 mom
          11 dad
          12 spouse
          13 grandchild
          14 grandchild_p
          15 grandparent
          16 grandparent_p
          17 sibling
          18 partner
          19 childofpartner
          20 f_child
          21 child
          22 f_parent
          23 parent
          24 auntuncle
          25 auntuncle_or_parent
          26 parent_or_relative
          27 greatgrandchild
          28 greatgrandparent
          29 nephewniece
          30 child_or_nephewniece
          31 child_or_relative
          32 cousin
          33 sibling_or_cousin
          34 f_sib
          35 other_rel
          36 other_rel_p
          37 norel
          38 foster
          39 confused
          40 dontknow

. 
end of do-file

. ********************************************************************************
. 
. * A small number of cases identified themselves as their own mother, father, or spouse
. destring epppnum, generate(epppnum_n)
epppnum: all characters numeric; epppnum_n generated as int

. drop epppnum

. rename epppnum_n epppnum

. 
. replace epnmom=.   if epppnum==epnmom
(2 real changes made, 2 to missing)

. replace epndad=.   if epppnum==epndad
(12 real changes made, 12 to missing)

. replace epnspous=. if epppnum==epnspous
(0 real changes made)

. 
. ********************************************************************************
. ** Section: Process parent/child relationships from epnmom, epndad, and epnspous.
. **
. ** Use Program: compute_relationships
. **        args: person1 person2 relationship_1_2 relationship_2_1 reason condition filename_1_2 filename_2_1
. ********************************************************************************
. compute_relationships epppnum epnmom biochild biomom epnmom "((!missing(epnmom)) & (epnmom != 9999) & (etypmom == 1))" biochild_of_mom biomom
(892,258 missing values generated)
(892,258 missing values generated)
(892,258 missing values generated)
(892,258 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
            biochild |    31,786     29,687     28,835     27,436     27,390     26,726     25,836     25,653     25,013     24,080     23,695     23,414     22,983     22,728     21,951 |   387,213 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    31,786     29,687     28,835     27,436     27,390     26,726     25,836     25,653     25,013     24,080     23,695     23,414     22,983     22,728     21,951 |   387,213 
(892,258 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/biochild_of_mom.dta saved
(892,258 missing values generated)
(892,258 missing values generated)
(892,258 missing values generated)
(892,258 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
              biomom |    31,786     29,687     28,835     27,436     27,390     26,726     25,836     25,653     25,013     24,080     23,695     23,414     22,983     22,728     21,951 |   387,213 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    31,786     29,687     28,835     27,436     27,390     26,726     25,836     25,653     25,013     24,080     23,695     23,414     22,983     22,728     21,951 |   387,213 
(892,258 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/biomom.dta saved

. compute_relationships epppnum epndad biochild biodad epndad "((!missing(epndad)) & (epndad != 9999) & (etypdad == 1))" biochild_of_dad biodad
(1,005,195 missing values generated)
(1,005,195 missing values generated)
(1,005,195 missing values generated)
(1,005,195 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
            biochild |    22,217     20,905     20,381     19,417     19,265     18,809     18,346     18,176     17,709     17,114     16,898     16,691     16,380     16,199     15,769 |   274,276 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    22,217     20,905     20,381     19,417     19,265     18,809     18,346     18,176     17,709     17,114     16,898     16,691     16,380     16,199     15,769 |   274,276 
(1,005,195 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/biochild_of_dad.dta saved
(1,005,195 missing values generated)
(1,005,195 missing values generated)
(1,005,195 missing values generated)
(1,005,195 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
              biodad |    22,217     20,905     20,381     19,417     19,265     18,809     18,346     18,176     17,709     17,114     16,898     16,691     16,380     16,199     15,769 |   274,276 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    22,217     20,905     20,381     19,417     19,265     18,809     18,346     18,176     17,709     17,114     16,898     16,691     16,380     16,199     15,769 |   274,276 
(1,005,195 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/biodad.dta saved

. compute_relationships epppnum epnmom stepchild stepmom epnmom "((!missing(epnmom)) & (epnmom != 9999) & (etypmom == 2))" stepchild_of_mom stepmom
(1,262,777 missing values generated)
(1,262,777 missing values generated)
(1,262,777 missing values generated)
(1,262,777 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
           stepchild |     1,255      1,215      1,157      1,154      1,140      1,112      1,104      1,094      1,111      1,067      1,081      1,076      1,086      1,053        989 |    16,694 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     1,255      1,215      1,157      1,154      1,140      1,112      1,104      1,094      1,111      1,067      1,081      1,076      1,086      1,053        989 |    16,694 
(1,262,777 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/stepchild_of_mom.dta saved
(1,262,777 missing values generated)
(1,262,777 missing values generated)
(1,262,777 missing values generated)
(1,262,777 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
             stepmom |     1,255      1,215      1,157      1,154      1,140      1,112      1,104      1,094      1,111      1,067      1,081      1,076      1,086      1,053        989 |    16,694 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     1,255      1,215      1,157      1,154      1,140      1,112      1,104      1,094      1,111      1,067      1,081      1,076      1,086      1,053        989 |    16,694 
(1,262,777 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/stepmom.dta saved

. compute_relationships epppnum epndad stepchild stepdad epndad "((!missing(epndad)) & (epndad != 9999) & (etypdad == 2))" stepchild_of_dad stepdad
(1,249,090 missing values generated)
(1,249,090 missing values generated)
(1,249,090 missing values generated)
(1,249,090 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
           stepchild |     2,484      2,332      2,275      2,152      2,116      2,118      2,048      2,010      1,994      1,897      1,881      1,858      1,799      1,707      1,710 |    30,381 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     2,484      2,332      2,275      2,152      2,116      2,118      2,048      2,010      1,994      1,897      1,881      1,858      1,799      1,707      1,710 |    30,381 
(1,249,090 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/stepchild_of_dad.dta saved
(1,249,090 missing values generated)
(1,249,090 missing values generated)
(1,249,090 missing values generated)
(1,249,090 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
             stepdad |     2,484      2,332      2,275      2,152      2,116      2,118      2,048      2,010      1,994      1,897      1,881      1,858      1,799      1,707      1,710 |    30,381 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     2,484      2,332      2,275      2,152      2,116      2,118      2,048      2,010      1,994      1,897      1,881      1,858      1,799      1,707      1,710 |    30,381 
(1,249,090 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/stepdad.dta saved

. compute_relationships epppnum epnmom adoptchild adoptmom epnmom "((!missing(epnmom)) & (epnmom != 9999) & (etypmom == 3))" adoptchild_of_mom adoptmom
(1,272,731 missing values generated)
(1,272,731 missing values generated)
(1,272,731 missing values generated)
(1,272,731 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
          adoptchild |       577        539        525        496        484        468        442        445        426        409        391        389        390        384        375 |     6,740 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       577        539        525        496        484        468        442        445        426        409        391        389        390        384        375 |     6,740 
(1,272,731 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/adoptchild_of_mom.dta saved
(1,272,731 missing values generated)
(1,272,731 missing values generated)
(1,272,731 missing values generated)
(1,272,731 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
            adoptmom |       577        539        525        496        484        468        442        445        426        409        391        389        390        384        375 |     6,740 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       577        539        525        496        484        468        442        445        426        409        391        389        390        384        375 |     6,740 
(1,272,731 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/adoptmom.dta saved

. compute_relationships epppnum epndad adoptchild adoptdad epndad "((!missing(epndad)) & (epndad != 9999) & (etypdad == 3))" adoptchild_of_dad adoptdad
(1,273,223 missing values generated)
(1,273,223 missing values generated)
(1,273,223 missing values generated)
(1,273,223 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
          adoptchild |       540        506        497        464        463        441        414        417        397        373        360        357        347        341        331 |     6,248 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       540        506        497        464        463        441        414        417        397        373        360        357        347        341        331 |     6,248 
(1,273,223 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/adoptchild_of_dad.dta saved
(1,273,223 missing values generated)
(1,273,223 missing values generated)
(1,273,223 missing values generated)
(1,273,223 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
            adoptdad |       540        506        497        464        463        441        414        417        397        373        360        357        347        341        331 |     6,248 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       540        506        497        464        463        441        414        417        397        373        360        357        347        341        331 |     6,248 
(1,273,223 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/adoptdad.dta saved

. compute_relationships epppnum epnspous spouse spouse epnspous "((!missing(epnspous)) & (epnspous != 9999) & (esex == 1))" epnspous1 epnspous2 
(1,021,318 missing values generated)
(1,021,318 missing values generated)
(1,021,318 missing values generated)
(1,021,318 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
              spouse |    21,420     20,028     19,342     18,552     18,267     17,699     17,255     16,940     16,491     16,013     15,690     15,521     15,284     15,028     14,623 |   258,153 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    21,420     20,028     19,342     18,552     18,267     17,699     17,255     16,940     16,491     16,013     15,690     15,521     15,284     15,028     14,623 |   258,153 
(1,021,318 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/epnspous1.dta saved
(1,021,318 missing values generated)
(1,021,318 missing values generated)
(1,021,318 missing values generated)
(1,021,318 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
              spouse |    21,420     20,028     19,342     18,552     18,267     17,699     17,255     16,940     16,491     16,013     15,690     15,521     15,284     15,028     14,623 |   258,153 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    21,420     20,028     19,342     18,552     18,267     17,699     17,255     16,940     16,491     16,013     15,690     15,521     15,284     15,028     14,623 |   258,153 
(1,021,318 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/epnspous2.dta saved

. 
. ********************************************************************************
. ** Section: Merge in errp, a variable indicating the reference person for the household.
. **          ref_person_long was created with make_auxiliary_datasets
. ********************************************************************************
. 
. merge m:1 ssuid shhadid swave using "$tempdir/ref_person_long"
(label esex already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                         1,279,471  (_merge==3)
    -----------------------------------------

. assert missing(ref_person) if (_merge == 2)
(null assertion)

. drop if (_merge == 2)
(0 observations deleted)

. assert (_merge == 3)

. drop _merge

. ********************************************************************************
. 
. 
. ********************************************************************************
. ** Section: Generate records for spouse, child, grandchild, parent, sibling, 
. **          others, foster child, partener, no relation based errp. 
. ** Note: The 1 and 2 suffixes below are convenient but not very descriptive.
. **        1 means the relationship as stated; 2 means the reverse.  
. **        E.g., errp_child_of_mom2 are moms of children identified by errp == 4.
. **
. ** Use Program: compute_relationships
. **        args: person1 person2 relationship_1_2 relationship_2_1 reason condition filename_1_2 filename_2_1
. ***********************************************************************************************************************
. destring ref_person, generate(ref_person_n)
ref_person: all characters numeric; ref_person_n generated as int

. drop ref_person

. rename ref_person_n ref_person

. 
. * Spouse of reference person.
. compute_relationships epppnum ref_person spouse spouse errp_3 "(errp == 3)" errp_spouse1 errp_spouse2
(1,028,443 missing values generated)
(1,028,443 missing values generated)
(1,028,443 missing values generated)
(1,028,443 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
              spouse |    20,898     19,511     18,837     18,052     17,753     17,184     16,747     16,462     16,020     15,534     15,231     15,087     14,865     14,625     14,222 |   251,028 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    20,898     19,511     18,837     18,052     17,753     17,184     16,747     16,462     16,020     15,534     15,231     15,087     14,865     14,625     14,222 |   251,028 
(1,028,443 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_spouse1.dta saved
(1,028,443 missing values generated)
(1,028,443 missing values generated)
(1,028,443 missing values generated)
(1,028,443 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
              spouse |    20,898     19,511     18,837     18,052     17,753     17,184     16,747     16,462     16,020     15,534     15,231     15,087     14,865     14,625     14,222 |   251,028 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    20,898     19,511     18,837     18,052     17,753     17,184     16,747     16,462     16,020     15,534     15,231     15,087     14,865     14,625     14,222 |   251,028 
(1,028,443 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_spouse2.dta saved

. 
. * Child of reference person.  You'd expect epnmom/dad to capture this, too.
. compute_relationships epppnum ref_person child mom errp_4 "((errp == 4) & (ref_person_sex == 2))" errp_child_of_mom1 errp_child_of_mom2
(1,052,804 missing values generated)
(1,052,804 missing values generated)
(1,052,804 missing values generated)
(1,052,804 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               child |    18,854     17,659     17,009     16,120     16,047     15,625     15,013     14,992     14,628     13,957     13,749     13,565     13,459     13,269     12,721 |   226,667 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    18,854     17,659     17,009     16,120     16,047     15,625     15,013     14,992     14,628     13,957     13,749     13,565     13,459     13,269     12,721 |   226,667 
(1,052,804 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_child_of_mom1.dta saved
(1,052,804 missing values generated)
(1,052,804 missing values generated)
(1,052,804 missing values generated)
(1,052,804 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
                 mom |    18,854     17,659     17,009     16,120     16,047     15,625     15,013     14,992     14,628     13,957     13,749     13,565     13,459     13,269     12,721 |   226,667 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    18,854     17,659     17,009     16,120     16,047     15,625     15,013     14,992     14,628     13,957     13,749     13,565     13,459     13,269     12,721 |   226,667 
(1,052,804 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_child_of_mom2.dta saved

. compute_relationships epppnum ref_person child dad errp_4 "((errp == 4) & (ref_person_sex == 1))" errp_child_of_dad1 errp_child_of_dad2
(1,114,765 missing values generated)
(1,114,765 missing values generated)
(1,114,765 missing values generated)
(1,114,765 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               child |    13,198     12,364     12,202     11,584     11,488     11,275     11,067     10,958     10,664     10,316     10,218     10,147      9,902      9,774      9,549 |   164,706 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    13,198     12,364     12,202     11,584     11,488     11,275     11,067     10,958     10,664     10,316     10,218     10,147      9,902      9,774      9,549 |   164,706 
(1,114,765 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_child_of_dad1.dta saved
(1,114,765 missing values generated)
(1,114,765 missing values generated)
(1,114,765 missing values generated)
(1,114,765 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
                 dad |    13,198     12,364     12,202     11,584     11,488     11,275     11,067     10,958     10,664     10,316     10,218     10,147      9,902      9,774      9,549 |   164,706 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    13,198     12,364     12,202     11,584     11,488     11,275     11,067     10,958     10,664     10,316     10,218     10,147      9,902      9,774      9,549 |   164,706 
(1,114,765 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_child_of_dad2.dta saved

. 
. * Grandchild of reference person.
. compute_relationships epppnum ref_person grandchild grandparent errp_5 "(errp == 5)" errp_grandchild1 errp_grandchild2
(1,248,290 missing values generated)
(1,248,290 missing values generated)
(1,248,290 missing values generated)
(1,248,290 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
          grandchild |     2,147      2,131      2,112      2,137      2,213      2,135      2,094      2,025      2,068      2,047      2,048      2,018      2,060      2,050      1,896 |    31,181 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     2,147      2,131      2,112      2,137      2,213      2,135      2,094      2,025      2,068      2,047      2,048      2,018      2,060      2,050      1,896 |    31,181 
(1,248,290 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_grandchild1.dta saved
(1,248,290 missing values generated)
(1,248,290 missing values generated)
(1,248,290 missing values generated)
(1,248,290 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
         grandparent |     2,147      2,131      2,112      2,137      2,213      2,135      2,094      2,025      2,068      2,047      2,048      2,018      2,060      2,050      1,896 |    31,181 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     2,147      2,131      2,112      2,137      2,213      2,135      2,094      2,025      2,068      2,047      2,048      2,018      2,060      2,050      1,896 |    31,181 
(1,248,290 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_grandchild2.dta saved

. 
. * Parent of reference person.
. compute_relationships epppnum ref_person mom child errp_6 "((errp == 6) & (esex == 2))" errp_mom1 errp_mom2
(1,270,903 missing values generated)
(1,270,903 missing values generated)
(1,270,903 missing values generated)
(1,270,903 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
                 mom |       686        642        606        589        591        614        568        566        557        542        529        535        525        509        509 |     8,568 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       686        642        606        589        591        614        568        566        557        542        529        535        525        509        509 |     8,568 
(1,270,903 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_mom1.dta saved
(1,270,903 missing values generated)
(1,270,903 missing values generated)
(1,270,903 missing values generated)
(1,270,903 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               child |       686        642        606        589        591        614        568        566        557        542        529        535        525        509        509 |     8,568 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       686        642        606        589        591        614        568        566        557        542        529        535        525        509        509 |     8,568 
(1,270,903 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_mom2.dta saved

. compute_relationships epppnum ref_person dad child errp_6 "((errp == 6) & (esex == 1))" errp_dad1 errp_dad2
(1,276,449 missing values generated)
(1,276,449 missing values generated)
(1,276,449 missing values generated)
(1,276,449 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
                 dad |       241        222        217        206        217        235        223        200        202        188        193        173        170        168        167 |     3,022 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       241        222        217        206        217        235        223        200        202        188        193        173        170        168        167 |     3,022 
(1,276,449 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_dad1.dta saved
(1,276,449 missing values generated)
(1,276,449 missing values generated)
(1,276,449 missing values generated)
(1,276,449 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               child |       241        222        217        206        217        235        223        200        202        188        193        173        170        168        167 |     3,022 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       241        222        217        206        217        235        223        200        202        188        193        173        170        168        167 |     3,022 
(1,276,449 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_dad2.dta saved

. 
. * Sibling of reference person.
. compute_relationships epppnum ref_person sibling sibling errp_7 "(errp == 7)" errp_sibling1 errp_sibling2
(1,268,490 missing values generated)
(1,268,490 missing values generated)
(1,268,490 missing values generated)
(1,268,490 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
             sibling |       889        846        819        801        776        822        766        744        714        688        660        628        595        607        626 |    10,981 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       889        846        819        801        776        822        766        744        714        688        660        628        595        607        626 |    10,981 
(1,268,490 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_sibling1.dta saved
(1,268,490 missing values generated)
(1,268,490 missing values generated)
(1,268,490 missing values generated)
(1,268,490 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
             sibling |       889        846        819        801        776        822        766        744        714        688        660        628        595        607        626 |    10,981 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       889        846        819        801        776        822        766        744        714        688        660        628        595        607        626 |    10,981 
(1,268,490 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_sibling2.dta saved

. 
. * Other relative.
. compute_relationships epppnum ref_person other_rel other_rel errp_8 "(errp == 8)" errp_otherrel1 errp_otherrel2
(1,254,343 missing values generated)
(1,254,343 missing values generated)
(1,254,343 missing values generated)
(1,254,343 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
           other_rel |     1,867      1,920      1,844      1,836      1,798      1,793      1,719      1,682      1,602      1,612      1,554      1,547      1,510      1,449      1,395 |    25,128 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     1,867      1,920      1,844      1,836      1,798      1,793      1,719      1,682      1,602      1,612      1,554      1,547      1,510      1,449      1,395 |    25,128 
(1,254,343 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_otherrel1.dta saved
(1,254,343 missing values generated)
(1,254,343 missing values generated)
(1,254,343 missing values generated)
(1,254,343 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
           other_rel |     1,867      1,920      1,844      1,836      1,798      1,793      1,719      1,682      1,602      1,612      1,554      1,547      1,510      1,449      1,395 |    25,128 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     1,867      1,920      1,844      1,836      1,798      1,793      1,719      1,682      1,602      1,612      1,554      1,547      1,510      1,449      1,395 |    25,128 
(1,254,343 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_otherrel2.dta saved

. 
. * Foster child.
. compute_relationships epppnum ref_person f_child f_parent errp_9 "(errp == 9)" errp_fosterchild1 errp_fosterchild2
(1,277,948 missing values generated)
(1,277,948 missing values generated)
(1,277,948 missing values generated)
(1,277,948 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
             f_child |       122        110        106        109        109        113        107        108        107         88         97         92         87         87         81 |     1,523 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       122        110        106        109        109        113        107        108        107         88         97         92         87         87         81 |     1,523 
(1,277,948 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_fosterchild1.dta saved
(1,277,948 missing values generated)
(1,277,948 missing values generated)
(1,277,948 missing values generated)
(1,277,948 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
            f_parent |       122        110        106        109        109        113        107        108        107         88         97         92         87         87         81 |     1,523 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |       122        110        106        109        109        113        107        108        107         88         97         92         87         87         81 |     1,523 
(1,277,948 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_fosterchild2.dta saved

. 
. * Partner of reference person.
. compute_relationships epppnum ref_person partner partner errp_10 "(errp == 10)" errp_partner1 errp_partner2
(1,255,873 missing values generated)
(1,255,873 missing values generated)
(1,255,873 missing values generated)
(1,255,873 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
             partner |     2,283      2,009      1,891      1,725      1,697      1,642      1,531      1,529      1,485      1,360      1,352      1,333      1,280      1,291      1,190 |    23,598 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     2,283      2,009      1,891      1,725      1,697      1,642      1,531      1,529      1,485      1,360      1,352      1,333      1,280      1,291      1,190 |    23,598 
(1,255,873 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_partner1.dta saved
(1,255,873 missing values generated)
(1,255,873 missing values generated)
(1,255,873 missing values generated)
(1,255,873 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
             partner |     2,283      2,009      1,891      1,725      1,697      1,642      1,531      1,529      1,485      1,360      1,352      1,333      1,280      1,291      1,190 |    23,598 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     2,283      2,009      1,891      1,725      1,697      1,642      1,531      1,529      1,485      1,360      1,352      1,333      1,280      1,291      1,190 |    23,598 
(1,255,873 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_partner2.dta saved

. 
. * No relation.
. compute_relationships epppnum ref_person norel norel errp_ge_11 "((errp == 11) | (errp == 12) | (errp == 13))" errp_norelation1 errp_norelation2
(1,253,280 missing values generated)
(1,253,280 missing values generated)
(1,253,280 missing values generated)
(1,253,280 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               norel |     2,448      2,160      2,026      1,913      1,976      1,876      1,767      1,755      1,689      1,571      1,506      1,491      1,413      1,329      1,271 |    26,191 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     2,448      2,160      2,026      1,913      1,976      1,876      1,767      1,755      1,689      1,571      1,506      1,491      1,413      1,329      1,271 |    26,191 
(1,253,280 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_norelation1.dta saved
(1,253,280 missing values generated)
(1,253,280 missing values generated)
(1,253,280 missing values generated)
(1,253,280 missing values generated)

                     |                                                                     SU: Wave of data collection
    relationship_tc0 |         1          2          3          4          5          6          7          8          9         10         11         12         13         14         15 |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               norel |     2,448      2,160      2,026      1,913      1,976      1,876      1,767      1,755      1,689      1,571      1,506      1,491      1,413      1,329      1,271 |    26,191 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     2,448      2,160      2,026      1,913      1,976      1,876      1,767      1,755      1,689      1,571      1,506      1,491      1,413      1,329      1,271 |    26,191 
(1,253,280 observations deleted)
(0 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/errp_norelation2.dta saved

. 
. clear

. 
end of do-file

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. use "$tempdir/biochild_of_mom"

. append using "$tempdir/biomom"
(label relationship already defined)

. append using "$tempdir/biochild_of_dad"
(label relationship already defined)

. append using "$tempdir/biodad"
(label relationship already defined)

. append using "$tempdir/stepchild_of_mom"
(label relationship already defined)

. append using "$tempdir/stepmom"
(label relationship already defined)

. append using "$tempdir/stepchild_of_dad"
(label relationship already defined)

. append using "$tempdir/stepdad"
(label relationship already defined)

. append using "$tempdir/adoptchild_of_mom"
(label relationship already defined)

. append using "$tempdir/adoptmom"
(label relationship already defined)

. append using "$tempdir/adoptchild_of_dad"
(label relationship already defined)

. append using "$tempdir/adoptdad"
(label relationship already defined)

. append using "$tempdir/errp_spouse1"
(label relationship already defined)

. append using "$tempdir/errp_spouse2"
(label relationship already defined)

. append using "$tempdir/errp_child_of_mom1"
(label relationship already defined)

. append using "$tempdir/errp_child_of_mom2"
(label relationship already defined)

. append using "$tempdir/errp_child_of_dad1"
(label relationship already defined)

. append using "$tempdir/errp_child_of_dad2"
(label relationship already defined)

. append using "$tempdir/errp_grandchild1"
(label relationship already defined)

. append using "$tempdir/errp_grandchild2"
(label relationship already defined)

. append using "$tempdir/errp_mom1"
(label relationship already defined)

. append using "$tempdir/errp_mom2"
(label relationship already defined)

. append using "$tempdir/errp_dad1"
(label relationship already defined)

. append using "$tempdir/errp_dad2"
(label relationship already defined)

. append using "$tempdir/errp_sibling1"
(label relationship already defined)

. append using "$tempdir/errp_sibling2"
(label relationship already defined)

. append using "$tempdir/errp_otherrel1"
(label relationship already defined)

. append using "$tempdir/errp_otherrel2"
(label relationship already defined)

. append using "$tempdir/errp_fosterchild1"
(label relationship already defined)

. append using "$tempdir/errp_fosterchild2"
(label relationship already defined)

. append using "$tempdir/errp_partner1"
(note: variable reason_tc0 was str6, now str7 to accommodate using data's values)
(label relationship already defined)

. append using "$tempdir/errp_partner2"
(label relationship already defined)

. append using "$tempdir/errp_norelation1"
(note: variable reason_tc0 was str7, now str10 to accommodate using data's values)
(label relationship already defined)

. append using "$tempdir/errp_norelation2"
(label relationship already defined)

. append using "$tempdir/epnspous1"
(label relationship already defined)

. append using "$tempdir/epnspous2"
(label relationship already defined)

. 
end of do-file

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. duplicates drop ssuid shhadid swave relfrom relto relationship_tc0, force

Duplicates in terms of ssuid shhadid swave relfrom relto relationship_tc0

(502,056 observations deleted)

. 
. save "$tempdir/relationships_tc0_all", $replace
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/relationships_tc0_all.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/relationships_tc0_all.dta saved

. 
end of do-file

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. sort ssuid shhadid swave relfrom relto

. by ssuid shhadid swave relfrom relto:  gen numrels_tc0 = _N /* total number of relationships */

. by ssuid shhadid swave relfrom relto:  gen relnum_tc0 = _n

. 
. assert (numrels_tc0 <= 2)

. 
. *reshape so that we can compare relationships for pairs (within wave) with more than one relationship type
. reshape wide relationship_tc0 reason_tc0, i(ssuid shhadid swave relfrom relto) j(relnum_tc0)
(note: j = 1 2)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                  3.0e+06   -> 2.2e+06
Number of variables                   9   ->      10
j variable (2 values)        relnum_tc0   ->   (dropped)
xij variables:
                       relationship_tc0   ->   relationship_tc01 relationship_tc02
                             reason_tc0   ->   reason_tc01 reason_tc02
-----------------------------------------------------------------------------

. 
. display "Number of relationships in a wave before any fix-ups"
Number of relationships in a wave before any fix-ups

. tab numrels_tc0

numrels_tc0 |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |  1,389,908       63.29       63.29
          2 |    806,316       36.71      100.00
------------+-----------------------------------
      Total |  2,196,224      100.00

. 
. ** Use program: fixup_rel_pair args: args preferred_rel second_rel
. * start with biological parents
. fixup_rel_pair biomom mom
Preferring biomom over mom
(219,801 real changes made)
(87,436 real changes made)
(219,801 real changes made, 219,801 to missing)
(87,436 real changes made)
(219,801 real changes made)

. fixup_rel_pair biodad dad
Preferring biodad over dad
(148,701 real changes made)
(59,208 real changes made)
(148,701 real changes made, 148,701 to missing)
(59,208 real changes made)
(148,701 real changes made)

. fixup_rel_pair biochild child
Preferring biochild over child
(368,502 real changes made)
(147,121 real changes made)
(368,502 real changes made, 368,502 to missing)
(147,121 real changes made)
(368,502 real changes made)

. 
. display "Number of relationships in a wave after bio fixes"
Number of relationships in a wave after bio fixes

. tab numrels_tc0

numrels_tc0 |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |  2,126,912       96.84       96.84
          2 |     69,312        3.16      100.00
------------+-----------------------------------
      Total |  2,196,224      100.00

. 
. * Fix adopt and step. 
. fixup_rel_pair stepmom mom
Preferring stepmom over mom
(11,441 real changes made)
(4,497 real changes made)
(11,441 real changes made, 11,441 to missing)
(4,497 real changes made)
(11,441 real changes made)

. fixup_rel_pair stepdad dad
Preferring stepdad over dad
(15,784 real changes made)
(6,277 real changes made)
(15,784 real changes made, 15,784 to missing)
(6,277 real changes made)
(15,784 real changes made)

. fixup_rel_pair stepchild child
Preferring stepchild over child
(27,225 real changes made)
(10,962 real changes made)
(27,225 real changes made, 27,225 to missing)
(10,962 real changes made)
(27,225 real changes made)

. fixup_rel_pair adoptmom mom
Preferring adoptmom over mom
(3,987 real changes made)
(1,615 real changes made)
(3,987 real changes made, 3,987 to missing)
(1,615 real changes made)
(3,987 real changes made)

. fixup_rel_pair adoptdad dad
Preferring adoptdad over dad
(3,237 real changes made)
(1,309 real changes made)
(3,237 real changes made, 3,237 to missing)
(1,309 real changes made)
(3,237 real changes made)

. fixup_rel_pair adoptchild child
Preferring adoptchild over child
(7,224 real changes made)
(2,807 real changes made)
(7,224 real changes made, 7,224 to missing)
(2,807 real changes made)
(7,224 real changes made)

. 
. display "Number of relationships in a wave after step and adopt fixes"
Number of relationships in a wave after step and adopt fixes

. tab numrels_tc0

numrels_tc0 |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |  2,195,810       99.98       99.98
          2 |        414        0.02      100.00
------------+-----------------------------------
      Total |  2,196,224      100.00

. 
. tab relationship_tc01 relationship_tc02 if (numrels_tc0 > 1)

                     |                                   2 relationship_tc0
  1 relationship_tc0 |  biochild     biomom     biodad  stepchild    stepmom    stepdad     spouse  other_rel |     Total
---------------------+----------------------------------------------------------------------------------------+----------
            biochild |         0          0          0          0          0          3         29         64 |        96 
              biomom |         0          0          0          1          0          0         22         21 |        44 
              biodad |         0          0          0          0          0          0         10         49 |        59 
           stepchild |         0          3          2          0         10          6          1         13 |        35 
             stepmom |         0          0          0          4          0          0          0          1 |         5 
             stepdad |         3          0          0          8          0          0          0         10 |        21 
              spouse |        32         17         12          0          1          0          0          0 |        62 
           other_rel |        43         13         24          5          2          5          0          0 |        92 
---------------------+----------------------------------------------------------------------------------------+----------
               Total |        78         33         38         18         13         14         62        158 |       414 

. 
. * Save a data set with remaining conflicted relationships.
. preserve

. keep if (numrels_tc0 > 1)
(2,195,810 observations deleted)

. save "$tempdir/relationships_tc0_lost", $replace 
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/relationships_tc0_lost.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/relationships_tc0_lost.dta saved

. restore

. 
. rename relationship_tc01 relationship

. rename reason_tc01 reason

. 
. drop relationship_tc02 reason_tc02

. 
. replace relationship=. if numrels_tc0 > 1
(414 real changes made, 414 to missing)

. 
. *Despite the name, this file is still long. One record per pair per wave.
. save "$tempdir/relationships_tc0_wide", $replace
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/relationships_tc0_wide.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/relationships_tc0_wide.dta saved

. 
. 
. 
. 
end of do-file

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. //==============================================================================
. //=========== Children's Household Instability Project                                  
. //=========== Dataset: SIPP2008                                                 
. //=========== Purpose: Uses programs to compute relationships not 
. //=========== directly identifiable with parent pointers, spouse pointer, or ERRP  
. //================================================================================
. 
. ********************************************************************************
. **  Section: programs to process data to identify relationships transitively
. ********************************************************************************
. 
. * Program generates relationship from relationship1 and relatiosnhip2, 
. * where A is [relationship1] of person B.
. * Person B is [relationship2] of person C.
. * Therefore ego is [relationship] or [result_rel] of person C.
. capture program drop generate_relationship

. program define generate_relationship
  1.     args result_rel rel1 rel2 /* local macros: result_rel rel1 rels */
  2.     display "Generating `result_rel' from `rel1' `rel2'"
  3.     replace relationship = "`result_rel'":relationship if ((relationship1 == "`rel1'":relationship) & (relationship2 == "`rel2'":relationship))
  4.         *if any relationship is missing:
.     if (("`result_rel'":relationship == .) | ("`rel1'":relationship == .) | ("`rel2'":relationship == .)) {
  5.         display as error "relationship not found in one of:  `result_rel' `rel1' `rel2'"
  6.         exit 111
  7.     }
  8. end

. 
. * Program to make lists of values associated with each relationship type
. * For example, moms can be biomoms, stepmoms, adoptive moms, or moms.  
. capture program drop make_relationship_list

. program define make_relationship_list, rclass /* results are in r() vector */
  1.     * display `"make_relationship_list args:  `0'"'
.     local max_rel = "`1'":relationship
  2.     local my_rel_list "`max_rel'"
  3.     * display "first rel:  `my_rel_list'"
.     if (`max_rel' == .) {
  4.         display as error "relationship not found:  `my_rel_list' `max_rel' `1'"
  5.         exit 111
  6.     }
  7.     local i = 2
  8.     while ("``i''" != "") {
  9.         * display "next rel:  ``i''"
.         local rel_num = "``i''":relationship
 10.         if (`rel_num' == .) {
 11.             display as error "relationship not found:  `my_rel_list' `max_rel' ``i''"
 12.             exit 111
 13.         }
 14.         * display "next rel:  ``i''  `rel_num'"
.         if (`rel_num' < `max_rel') {
 15.             display as error "relationships out of order in make_relationship_list:  `my_rel_list' `max_rel' `rel_num'"
 16.             exit 111
 17.         }
 18.         local max_rel = `rel_num'
 19.         local my_rel_list "`my_rel_list',`rel_num'"
 20.         * display "new rel list:  `my_rel_list'  max: `max_rel'"
.         local ++i
 21.     }
 22.     return local rel_list `"`my_rel_list'"'
 23. end

. 
. ********************************************************************************
. **  Section: apply programs to data to identify relationships bewteen ego and
. **  every other person in ego's household in the wave.
. ********************************************************************************
. 
.     use "$tempdir/relationships_tc0_wide"

. 
.     * We're going to create a dataset that has all the transitive relationships we can find.  So, if we have A --> B and B --> C
.     * we generate a dataset that tells us A --> B --> C by joining on B.
.     rename relfrom intermediate_person

.     rename relationship relationship2

.     rename reason reason2

.     label variable relationship2 "rel2"

.     label variable reason2 "reason2"

.     tempfile relmerge

.     save `relmerge'
file C:\Users\Joanna\AppData\Local\Temp\ST_3f6c_000001.tmp saved

. 
. 
.     use "$tempdir/relationships_tc0_wide"

.     rename relto intermediate_person

.     rename relationship relationship1

.     rename reason reason1

.     label variable relationship1 "rel1"

.     label variable reason1 "reason1"

.         
.         tab relationship1, m

                rel1 |      Freq.     Percent        Cum.
---------------------+-----------------------------------
            biochild |    661,315       30.11       30.11
              biomom |    387,136       17.63       47.74
              biodad |    274,179       12.48       60.22
           stepchild |     47,022        2.14       62.36
             stepmom |     16,676        0.76       63.12
             stepdad |     30,346        1.38       64.50
          adoptchild |     12,988        0.59       65.10
            adoptmom |      6,740        0.31       65.40
            adoptdad |      6,248        0.28       65.69
                 mom |          6        0.00       65.69
                 dad |          6        0.00       65.69
              spouse |    516,182       23.50       89.19
          grandchild |     31,181        1.42       90.61
         grandparent |     31,181        1.42       92.03
             sibling |     21,962        1.00       93.03
             partner |     47,196        2.15       95.18
             f_child |      1,523        0.07       95.25
               child |         12        0.00       95.25
            f_parent |      1,523        0.07       95.32
           other_rel |     50,006        2.28       97.60
               norel |     52,382        2.39       99.98
                   . |        414        0.02      100.00
---------------------+-----------------------------------
               Total |  2,196,224      100.00

.         
.     * Joinby creates a record for every combination of records matching 
.         * ssuid shhadid swave and intermediate_person in the two files.
.     joinby ssuid shhadid swave intermediate_person using `relmerge'

. 
.         tab relationship1, m

                rel1 |      Freq.     Percent        Cum.
---------------------+-----------------------------------
            biochild |  2,267,867       40.74       40.74
              biomom |    716,329       12.87       53.61
              biodad |    551,166        9.90       63.51
           stepchild |    148,102        2.66       66.17
             stepmom |     37,052        0.67       66.84
             stepdad |     66,921        1.20       68.04
          adoptchild |     45,087        0.81       68.85
            adoptmom |     12,271        0.22       69.07
            adoptdad |     12,608        0.23       69.30
                 mom |         32        0.00       69.30
                 dad |         32        0.00       69.30
              spouse |  1,122,184       20.16       89.46
          grandchild |    128,965        2.32       91.77
         grandparent |     55,723        1.00       92.78
             sibling |     50,561        0.91       93.68
             partner |     84,413        1.52       95.20
             f_child |      7,005        0.13       95.33
               child |         15        0.00       95.33
            f_parent |      1,523        0.03       95.35
           other_rel |    149,297        2.68       98.04
               norel |    107,890        1.94       99.97
                   . |      1,423        0.03      100.00
---------------------+-----------------------------------
               Total |  5,566,466      100.00

.         tab relationship2, m

                rel2 |      Freq.     Percent        Cum.
---------------------+-----------------------------------
            biochild |  1,267,495       22.77       22.77
              biomom |  1,299,572       23.35       46.12
              biodad |    968,295       17.40       63.51
           stepchild |    103,973        1.87       65.38
             stepmom |     43,851        0.79       66.17
             stepdad |    104,251        1.87       68.04
          adoptchild |     24,879        0.45       68.49
            adoptmom |     22,793        0.41       68.90
            adoptdad |     22,294        0.40       69.30
                 mom |          6        0.00       69.30
                 dad |          9        0.00       69.30
              spouse |  1,122,184       20.16       89.46
          grandchild |     55,723        1.00       90.46
         grandparent |    128,965        2.32       92.78
             sibling |     50,561        0.91       93.68
             partner |     84,413        1.52       95.20
             f_child |      1,523        0.03       95.23
               child |         64        0.00       95.23
            f_parent |      7,005        0.13       95.35
           other_rel |    149,297        2.68       98.04
               norel |    107,890        1.94       99.97
                   . |      1,423        0.03      100.00
---------------------+-----------------------------------
               Total |  5,566,466      100.00

.         
.         * Flag records where we already know relationship of A to C.
.         * Using data is pairs for which we already know the relationship
.         merge m:1 ssuid shhadid swave relfrom relto using "$tempdir/relationships_tc0_wide"
(label relationship already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                     4,164,656
        from master                 3,573,770  (_merge==1)
        from using                    590,886  (_merge==2)

    matched                         1,992,696  (_merge==3)
    -----------------------------------------

. 
.         *drop  cases in base_relationships not matched in joinby data because they are in two-person households 
.         * and thus can never have an intermediated relationship
.         drop if _merge==2
(590,886 observations deleted)

. 
.     * We don't keep (or validate correctness of) relationship of self to self.
.         * Note that this effectively restricts the joinby data to households with 3 or more people.
.     display "Dropping self-relationships"
Dropping self-relationships

.     drop if (relfrom == relto)
(2,196,224 observations deleted)

.         
.         gen already_known=0 

.         replace already_known=1 if _merge==3
(1,992,696 real changes made)

.         drop _merge

.         
.         display "Is the relationship already known?"
Is the relationship already known?

.         tab already_known

already_kno |
         wn |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |  1,377,546       40.87       40.87
          1 |  1,992,696       59.13      100.00
------------+-----------------------------------
      Total |  3,370,242      100.00

.         
.         *drop if we already have a relationship type for the pair
.         keep if already_known==0
(1,992,696 observations deleted)

.         drop relationship reason numrels_tc0

.         
.     display "Tab of A -- > B and B --> C relationships, where we are trying to find A --> C, rowsort"
Tab of A -- > B and B --> C relationships, where we are trying to find A --> C, rowsort

.     tab relationship1 relationship2, rowsort m

                     |                                                                                 rel2
                rel1 |  biochild     biomom     biodad  stepchild    stepmom    stepdad  adoptchil   adoptmom   adoptdad     spouse  grandpare    sibling    partner      child   f_parent |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
            biochild |    13,605    527,420    370,836      9,306      8,786     19,290        141      3,449      3,717         40     16,463      5,913      6,767         23      1,384 | 1,020,021 
          grandchild |        10     11,147      5,316        414        328        517          0        324        192     14,507     33,792        464        699          3         55 |    73,242 
           stepchild |       527      8,786     19,290        335      5,926     20,316          1        170        429         10        845        261        328          0        123 |    60,044 
           other_rel |       404     11,747      9,868      1,424        620      1,286          0        145        180      9,307      3,671      2,417        696          4         97 |    56,521 
               norel |        51      6,428      4,705        328        231        542          0        242        105      4,105      1,791      1,050      1,356          1        185 |    39,452 
              spouse |     2,608         19         21      3,582          0         10         41          0          0          0     14,507      2,296          0          6      1,098 |    37,610 
          adoptchild |        51      3,449      3,717        103        170        429          0      5,600      4,924          0        516         60        129          0        572 |    20,392 
             sibling |         0      4,267      1,646          0        110        151          0         60          0      2,296        464      4,692        496          0          2 |    17,671 
              biomom |     1,129      6,680      2,453         87        243         86          1         19         24      1,826         10          0         38          0          1 |    13,052 
             partner |        38      5,390      1,377        288        188        140          0         96         33          0        699        496          0          0        114 |    10,911 
             stepmom |         7      4,359      1,408          4        124        140          0         12         73      2,419        351          0        185          6          6 |    10,086 
              biodad |     1,129      3,547        925          7         49        149          0          2          6        782          0          0          0          0          0 |     6,597 
             stepdad |        87      2,196      1,343          4         39         32          0         12          6      1,163         63          0        103          6          3 |     5,829 
             f_child |         1        702        682          9         67         56          0        452        120      1,098         55          2        114          0      1,842 |     5,482 
                   . |         1         30        103         12          3         15          0          0          0         10         12         20          0          0          0 |       403 
            adoptdad |         1         91          4          0          0          0          0          0          0         27          0          0          0          0          0 |       123 
            adoptmom |         0         29         17          0          1          0          0          0          0         14          0          0          0          0          0 |        61 
                 mom |         0          8          3          6          0          0          0          0          0          3          3          0          0          0          0 |        26 
                 dad |         0          0         12          6          0          0          0          0          0          3          0          0          0          0          0 |        23 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    19,649    596,295    423,726     15,915     16,885     43,159        184     10,583      9,809     37,610     73,242     17,671     10,911         49      5,482 | 1,377,546 


                     |               rel2
                rel1 | other_rel      norel          . |     Total
---------------------+---------------------------------+----------
            biochild |    21,615     11,133        133 | 1,020,021 
          grandchild |     3,671      1,791         12 |    73,242 
           stepchild |     1,906        773         18 |    60,044 
           other_rel |    12,292      2,288         75 |    56,521 
               norel |     2,288     16,024         20 |    39,452 
              spouse |     9,307      4,105         10 |    37,610 
          adoptchild |       325        347          0 |    20,392 
             sibling |     2,417      1,050         20 |    17,671 
              biomom |       403         51          1 |    13,052 
             partner |       696      1,356          0 |    10,911 
             stepmom |       780        201         11 |    10,086 
              biodad |         1          0          0 |     6,597 
             stepdad |       644        127          1 |     5,829 
             f_child |        97        185          0 |     5,482 
                   . |        75         20        102 |       403 
            adoptdad |         0          0          0 |       123 
            adoptmom |         0          0          0 |        61 
                 mom |         2          1          0 |        26 
                 dad |         2          0          0 |        23 
---------------------+---------------------------------+----------
               Total |    56,521     39,452        403 | 1,377,546 

. 
.     * Now given the A --> B --> C relationships, what can we figure out for A --> C?
.     gen relationship = .
(1,377,546 missing values generated)

.     label values relationship relationship

. 
.     local all_child_types CHILD BIOCHILD STEPCHILD ADOPTCHILD

.     local all_parent_types MOM BIOMOM STEPMOM ADOPTMOM DAD BIODAD STEPDAD ADOPTDAD PARENT

. 
. foreach rel1 in `all_child_types' {
  2.   *read as set generate_relationship equal to CHILD if rel1 is any of the child types and rel2 is SPOUSE
.   generate_relationship "CHILD"                                 "`rel1'"        "SPOUSE"
  3.   generate_relationship "CHILD"                                 "`rel1'"        "PARTNER"
  4.   generate_relationship "GREATGRANDCHILD"               "`rel1'"        "GRANDCHILD"
  5.   generate_relationship "AUNTUNCLE_OR_PARENT"   "`rel1'"        "GRANDPARENT"
  6.   generate_relationship "NEPHEWNIECE"                   "`rel1'"        "SIBLING"
  7.   generate_relationship "COUSIN"                                "`rel1'"        "AUNTUNCLE"
  8.   generate_relationship "OTHER_REL"                     "SPOUSE"        "`rel1'" 
  9.   generate_relationship "OTHER_REL_P"                   "PARTNER"       "`rel1'" 
 10.   
.   foreach rel2 in `all_child_types' {
 11.      generate_relationship "GRANDCHILD"                 "`rel1'"        "`rel2'"
 12.   }
 13.   
.   foreach rel2 in `all_parent_types' {
 14.      generate_relationship "SIBLING"                    "`rel1'"        "`rel2'"
 15.   }
 16. 
.   generate_relationship "OTHER_REL"                     "`rel1'"        "OTHER_REL"
 17.   generate_relationship "OTHER_REL"                     "OTHER_REL" "`rel1'" 
 18.   generate_relationship "NOREL"                                 "`rel1'"        "NOREL"
 19.   generate_relationship "NOREL"                                 "NOREL"         "`rel1'" 
 20.   generate_relationship "F_SIB"                                 "`rel1'"        "F_CHILD"
 21.   generate_relationship "F_SIB"                                 "F_CHILD"       "`rel1'"
 22.   generate_relationship "F_SIB"                                 "`rel1'"        "F_PARENT"
 23. }
Generating CHILD from CHILD SPOUSE
(value label dereference "CHILD":relationship not found)
(value label dereference "CHILD":relationship not found)
(value label dereference "SPOUSE":relationship not found)
(0 real changes made)
(value label dereference "CHILD":relationship not found)
(value label dereference "CHILD":relationship not found)
(value label dereference "SPOUSE":relationship not found)
relationship not found in one of:  CHILD CHILD SPOUSE
r(111);

end of do-file

r(111);

. clear

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. //==============================================================================
. //=========== Children's Household Instability Project                                  
. //=========== Dataset: SIPP2008                                                 
. //=========== Purpose: Uses programs to compute relationships not 
. //=========== directly identifiable with parent pointers, spouse pointer, or ERRP  
. //================================================================================
. 
. ********************************************************************************
. **  Section: programs to process data to identify relationships transitively
. ********************************************************************************
. 
. * Program generates relationship from relationship1 and relatiosnhip2, 
. * where A is [relationship1] of person B.
. * Person B is [relationship2] of person C.
. * Therefore ego is [relationship] or [result_rel] of person C.
. capture program drop generate_relationship

. program define generate_relationship
  1.     args result_rel rel1 rel2 /* local macros: result_rel rel1 rels */
  2.     display "Generating `result_rel' from `rel1' `rel2'"
  3.     replace relationship = "`result_rel'":relationship if ((relationship1 == "`rel1'":relationship) & (relationship2 == "`rel2'":relationship))
  4.         *if any relationship is missing:
.     if (("`result_rel'":relationship == .) | ("`rel1'":relationship == .) | ("`rel2'":relationship == .)) {
  5.         display as error "relationship not found in one of:  `result_rel' `rel1' `rel2'"
  6.         exit 111
  7.     }
  8. end

. 
. * Program to make lists of values associated with each relationship type
. * For example, moms can be biomoms, stepmoms, adoptive moms, or moms.  
. capture program drop make_relationship_list

. program define make_relationship_list, rclass /* results are in r() vector */
  1.     * display `"make_relationship_list args:  `0'"'
.     local max_rel = "`1'":relationship
  2.     local my_rel_list "`max_rel'"
  3.     * display "first rel:  `my_rel_list'"
.     if (`max_rel' == .) {
  4.         display as error "relationship not found:  `my_rel_list' `max_rel' `1'"
  5.         exit 111
  6.     }
  7.     local i = 2
  8.     while ("``i''" != "") {
  9.         * display "next rel:  ``i''"
.         local rel_num = "``i''":relationship
 10.         if (`rel_num' == .) {
 11.             display as error "relationship not found:  `my_rel_list' `max_rel' ``i''"
 12.             exit 111
 13.         }
 14.         * display "next rel:  ``i''  `rel_num'"
.         if (`rel_num' < `max_rel') {
 15.             display as error "relationships out of order in make_relationship_list:  `my_rel_list' `max_rel' `rel_num'"
 16.             exit 111
 17.         }
 18.         local max_rel = `rel_num'
 19.         local my_rel_list "`my_rel_list',`rel_num'"
 20.         * display "new rel list:  `my_rel_list'  max: `max_rel'"
.         local ++i
 21.     }
 22.     return local rel_list `"`my_rel_list'"'
 23. end

. 
. ********************************************************************************
. **  Section: apply programs to data to identify relationships bewteen ego and
. **  every other person in ego's household in the wave.
. ********************************************************************************
. 
.     use "$tempdir/relationships_tc0_wide"

. 
.     * We're going to create a dataset that has all the transitive relationships we can find.  So, if we have A --> B and B --> C
.     * we generate a dataset that tells us A --> B --> C by joining on B.
.     rename relfrom intermediate_person

.     rename relationship relationship2

.     rename reason reason2

.     label variable relationship2 "rel2"

.     label variable reason2 "reason2"

.     tempfile relmerge

.     save `relmerge'
file C:\Users\Joanna\AppData\Local\Temp\ST_3f6c_000001.tmp saved

. 
. 
.     use "$tempdir/relationships_tc0_wide"

.     rename relto intermediate_person

.     rename relationship relationship1

.     rename reason reason1

.     label variable relationship1 "rel1"

.     label variable reason1 "reason1"

.         
.         tab relationship1, m

                rel1 |      Freq.     Percent        Cum.
---------------------+-----------------------------------
            biochild |    661,315       30.11       30.11
              biomom |    387,136       17.63       47.74
              biodad |    274,179       12.48       60.22
           stepchild |     47,022        2.14       62.36
             stepmom |     16,676        0.76       63.12
             stepdad |     30,346        1.38       64.50
          adoptchild |     12,988        0.59       65.10
            adoptmom |      6,740        0.31       65.40
            adoptdad |      6,248        0.28       65.69
                 mom |          6        0.00       65.69
                 dad |          6        0.00       65.69
              spouse |    516,182       23.50       89.19
          grandchild |     31,181        1.42       90.61
         grandparent |     31,181        1.42       92.03
             sibling |     21,962        1.00       93.03
             partner |     47,196        2.15       95.18
             f_child |      1,523        0.07       95.25
               child |         12        0.00       95.25
            f_parent |      1,523        0.07       95.32
           other_rel |     50,006        2.28       97.60
               norel |     52,382        2.39       99.98
                   . |        414        0.02      100.00
---------------------+-----------------------------------
               Total |  2,196,224      100.00

.         
.     * Joinby creates a record for every combination of records matching 
.         * ssuid shhadid swave and intermediate_person in the two files.
.     joinby ssuid shhadid swave intermediate_person using `relmerge'

. 
.         tab relationship1, m

                rel1 |      Freq.     Percent        Cum.
---------------------+-----------------------------------
            biochild |  2,267,867       40.74       40.74
              biomom |    716,329       12.87       53.61
              biodad |    551,166        9.90       63.51
           stepchild |    148,102        2.66       66.17
             stepmom |     37,052        0.67       66.84
             stepdad |     66,921        1.20       68.04
          adoptchild |     45,087        0.81       68.85
            adoptmom |     12,271        0.22       69.07
            adoptdad |     12,608        0.23       69.30
                 mom |         32        0.00       69.30
                 dad |         32        0.00       69.30
              spouse |  1,122,184       20.16       89.46
          grandchild |    128,965        2.32       91.77
         grandparent |     55,723        1.00       92.78
             sibling |     50,561        0.91       93.68
             partner |     84,413        1.52       95.20
             f_child |      7,005        0.13       95.33
               child |         15        0.00       95.33
            f_parent |      1,523        0.03       95.35
           other_rel |    149,297        2.68       98.04
               norel |    107,890        1.94       99.97
                   . |      1,423        0.03      100.00
---------------------+-----------------------------------
               Total |  5,566,466      100.00

.         tab relationship2, m

                rel2 |      Freq.     Percent        Cum.
---------------------+-----------------------------------
            biochild |  1,267,495       22.77       22.77
              biomom |  1,299,572       23.35       46.12
              biodad |    968,295       17.40       63.51
           stepchild |    103,973        1.87       65.38
             stepmom |     43,851        0.79       66.17
             stepdad |    104,251        1.87       68.04
          adoptchild |     24,879        0.45       68.49
            adoptmom |     22,793        0.41       68.90
            adoptdad |     22,294        0.40       69.30
                 mom |          6        0.00       69.30
                 dad |          9        0.00       69.30
              spouse |  1,122,184       20.16       89.46
          grandchild |     55,723        1.00       90.46
         grandparent |    128,965        2.32       92.78
             sibling |     50,561        0.91       93.68
             partner |     84,413        1.52       95.20
             f_child |      1,523        0.03       95.23
               child |         64        0.00       95.23
            f_parent |      7,005        0.13       95.35
           other_rel |    149,297        2.68       98.04
               norel |    107,890        1.94       99.97
                   . |      1,423        0.03      100.00
---------------------+-----------------------------------
               Total |  5,566,466      100.00

.         
.         * Flag records where we already know relationship of A to C.
.         * Using data is pairs for which we already know the relationship
.         merge m:1 ssuid shhadid swave relfrom relto using "$tempdir/relationships_tc0_wide"
(label relationship already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                     4,164,656
        from master                 3,573,770  (_merge==1)
        from using                    590,886  (_merge==2)

    matched                         1,992,696  (_merge==3)
    -----------------------------------------

. 
.         *drop  cases in base_relationships not matched in joinby data because they are in two-person households 
.         * and thus can never have an intermediated relationship
.         drop if _merge==2
(590,886 observations deleted)

. 
.     * We don't keep (or validate correctness of) relationship of self to self.
.         * Note that this effectively restricts the joinby data to households with 3 or more people.
.     display "Dropping self-relationships"
Dropping self-relationships

.     drop if (relfrom == relto)
(2,196,224 observations deleted)

.         
.         gen already_known=0 

.         replace already_known=1 if _merge==3
(1,992,696 real changes made)

.         drop _merge

.         
.         display "Is the relationship already known?"
Is the relationship already known?

.         tab already_known

already_kno |
         wn |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |  1,377,546       40.87       40.87
          1 |  1,992,696       59.13      100.00
------------+-----------------------------------
      Total |  3,370,242      100.00

.         
.         *drop if we already have a relationship type for the pair
.         keep if already_known==0
(1,992,696 observations deleted)

.         drop relationship reason numrels_tc0

.         
.     display "Tab of A -- > B and B --> C relationships, where we are trying to find A --> C, rowsort"
Tab of A -- > B and B --> C relationships, where we are trying to find A --> C, rowsort

.     tab relationship1 relationship2, rowsort m

                     |                                                                                 rel2
                rel1 |  biochild     biomom     biodad  stepchild    stepmom    stepdad  adoptchil   adoptmom   adoptdad     spouse  grandpare    sibling    partner      child   f_parent |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
            biochild |    13,605    527,420    370,836      9,306      8,786     19,290        141      3,449      3,717         40     16,463      5,913      6,767         23      1,384 | 1,020,021 
          grandchild |        10     11,147      5,316        414        328        517          0        324        192     14,507     33,792        464        699          3         55 |    73,242 
           stepchild |       527      8,786     19,290        335      5,926     20,316          1        170        429         10        845        261        328          0        123 |    60,044 
           other_rel |       404     11,747      9,868      1,424        620      1,286          0        145        180      9,307      3,671      2,417        696          4         97 |    56,521 
               norel |        51      6,428      4,705        328        231        542          0        242        105      4,105      1,791      1,050      1,356          1        185 |    39,452 
              spouse |     2,608         19         21      3,582          0         10         41          0          0          0     14,507      2,296          0          6      1,098 |    37,610 
          adoptchild |        51      3,449      3,717        103        170        429          0      5,600      4,924          0        516         60        129          0        572 |    20,392 
             sibling |         0      4,267      1,646          0        110        151          0         60          0      2,296        464      4,692        496          0          2 |    17,671 
              biomom |     1,129      6,680      2,453         87        243         86          1         19         24      1,826         10          0         38          0          1 |    13,052 
             partner |        38      5,390      1,377        288        188        140          0         96         33          0        699        496          0          0        114 |    10,911 
             stepmom |         7      4,359      1,408          4        124        140          0         12         73      2,419        351          0        185          6          6 |    10,086 
              biodad |     1,129      3,547        925          7         49        149          0          2          6        782          0          0          0          0          0 |     6,597 
             stepdad |        87      2,196      1,343          4         39         32          0         12          6      1,163         63          0        103          6          3 |     5,829 
             f_child |         1        702        682          9         67         56          0        452        120      1,098         55          2        114          0      1,842 |     5,482 
                   . |         1         30        103         12          3         15          0          0          0         10         12         20          0          0          0 |       403 
            adoptdad |         1         91          4          0          0          0          0          0          0         27          0          0          0          0          0 |       123 
            adoptmom |         0         29         17          0          1          0          0          0          0         14          0          0          0          0          0 |        61 
                 mom |         0          8          3          6          0          0          0          0          0          3          3          0          0          0          0 |        26 
                 dad |         0          0         12          6          0          0          0          0          0          3          0          0          0          0          0 |        23 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    19,649    596,295    423,726     15,915     16,885     43,159        184     10,583      9,809     37,610     73,242     17,671     10,911         49      5,482 | 1,377,546 


                     |               rel2
                rel1 | other_rel      norel          . |     Total
---------------------+---------------------------------+----------
            biochild |    21,615     11,133        133 | 1,020,021 
          grandchild |     3,671      1,791         12 |    73,242 
           stepchild |     1,906        773         18 |    60,044 
           other_rel |    12,292      2,288         75 |    56,521 
               norel |     2,288     16,024         20 |    39,452 
              spouse |     9,307      4,105         10 |    37,610 
          adoptchild |       325        347          0 |    20,392 
             sibling |     2,417      1,050         20 |    17,671 
              biomom |       403         51          1 |    13,052 
             partner |       696      1,356          0 |    10,911 
             stepmom |       780        201         11 |    10,086 
              biodad |         1          0          0 |     6,597 
             stepdad |       644        127          1 |     5,829 
             f_child |        97        185          0 |     5,482 
                   . |        75         20        102 |       403 
            adoptdad |         0          0          0 |       123 
            adoptmom |         0          0          0 |        61 
                 mom |         2          1          0 |        26 
                 dad |         2          0          0 |        23 
---------------------+---------------------------------+----------
               Total |    56,521     39,452        403 | 1,377,546 

. 
.     * Now given the A --> B --> C relationships, what can we figure out for A --> C?
.     gen relationship = .
(1,377,546 missing values generated)

.     label values relationship relationship

. 
.     local all_child_types child biochild stepchild adoptchild

.     local all_parent_types MOM biomom stepmom adoptmom dad biodad stepdad adoptdad parent

. 
. foreach rel1 in `all_child_types' {
  2.   *read as set generate_relationship equal to child if rel1 is any of the child types and rel2 is spouse
.   generate_relationship "child"                                 "`rel1'"        "spouse"
  3.   generate_relationship "child"                                 "`rel1'"        "partner"
  4.   generate_relationship "greatgrandchild"               "`rel1'"        "grandchild"
  5.   generate_relationship "auntuncle_or_parent"   "`rel1'"        "grandparent"
  6.   generate_relationship "nephewniece"                   "`rel1'"        "sibling"
  7.   generate_relationship "cousin"                                "`rel1'"        "auntuncle"
  8.   generate_relationship "other_rel"                     "spouse"        "`rel1'" 
  9.   generate_relationship "other_rel_p"                   "partner"       "`rel1'" 
 10.   
.   foreach rel2 in `all_child_types' {
 11.      generate_relationship "grandchild"                 "`rel1'"        "`rel2'"
 12.   }
 13.   
.   foreach rel2 in `all_parent_types' {
 14.      generate_relationship "sibling"                    "`rel1'"        "`rel2'"
 15.   }
 16. 
.   generate_relationship "other_rel"                     "`rel1'"        "other_rel"
 17.   generate_relationship "other_rel"                     "other_rel" "`rel1'" 
 18.   generate_relationship "norel"                                 "`rel1'"        "norel"
 19.   generate_relationship "norel"                                 "norel"         "`rel1'" 
 20.   generate_relationship "F_SIB"                                 "`rel1'"        "f_child"
 21.   generate_relationship "F_SIB"                                 "f_child"       "`rel1'"
 22.   generate_relationship "F_SIB"                                 "`rel1'"        "f_parent"
 23. }
Generating child from child spouse
(0 real changes made)
Generating child from child partner
(0 real changes made)
Generating greatgrandchild from child grandchild
(0 real changes made)
Generating auntuncle_or_parent from child grandparent
(0 real changes made)
Generating nephewniece from child sibling
(0 real changes made)
Generating cousin from child auntuncle
(0 real changes made)
Generating other_rel from spouse child
(6 real changes made)
Generating other_rel_p from partner child
(0 real changes made)
Generating grandchild from child child
(0 real changes made)
Generating grandchild from child biochild
(0 real changes made)
Generating grandchild from child stepchild
(0 real changes made)
Generating grandchild from child adoptchild
(0 real changes made)
Generating sibling from child MOM
(value label dereference "MOM":relationship not found)
(0 real changes made)
(value label dereference "MOM":relationship not found)
relationship not found in one of:  sibling child MOM
r(111);

end of do-file

r(111);

. clear

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. //==============================================================================
. //=========== Children's Household Instability Project                                  
. //=========== Dataset: SIPP2008                                                 
. //=========== Purpose: Uses programs to compute relationships not 
. //=========== directly identifiable with parent pointers, spouse pointer, or ERRP  
. //================================================================================
. 
. ********************************************************************************
. **  Section: programs to process data to identify relationships transitively
. ********************************************************************************
. 
. * Program generates relationship from relationship1 and relatiosnhip2, 
. * where A is [relationship1] of person B.
. * Person B is [relationship2] of person C.
. * Therefore ego is [relationship] or [result_rel] of person C.
. capture program drop generate_relationship

. program define generate_relationship
  1.     args result_rel rel1 rel2 /* local macros: result_rel rel1 rels */
  2.     display "Generating `result_rel' from `rel1' `rel2'"
  3.     replace relationship = "`result_rel'":relationship if ((relationship1 == "`rel1'":relationship) & (relationship2 == "`rel2'":relationship))
  4.         *if any relationship is missing:
.     if (("`result_rel'":relationship == .) | ("`rel1'":relationship == .) | ("`rel2'":relationship == .)) {
  5.         display as error "relationship not found in one of:  `result_rel' `rel1' `rel2'"
  6.         exit 111
  7.     }
  8. end

. 
. * Program to make lists of values associated with each relationship type
. * For example, moms can be biomoms, stepmoms, adoptive moms, or moms.  
. capture program drop make_relationship_list

. program define make_relationship_list, rclass /* results are in r() vector */
  1.     * display `"make_relationship_list args:  `0'"'
.     local max_rel = "`1'":relationship
  2.     local my_rel_list "`max_rel'"
  3.     * display "first rel:  `my_rel_list'"
.     if (`max_rel' == .) {
  4.         display as error "relationship not found:  `my_rel_list' `max_rel' `1'"
  5.         exit 111
  6.     }
  7.     local i = 2
  8.     while ("``i''" != "") {
  9.         * display "next rel:  ``i''"
.         local rel_num = "``i''":relationship
 10.         if (`rel_num' == .) {
 11.             display as error "relationship not found:  `my_rel_list' `max_rel' ``i''"
 12.             exit 111
 13.         }
 14.         * display "next rel:  ``i''  `rel_num'"
.         if (`rel_num' < `max_rel') {
 15.             display as error "relationships out of order in make_relationship_list:  `my_rel_list' `max_rel' `rel_num'"
 16.             exit 111
 17.         }
 18.         local max_rel = `rel_num'
 19.         local my_rel_list "`my_rel_list',`rel_num'"
 20.         * display "new rel list:  `my_rel_list'  max: `max_rel'"
.         local ++i
 21.     }
 22.     return local rel_list `"`my_rel_list'"'
 23. end

. 
. ********************************************************************************
. **  Section: apply programs to data to identify relationships bewteen ego and
. **  every other person in ego's household in the wave.
. ********************************************************************************
. 
.     use "$tempdir/relationships_tc0_wide"

. 
.     * We're going to create a dataset that has all the transitive relationships we can find.  So, if we have A --> B and B --> C
.     * we generate a dataset that tells us A --> B --> C by joining on B.
.     rename relfrom intermediate_person

.     rename relationship relationship2

.     rename reason reason2

.     label variable relationship2 "rel2"

.     label variable reason2 "reason2"

.     tempfile relmerge

.     save `relmerge'
file C:\Users\Joanna\AppData\Local\Temp\ST_3f6c_000001.tmp saved

. 
. 
.     use "$tempdir/relationships_tc0_wide"

.     rename relto intermediate_person

.     rename relationship relationship1

.     rename reason reason1

.     label variable relationship1 "rel1"

.     label variable reason1 "reason1"

.         
.         tab relationship1, m

                rel1 |      Freq.     Percent        Cum.
---------------------+-----------------------------------
            biochild |    661,315       30.11       30.11
              biomom |    387,136       17.63       47.74
              biodad |    274,179       12.48       60.22
           stepchild |     47,022        2.14       62.36
             stepmom |     16,676        0.76       63.12
             stepdad |     30,346        1.38       64.50
          adoptchild |     12,988        0.59       65.10
            adoptmom |      6,740        0.31       65.40
            adoptdad |      6,248        0.28       65.69
                 mom |          6        0.00       65.69
                 dad |          6        0.00       65.69
              spouse |    516,182       23.50       89.19
          grandchild |     31,181        1.42       90.61
         grandparent |     31,181        1.42       92.03
             sibling |     21,962        1.00       93.03
             partner |     47,196        2.15       95.18
             f_child |      1,523        0.07       95.25
               child |         12        0.00       95.25
            f_parent |      1,523        0.07       95.32
           other_rel |     50,006        2.28       97.60
               norel |     52,382        2.39       99.98
                   . |        414        0.02      100.00
---------------------+-----------------------------------
               Total |  2,196,224      100.00

.         
.     * Joinby creates a record for every combination of records matching 
.         * ssuid shhadid swave and intermediate_person in the two files.
.     joinby ssuid shhadid swave intermediate_person using `relmerge'

. 
.         tab relationship1, m

                rel1 |      Freq.     Percent        Cum.
---------------------+-----------------------------------
            biochild |  2,267,867       40.74       40.74
              biomom |    716,329       12.87       53.61
              biodad |    551,166        9.90       63.51
           stepchild |    148,102        2.66       66.17
             stepmom |     37,052        0.67       66.84
             stepdad |     66,921        1.20       68.04
          adoptchild |     45,087        0.81       68.85
            adoptmom |     12,271        0.22       69.07
            adoptdad |     12,608        0.23       69.30
                 mom |         32        0.00       69.30
                 dad |         32        0.00       69.30
              spouse |  1,122,184       20.16       89.46
          grandchild |    128,965        2.32       91.77
         grandparent |     55,723        1.00       92.78
             sibling |     50,561        0.91       93.68
             partner |     84,413        1.52       95.20
             f_child |      7,005        0.13       95.33
               child |         15        0.00       95.33
            f_parent |      1,523        0.03       95.35
           other_rel |    149,297        2.68       98.04
               norel |    107,890        1.94       99.97
                   . |      1,423        0.03      100.00
---------------------+-----------------------------------
               Total |  5,566,466      100.00

.         tab relationship2, m

                rel2 |      Freq.     Percent        Cum.
---------------------+-----------------------------------
            biochild |  1,267,495       22.77       22.77
              biomom |  1,299,572       23.35       46.12
              biodad |    968,295       17.40       63.51
           stepchild |    103,973        1.87       65.38
             stepmom |     43,851        0.79       66.17
             stepdad |    104,251        1.87       68.04
          adoptchild |     24,879        0.45       68.49
            adoptmom |     22,793        0.41       68.90
            adoptdad |     22,294        0.40       69.30
                 mom |          6        0.00       69.30
                 dad |          9        0.00       69.30
              spouse |  1,122,184       20.16       89.46
          grandchild |     55,723        1.00       90.46
         grandparent |    128,965        2.32       92.78
             sibling |     50,561        0.91       93.68
             partner |     84,413        1.52       95.20
             f_child |      1,523        0.03       95.23
               child |         64        0.00       95.23
            f_parent |      7,005        0.13       95.35
           other_rel |    149,297        2.68       98.04
               norel |    107,890        1.94       99.97
                   . |      1,423        0.03      100.00
---------------------+-----------------------------------
               Total |  5,566,466      100.00

.         
.         * Flag records where we already know relationship of A to C.
.         * Using data is pairs for which we already know the relationship
.         merge m:1 ssuid shhadid swave relfrom relto using "$tempdir/relationships_tc0_wide"
(label relationship already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                     4,164,656
        from master                 3,573,770  (_merge==1)
        from using                    590,886  (_merge==2)

    matched                         1,992,696  (_merge==3)
    -----------------------------------------

. 
.         *drop  cases in base_relationships not matched in joinby data because they are in two-person households 
.         * and thus can never have an intermediated relationship
.         drop if _merge==2
(590,886 observations deleted)

. 
.     * We don't keep (or validate correctness of) relationship of self to self.
.         * Note that this effectively restricts the joinby data to households with 3 or more people.
.     display "Dropping self-relationships"
Dropping self-relationships

.     drop if (relfrom == relto)
(2,196,224 observations deleted)

.         
.         gen already_known=0 

.         replace already_known=1 if _merge==3
(1,992,696 real changes made)

.         drop _merge

.         
.         display "Is the relationship already known?"
Is the relationship already known?

.         tab already_known

already_kno |
         wn |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |  1,377,546       40.87       40.87
          1 |  1,992,696       59.13      100.00
------------+-----------------------------------
      Total |  3,370,242      100.00

.         
.         *drop if we already have a relationship type for the pair
.         keep if already_known==0
(1,992,696 observations deleted)

.         drop relationship reason numrels_tc0

.         
.     display "Tab of A -- > B and B --> C relationships, where we are trying to find A --> C, rowsort"
Tab of A -- > B and B --> C relationships, where we are trying to find A --> C, rowsort

.     tab relationship1 relationship2, rowsort m

                     |                                                                                 rel2
                rel1 |  biochild     biomom     biodad  stepchild    stepmom    stepdad  adoptchil   adoptmom   adoptdad     spouse  grandpare    sibling    partner      child   f_parent |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
            biochild |    13,605    527,420    370,836      9,306      8,786     19,290        141      3,449      3,717         40     16,463      5,913      6,767         23      1,384 | 1,020,021 
          grandchild |        10     11,147      5,316        414        328        517          0        324        192     14,507     33,792        464        699          3         55 |    73,242 
           stepchild |       527      8,786     19,290        335      5,926     20,316          1        170        429         10        845        261        328          0        123 |    60,044 
           other_rel |       404     11,747      9,868      1,424        620      1,286          0        145        180      9,307      3,671      2,417        696          4         97 |    56,521 
               norel |        51      6,428      4,705        328        231        542          0        242        105      4,105      1,791      1,050      1,356          1        185 |    39,452 
              spouse |     2,608         19         21      3,582          0         10         41          0          0          0     14,507      2,296          0          6      1,098 |    37,610 
          adoptchild |        51      3,449      3,717        103        170        429          0      5,600      4,924          0        516         60        129          0        572 |    20,392 
             sibling |         0      4,267      1,646          0        110        151          0         60          0      2,296        464      4,692        496          0          2 |    17,671 
              biomom |     1,129      6,680      2,453         87        243         86          1         19         24      1,826         10          0         38          0          1 |    13,052 
             partner |        38      5,390      1,377        288        188        140          0         96         33          0        699        496          0          0        114 |    10,911 
             stepmom |         7      4,359      1,408          4        124        140          0         12         73      2,419        351          0        185          6          6 |    10,086 
              biodad |     1,129      3,547        925          7         49        149          0          2          6        782          0          0          0          0          0 |     6,597 
             stepdad |        87      2,196      1,343          4         39         32          0         12          6      1,163         63          0        103          6          3 |     5,829 
             f_child |         1        702        682          9         67         56          0        452        120      1,098         55          2        114          0      1,842 |     5,482 
                   . |         1         30        103         12          3         15          0          0          0         10         12         20          0          0          0 |       403 
            adoptdad |         1         91          4          0          0          0          0          0          0         27          0          0          0          0          0 |       123 
            adoptmom |         0         29         17          0          1          0          0          0          0         14          0          0          0          0          0 |        61 
                 mom |         0          8          3          6          0          0          0          0          0          3          3          0          0          0          0 |        26 
                 dad |         0          0         12          6          0          0          0          0          0          3          0          0          0          0          0 |        23 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    19,649    596,295    423,726     15,915     16,885     43,159        184     10,583      9,809     37,610     73,242     17,671     10,911         49      5,482 | 1,377,546 


                     |               rel2
                rel1 | other_rel      norel          . |     Total
---------------------+---------------------------------+----------
            biochild |    21,615     11,133        133 | 1,020,021 
          grandchild |     3,671      1,791         12 |    73,242 
           stepchild |     1,906        773         18 |    60,044 
           other_rel |    12,292      2,288         75 |    56,521 
               norel |     2,288     16,024         20 |    39,452 
              spouse |     9,307      4,105         10 |    37,610 
          adoptchild |       325        347          0 |    20,392 
             sibling |     2,417      1,050         20 |    17,671 
              biomom |       403         51          1 |    13,052 
             partner |       696      1,356          0 |    10,911 
             stepmom |       780        201         11 |    10,086 
              biodad |         1          0          0 |     6,597 
             stepdad |       644        127          1 |     5,829 
             f_child |        97        185          0 |     5,482 
                   . |        75         20        102 |       403 
            adoptdad |         0          0          0 |       123 
            adoptmom |         0          0          0 |        61 
                 mom |         2          1          0 |        26 
                 dad |         2          0          0 |        23 
---------------------+---------------------------------+----------
               Total |    56,521     39,452        403 | 1,377,546 

. 
.     * Now given the A --> B --> C relationships, what can we figure out for A --> C?
.     gen relationship = .
(1,377,546 missing values generated)

.     label values relationship relationship

. 
.     local all_child_types child biochild stepchild adoptchild

.     local all_parent_types mom biomom stepmom adoptmom dad biodad stepdad adoptdad parent

. 
. foreach rel1 in `all_child_types' {
  2.   *read as set generate_relationship equal to child if rel1 is any of the child types and rel2 is spouse
.   generate_relationship "child"                                 "`rel1'"        "spouse"
  3.   generate_relationship "child"                                 "`rel1'"        "partner"
  4.   generate_relationship "greatgrandchild"               "`rel1'"        "grandchild"
  5.   generate_relationship "auntuncle_or_parent"   "`rel1'"        "grandparent"
  6.   generate_relationship "nephewniece"                   "`rel1'"        "sibling"
  7.   generate_relationship "cousin"                                "`rel1'"        "auntuncle"
  8.   generate_relationship "other_rel"                     "spouse"        "`rel1'" 
  9.   generate_relationship "other_rel_p"                   "partner"       "`rel1'" 
 10.   
.   foreach rel2 in `all_child_types' {
 11.      generate_relationship "grandchild"                 "`rel1'"        "`rel2'"
 12.   }
 13.   
.   foreach rel2 in `all_parent_types' {
 14.      generate_relationship "sibling"                    "`rel1'"        "`rel2'"
 15.   }
 16. 
.   generate_relationship "other_rel"                     "`rel1'"        "other_rel"
 17.   generate_relationship "other_rel"                     "other_rel" "`rel1'" 
 18.   generate_relationship "norel"                                 "`rel1'"        "norel"
 19.   generate_relationship "norel"                                 "norel"         "`rel1'" 
 20.   generate_relationship "F_SIB"                                 "`rel1'"        "f_child"
 21.   generate_relationship "F_SIB"                                 "f_child"       "`rel1'"
 22.   generate_relationship "F_SIB"                                 "`rel1'"        "f_parent"
 23. }
Generating child from child spouse
(0 real changes made)
Generating child from child partner
(0 real changes made)
Generating greatgrandchild from child grandchild
(0 real changes made)
Generating auntuncle_or_parent from child grandparent
(0 real changes made)
Generating nephewniece from child sibling
(0 real changes made)
Generating cousin from child auntuncle
(0 real changes made)
Generating other_rel from spouse child
(6 real changes made)
Generating other_rel_p from partner child
(0 real changes made)
Generating grandchild from child child
(0 real changes made)
Generating grandchild from child biochild
(0 real changes made)
Generating grandchild from child stepchild
(0 real changes made)
Generating grandchild from child adoptchild
(0 real changes made)
Generating sibling from child mom
(0 real changes made)
Generating sibling from child biomom
(0 real changes made)
Generating sibling from child stepmom
(0 real changes made)
Generating sibling from child adoptmom
(0 real changes made)
Generating sibling from child dad
(0 real changes made)
Generating sibling from child biodad
(0 real changes made)
Generating sibling from child stepdad
(0 real changes made)
Generating sibling from child adoptdad
(0 real changes made)
Generating sibling from child parent
(0 real changes made)
Generating other_rel from child other_rel
(0 real changes made)
Generating other_rel from other_rel child
(4 real changes made)
Generating norel from child norel
(0 real changes made)
Generating norel from norel child
(1 real change made)
Generating F_SIB from child f_child
(value label dereference "F_SIB":relationship not found)
(0 real changes made)
(value label dereference "F_SIB":relationship not found)
relationship not found in one of:  F_SIB child f_child
r(111);

end of do-file

r(111);

. clear

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. //==============================================================================
. //=========== Children's Household Instability Project                                  
. //=========== Dataset: SIPP2008                                                 
. //=========== Purpose: Uses programs to compute relationships not 
. //=========== directly identifiable with parent pointers, spouse pointer, or ERRP  
. //================================================================================
. 
. ********************************************************************************
. **  Section: programs to process data to identify relationships transitively
. ********************************************************************************
. 
. * Program generates relationship from relationship1 and relatiosnhip2, 
. * where A is [relationship1] of person B.
. * Person B is [relationship2] of person C.
. * Therefore ego is [relationship] or [result_rel] of person C.
. capture program drop generate_relationship

. program define generate_relationship
  1.     args result_rel rel1 rel2 /* local macros: result_rel rel1 rels */
  2.     display "Generating `result_rel' from `rel1' `rel2'"
  3.     replace relationship = "`result_rel'":relationship if ((relationship1 == "`rel1'":relationship) & (relationship2 == "`rel2'":relationship))
  4.         *if any relationship is missing:
.     if (("`result_rel'":relationship == .) | ("`rel1'":relationship == .) | ("`rel2'":relationship == .)) {
  5.         display as error "relationship not found in one of:  `result_rel' `rel1' `rel2'"
  6.         exit 111
  7.     }
  8. end

. 
. * Program to make lists of values associated with each relationship type
. * For example, moms can be biomoms, stepmoms, adoptive moms, or moms.  
. capture program drop make_relationship_list

. program define make_relationship_list, rclass /* results are in r() vector */
  1.     * display `"make_relationship_list args:  `0'"'
.     local max_rel = "`1'":relationship
  2.     local my_rel_list "`max_rel'"
  3.     * display "first rel:  `my_rel_list'"
.     if (`max_rel' == .) {
  4.         display as error "relationship not found:  `my_rel_list' `max_rel' `1'"
  5.         exit 111
  6.     }
  7.     local i = 2
  8.     while ("``i''" != "") {
  9.         * display "next rel:  ``i''"
.         local rel_num = "``i''":relationship
 10.         if (`rel_num' == .) {
 11.             display as error "relationship not found:  `my_rel_list' `max_rel' ``i''"
 12.             exit 111
 13.         }
 14.         * display "next rel:  ``i''  `rel_num'"
.         if (`rel_num' < `max_rel') {
 15.             display as error "relationships out of order in make_relationship_list:  `my_rel_list' `max_rel' `rel_num'"
 16.             exit 111
 17.         }
 18.         local max_rel = `rel_num'
 19.         local my_rel_list "`my_rel_list',`rel_num'"
 20.         * display "new rel list:  `my_rel_list'  max: `max_rel'"
.         local ++i
 21.     }
 22.     return local rel_list `"`my_rel_list'"'
 23. end

. 
. ********************************************************************************
. **  Section: apply programs to data to identify relationships bewteen ego and
. **  every other person in ego's household in the wave.
. ********************************************************************************
. 
.     use "$tempdir/relationships_tc0_wide"

. 
.     * We're going to create a dataset that has all the transitive relationships we can find.  So, if we have A --> B and B --> C
.     * we generate a dataset that tells us A --> B --> C by joining on B.
.     rename relfrom intermediate_person

.     rename relationship relationship2

.     rename reason reason2

.     label variable relationship2 "rel2"

.     label variable reason2 "reason2"

.     tempfile relmerge

.     save `relmerge'
file C:\Users\Joanna\AppData\Local\Temp\ST_3f6c_000001.tmp saved

. 
. 
.     use "$tempdir/relationships_tc0_wide"

.     rename relto intermediate_person

.     rename relationship relationship1

.     rename reason reason1

.     label variable relationship1 "rel1"

.     label variable reason1 "reason1"

.         
.         tab relationship1, m

                rel1 |      Freq.     Percent        Cum.
---------------------+-----------------------------------
            biochild |    661,315       30.11       30.11
              biomom |    387,136       17.63       47.74
              biodad |    274,179       12.48       60.22
           stepchild |     47,022        2.14       62.36
             stepmom |     16,676        0.76       63.12
             stepdad |     30,346        1.38       64.50
          adoptchild |     12,988        0.59       65.10
            adoptmom |      6,740        0.31       65.40
            adoptdad |      6,248        0.28       65.69
                 mom |          6        0.00       65.69
                 dad |          6        0.00       65.69
              spouse |    516,182       23.50       89.19
          grandchild |     31,181        1.42       90.61
         grandparent |     31,181        1.42       92.03
             sibling |     21,962        1.00       93.03
             partner |     47,196        2.15       95.18
             f_child |      1,523        0.07       95.25
               child |         12        0.00       95.25
            f_parent |      1,523        0.07       95.32
           other_rel |     50,006        2.28       97.60
               norel |     52,382        2.39       99.98
                   . |        414        0.02      100.00
---------------------+-----------------------------------
               Total |  2,196,224      100.00

.         
.     * Joinby creates a record for every combination of records matching 
.         * ssuid shhadid swave and intermediate_person in the two files.
.     joinby ssuid shhadid swave intermediate_person using `relmerge'

. 
.         tab relationship1, m

                rel1 |      Freq.     Percent        Cum.
---------------------+-----------------------------------
            biochild |  2,267,867       40.74       40.74
              biomom |    716,329       12.87       53.61
              biodad |    551,166        9.90       63.51
           stepchild |    148,102        2.66       66.17
             stepmom |     37,052        0.67       66.84
             stepdad |     66,921        1.20       68.04
          adoptchild |     45,087        0.81       68.85
            adoptmom |     12,271        0.22       69.07
            adoptdad |     12,608        0.23       69.30
                 mom |         32        0.00       69.30
                 dad |         32        0.00       69.30
              spouse |  1,122,184       20.16       89.46
          grandchild |    128,965        2.32       91.77
         grandparent |     55,723        1.00       92.78
             sibling |     50,561        0.91       93.68
             partner |     84,413        1.52       95.20
             f_child |      7,005        0.13       95.33
               child |         15        0.00       95.33
            f_parent |      1,523        0.03       95.35
           other_rel |    149,297        2.68       98.04
               norel |    107,890        1.94       99.97
                   . |      1,423        0.03      100.00
---------------------+-----------------------------------
               Total |  5,566,466      100.00

.         tab relationship2, m

                rel2 |      Freq.     Percent        Cum.
---------------------+-----------------------------------
            biochild |  1,267,495       22.77       22.77
              biomom |  1,299,572       23.35       46.12
              biodad |    968,295       17.40       63.51
           stepchild |    103,973        1.87       65.38
             stepmom |     43,851        0.79       66.17
             stepdad |    104,251        1.87       68.04
          adoptchild |     24,879        0.45       68.49
            adoptmom |     22,793        0.41       68.90
            adoptdad |     22,294        0.40       69.30
                 mom |          6        0.00       69.30
                 dad |          9        0.00       69.30
              spouse |  1,122,184       20.16       89.46
          grandchild |     55,723        1.00       90.46
         grandparent |    128,965        2.32       92.78
             sibling |     50,561        0.91       93.68
             partner |     84,413        1.52       95.20
             f_child |      1,523        0.03       95.23
               child |         64        0.00       95.23
            f_parent |      7,005        0.13       95.35
           other_rel |    149,297        2.68       98.04
               norel |    107,890        1.94       99.97
                   . |      1,423        0.03      100.00
---------------------+-----------------------------------
               Total |  5,566,466      100.00

.         
.         * Flag records where we already know relationship of A to C.
.         * Using data is pairs for which we already know the relationship
.         merge m:1 ssuid shhadid swave relfrom relto using "$tempdir/relationships_tc0_wide"
(label relationship already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                     4,164,656
        from master                 3,573,770  (_merge==1)
        from using                    590,886  (_merge==2)

    matched                         1,992,696  (_merge==3)
    -----------------------------------------

. 
.         *drop  cases in base_relationships not matched in joinby data because they are in two-person households 
.         * and thus can never have an intermediated relationship
.         drop if _merge==2
(590,886 observations deleted)

. 
.     * We don't keep (or validate correctness of) relationship of self to self.
.         * Note that this effectively restricts the joinby data to households with 3 or more people.
.     display "Dropping self-relationships"
Dropping self-relationships

.     drop if (relfrom == relto)
(2,196,224 observations deleted)

.         
.         gen already_known=0 

.         replace already_known=1 if _merge==3
(1,992,696 real changes made)

.         drop _merge

.         
.         display "Is the relationship already known?"
Is the relationship already known?

.         tab already_known

already_kno |
         wn |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |  1,377,546       40.87       40.87
          1 |  1,992,696       59.13      100.00
------------+-----------------------------------
      Total |  3,370,242      100.00

.         
.         *drop if we already have a relationship type for the pair
.         keep if already_known==0
(1,992,696 observations deleted)

.         drop relationship reason numrels_tc0

.         
.     display "Tab of A -- > B and B --> C relationships, where we are trying to find A --> C, rowsort"
Tab of A -- > B and B --> C relationships, where we are trying to find A --> C, rowsort

.     tab relationship1 relationship2, rowsort m

                     |                                                                                 rel2
                rel1 |  biochild     biomom     biodad  stepchild    stepmom    stepdad  adoptchil   adoptmom   adoptdad     spouse  grandpare    sibling    partner      child   f_parent |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
            biochild |    13,605    527,420    370,836      9,306      8,786     19,290        141      3,449      3,717         40     16,463      5,913      6,767         23      1,384 | 1,020,021 
          grandchild |        10     11,147      5,316        414        328        517          0        324        192     14,507     33,792        464        699          3         55 |    73,242 
           stepchild |       527      8,786     19,290        335      5,926     20,316          1        170        429         10        845        261        328          0        123 |    60,044 
           other_rel |       404     11,747      9,868      1,424        620      1,286          0        145        180      9,307      3,671      2,417        696          4         97 |    56,521 
               norel |        51      6,428      4,705        328        231        542          0        242        105      4,105      1,791      1,050      1,356          1        185 |    39,452 
              spouse |     2,608         19         21      3,582          0         10         41          0          0          0     14,507      2,296          0          6      1,098 |    37,610 
          adoptchild |        51      3,449      3,717        103        170        429          0      5,600      4,924          0        516         60        129          0        572 |    20,392 
             sibling |         0      4,267      1,646          0        110        151          0         60          0      2,296        464      4,692        496          0          2 |    17,671 
              biomom |     1,129      6,680      2,453         87        243         86          1         19         24      1,826         10          0         38          0          1 |    13,052 
             partner |        38      5,390      1,377        288        188        140          0         96         33          0        699        496          0          0        114 |    10,911 
             stepmom |         7      4,359      1,408          4        124        140          0         12         73      2,419        351          0        185          6          6 |    10,086 
              biodad |     1,129      3,547        925          7         49        149          0          2          6        782          0          0          0          0          0 |     6,597 
             stepdad |        87      2,196      1,343          4         39         32          0         12          6      1,163         63          0        103          6          3 |     5,829 
             f_child |         1        702        682          9         67         56          0        452        120      1,098         55          2        114          0      1,842 |     5,482 
                   . |         1         30        103         12          3         15          0          0          0         10         12         20          0          0          0 |       403 
            adoptdad |         1         91          4          0          0          0          0          0          0         27          0          0          0          0          0 |       123 
            adoptmom |         0         29         17          0          1          0          0          0          0         14          0          0          0          0          0 |        61 
                 mom |         0          8          3          6          0          0          0          0          0          3          3          0          0          0          0 |        26 
                 dad |         0          0         12          6          0          0          0          0          0          3          0          0          0          0          0 |        23 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    19,649    596,295    423,726     15,915     16,885     43,159        184     10,583      9,809     37,610     73,242     17,671     10,911         49      5,482 | 1,377,546 


                     |               rel2
                rel1 | other_rel      norel          . |     Total
---------------------+---------------------------------+----------
            biochild |    21,615     11,133        133 | 1,020,021 
          grandchild |     3,671      1,791         12 |    73,242 
           stepchild |     1,906        773         18 |    60,044 
           other_rel |    12,292      2,288         75 |    56,521 
               norel |     2,288     16,024         20 |    39,452 
              spouse |     9,307      4,105         10 |    37,610 
          adoptchild |       325        347          0 |    20,392 
             sibling |     2,417      1,050         20 |    17,671 
              biomom |       403         51          1 |    13,052 
             partner |       696      1,356          0 |    10,911 
             stepmom |       780        201         11 |    10,086 
              biodad |         1          0          0 |     6,597 
             stepdad |       644        127          1 |     5,829 
             f_child |        97        185          0 |     5,482 
                   . |        75         20        102 |       403 
            adoptdad |         0          0          0 |       123 
            adoptmom |         0          0          0 |        61 
                 mom |         2          1          0 |        26 
                 dad |         2          0          0 |        23 
---------------------+---------------------------------+----------
               Total |    56,521     39,452        403 | 1,377,546 

. 
.     * Now given the A --> B --> C relationships, what can we figure out for A --> C?
.     gen relationship = .
(1,377,546 missing values generated)

.     label values relationship relationship

. 
.     local all_child_types child biochild stepchild adoptchild

.     local all_parent_types mom biomom stepmom adoptmom dad biodad stepdad adoptdad parent

. 
. foreach rel1 in `all_child_types' {
  2.   *read as set generate_relationship equal to child if rel1 is any of the child types and rel2 is spouse
.   generate_relationship "child"                                 "`rel1'"        "spouse"
  3.   generate_relationship "child"                                 "`rel1'"        "partner"
  4.   generate_relationship "greatgrandchild"               "`rel1'"        "grandchild"
  5.   generate_relationship "auntuncle_or_parent"   "`rel1'"        "grandparent"
  6.   generate_relationship "nephewniece"                   "`rel1'"        "sibling"
  7.   generate_relationship "cousin"                                "`rel1'"        "auntuncle"
  8.   generate_relationship "other_rel"                     "spouse"        "`rel1'" 
  9.   generate_relationship "other_rel_p"                   "partner"       "`rel1'" 
 10.   
.   foreach rel2 in `all_child_types' {
 11.      generate_relationship "grandchild"                 "`rel1'"        "`rel2'"
 12.   }
 13.   
.   foreach rel2 in `all_parent_types' {
 14.      generate_relationship "sibling"                    "`rel1'"        "`rel2'"
 15.   }
 16. 
.   generate_relationship "other_rel"                     "`rel1'"        "other_rel"
 17.   generate_relationship "other_rel"                     "other_rel" "`rel1'" 
 18.   generate_relationship "norel"                                 "`rel1'"        "norel"
 19.   generate_relationship "norel"                                 "norel"         "`rel1'" 
 20.   generate_relationship "f_sib"                                 "`rel1'"        "f_child"
 21.   generate_relationship "f_sib"                                 "f_child"       "`rel1'"
 22.   generate_relationship "f_sib"                                 "`rel1'"        "f_parent"
 23. }
Generating child from child spouse
(0 real changes made)
Generating child from child partner
(0 real changes made)
Generating greatgrandchild from child grandchild
(0 real changes made)
Generating auntuncle_or_parent from child grandparent
(0 real changes made)
Generating nephewniece from child sibling
(0 real changes made)
Generating cousin from child auntuncle
(0 real changes made)
Generating other_rel from spouse child
(6 real changes made)
Generating other_rel_p from partner child
(0 real changes made)
Generating grandchild from child child
(0 real changes made)
Generating grandchild from child biochild
(0 real changes made)
Generating grandchild from child stepchild
(0 real changes made)
Generating grandchild from child adoptchild
(0 real changes made)
Generating sibling from child mom
(0 real changes made)
Generating sibling from child biomom
(0 real changes made)
Generating sibling from child stepmom
(0 real changes made)
Generating sibling from child adoptmom
(0 real changes made)
Generating sibling from child dad
(0 real changes made)
Generating sibling from child biodad
(0 real changes made)
Generating sibling from child stepdad
(0 real changes made)
Generating sibling from child adoptdad
(0 real changes made)
Generating sibling from child parent
(0 real changes made)
Generating other_rel from child other_rel
(0 real changes made)
Generating other_rel from other_rel child
(4 real changes made)
Generating norel from child norel
(0 real changes made)
Generating norel from norel child
(1 real change made)
Generating f_sib from child f_child
(0 real changes made)
Generating f_sib from f_child child
(0 real changes made)
Generating f_sib from child f_parent
(0 real changes made)
Generating child from biochild spouse
(40 real changes made)
Generating child from biochild partner
(6,767 real changes made)
Generating greatgrandchild from biochild grandchild
(0 real changes made)
Generating auntuncle_or_parent from biochild grandparent
(16,463 real changes made)
Generating nephewniece from biochild sibling
(5,913 real changes made)
Generating cousin from biochild auntuncle
(0 real changes made)
Generating other_rel from spouse biochild
(2,608 real changes made)
Generating other_rel_p from partner biochild
(38 real changes made)
Generating grandchild from biochild child
(23 real changes made)
Generating grandchild from biochild biochild
(13,605 real changes made)
Generating grandchild from biochild stepchild
(9,306 real changes made)
Generating grandchild from biochild adoptchild
(141 real changes made)
Generating sibling from biochild mom
(0 real changes made)
Generating sibling from biochild biomom
(527,420 real changes made)
Generating sibling from biochild stepmom
(8,786 real changes made)
Generating sibling from biochild adoptmom
(3,449 real changes made)
Generating sibling from biochild dad
(0 real changes made)
Generating sibling from biochild biodad
(370,836 real changes made)
Generating sibling from biochild stepdad
(19,290 real changes made)
Generating sibling from biochild adoptdad
(3,717 real changes made)
Generating sibling from biochild parent
(0 real changes made)
Generating other_rel from biochild other_rel
(21,615 real changes made)
Generating other_rel from other_rel biochild
(404 real changes made)
Generating norel from biochild norel
(11,133 real changes made)
Generating norel from norel biochild
(51 real changes made)
Generating f_sib from biochild f_child
(0 real changes made)
Generating f_sib from f_child biochild
(1 real change made)
Generating f_sib from biochild f_parent
(1,384 real changes made)
Generating child from stepchild spouse
(10 real changes made)
Generating child from stepchild partner
(328 real changes made)
Generating greatgrandchild from stepchild grandchild
(0 real changes made)
Generating auntuncle_or_parent from stepchild grandparent
(845 real changes made)
Generating nephewniece from stepchild sibling
(261 real changes made)
Generating cousin from stepchild auntuncle
(0 real changes made)
Generating other_rel from spouse stepchild
(3,582 real changes made)
Generating other_rel_p from partner stepchild
(288 real changes made)
Generating grandchild from stepchild child
(0 real changes made)
Generating grandchild from stepchild biochild
(527 real changes made)
Generating grandchild from stepchild stepchild
(335 real changes made)
Generating grandchild from stepchild adoptchild
(1 real change made)
Generating sibling from stepchild mom
(0 real changes made)
Generating sibling from stepchild biomom
(8,786 real changes made)
Generating sibling from stepchild stepmom
(5,926 real changes made)
Generating sibling from stepchild adoptmom
(170 real changes made)
Generating sibling from stepchild dad
(0 real changes made)
Generating sibling from stepchild biodad
(19,290 real changes made)
Generating sibling from stepchild stepdad
(20,316 real changes made)
Generating sibling from stepchild adoptdad
(429 real changes made)
Generating sibling from stepchild parent
(0 real changes made)
Generating other_rel from stepchild other_rel
(1,906 real changes made)
Generating other_rel from other_rel stepchild
(1,424 real changes made)
Generating norel from stepchild norel
(773 real changes made)
Generating norel from norel stepchild
(328 real changes made)
Generating f_sib from stepchild f_child
(0 real changes made)
Generating f_sib from f_child stepchild
(9 real changes made)
Generating f_sib from stepchild f_parent
(123 real changes made)
Generating child from adoptchild spouse
(0 real changes made)
Generating child from adoptchild partner
(129 real changes made)
Generating greatgrandchild from adoptchild grandchild
(0 real changes made)
Generating auntuncle_or_parent from adoptchild grandparent
(516 real changes made)
Generating nephewniece from adoptchild sibling
(60 real changes made)
Generating cousin from adoptchild auntuncle
(0 real changes made)
Generating other_rel from spouse adoptchild
(41 real changes made)
Generating other_rel_p from partner adoptchild
(0 real changes made)
Generating grandchild from adoptchild child
(0 real changes made)
Generating grandchild from adoptchild biochild
(51 real changes made)
Generating grandchild from adoptchild stepchild
(103 real changes made)
Generating grandchild from adoptchild adoptchild
(0 real changes made)
Generating sibling from adoptchild mom
(0 real changes made)
Generating sibling from adoptchild biomom
(3,449 real changes made)
Generating sibling from adoptchild stepmom
(170 real changes made)
Generating sibling from adoptchild adoptmom
(5,600 real changes made)
Generating sibling from adoptchild dad
(0 real changes made)
Generating sibling from adoptchild biodad
(3,717 real changes made)
Generating sibling from adoptchild stepdad
(429 real changes made)
Generating sibling from adoptchild adoptdad
(4,924 real changes made)
Generating sibling from adoptchild parent
(0 real changes made)
Generating other_rel from adoptchild other_rel
(325 real changes made)
Generating other_rel from other_rel adoptchild
(0 real changes made)
Generating norel from adoptchild norel
(347 real changes made)
Generating norel from norel adoptchild
(0 real changes made)
Generating f_sib from adoptchild f_child
(0 real changes made)
Generating f_sib from f_child adoptchild
(0 real changes made)
Generating f_sib from adoptchild f_parent
(572 real changes made)

. 
. foreach rel2 in `all_child_types' {
  2.   generate_relationship "greatgrandchild"               "grandchild" "`rel2'"
  3.   generate_relationship "parent" "sibling"              "`rel2'"
  4.   generate_relationship "parent_or_relative"    "grandparent" "`rel2'"
  5.   generate_relationship "f_sib" "f_child"               "`rel2'"
  6. }
Generating greatgrandchild from grandchild child
(3 real changes made)
Generating parent from sibling child
(0 real changes made)
Generating parent_or_relative from grandparent child
(0 real changes made)
Generating f_sib from f_child child
(0 real changes made)
Generating greatgrandchild from grandchild biochild
(10 real changes made)
Generating parent from sibling biochild
(0 real changes made)
Generating parent_or_relative from grandparent biochild
(0 real changes made)
Generating f_sib from f_child biochild
(0 real changes made)
Generating greatgrandchild from grandchild stepchild
(414 real changes made)
Generating parent from sibling stepchild
(0 real changes made)
Generating parent_or_relative from grandparent stepchild
(0 real changes made)
Generating f_sib from f_child stepchild
(0 real changes made)
Generating greatgrandchild from grandchild adoptchild
(0 real changes made)
Generating parent from sibling adoptchild
(0 real changes made)
Generating parent_or_relative from grandparent adoptchild
(0 real changes made)
Generating f_sib from f_child adoptchild
(0 real changes made)

. 
. foreach rel1 in `all_parent_types' {
  2.    foreach rel2 in `all_parent_types' {
  3.       generate_relationship "grandparent"               "`rel1'"        "`rel2'"
  4.    }
  5.    
.    * Should we call these partnerS?  Or something less certain?
.    foreach rel2 in `all_child_types' {
  6.       generate_relationship "partner"                   "`rel1'"        "`rel2'"
  7.    }
  8. 
.    generate_relationship "greatgrandparent"     "`rel1'"        "grandparent"
  9.    generate_relationship "parent"                               "`rel1'"        "sibling"
 10.    generate_relationship "child_or_relative"    "`rel1'"        "grandchild"
 11.    generate_relationship "other_rel"                    "`rel1'"        "spouse"
 12.    generate_relationship "other_rel_p"                  "`rel1'"        "partner"
 13.    generate_relationship "other_rel"                    "`rel1'"        "other_rel"
 14.    generate_relationship "other_rel"                    "other_rel" "`rel1'" 
 15. 
.    generate_relationship "norel"                                "`rel1'"        "norel"
 16.    generate_relationship "norel"                                "norel"         "`rel1'" 
 17. }
Generating grandparent from mom mom
(0 real changes made)
Generating grandparent from mom biomom
(8 real changes made)
Generating grandparent from mom stepmom
(0 real changes made)
Generating grandparent from mom adoptmom
(0 real changes made)
Generating grandparent from mom dad
(0 real changes made)
Generating grandparent from mom biodad
(3 real changes made)
Generating grandparent from mom stepdad
(0 real changes made)
Generating grandparent from mom adoptdad
(0 real changes made)
Generating grandparent from mom parent
(0 real changes made)
Generating partner from mom child
(0 real changes made)
Generating partner from mom biochild
(0 real changes made)
Generating partner from mom stepchild
(6 real changes made)
Generating partner from mom adoptchild
(0 real changes made)
Generating greatgrandparent from mom grandparent
(3 real changes made)
Generating parent from mom sibling
(0 real changes made)
Generating child_or_relative from mom grandchild
(0 real changes made)
Generating other_rel from mom spouse
(3 real changes made)
Generating other_rel_p from mom partner
(0 real changes made)
Generating other_rel from mom other_rel
(2 real changes made)
Generating other_rel from other_rel mom
(0 real changes made)
Generating norel from mom norel
(1 real change made)
Generating norel from norel mom
(0 real changes made)
Generating grandparent from biomom mom
(0 real changes made)
Generating grandparent from biomom biomom
(6,680 real changes made)
Generating grandparent from biomom stepmom
(243 real changes made)
Generating grandparent from biomom adoptmom
(19 real changes made)
Generating grandparent from biomom dad
(0 real changes made)
Generating grandparent from biomom biodad
(2,453 real changes made)
Generating grandparent from biomom stepdad
(86 real changes made)
Generating grandparent from biomom adoptdad
(24 real changes made)
Generating grandparent from biomom parent
(0 real changes made)
Generating partner from biomom child
(0 real changes made)
Generating partner from biomom biochild
(1,129 real changes made)
Generating partner from biomom stepchild
(87 real changes made)
Generating partner from biomom adoptchild
(1 real change made)
Generating greatgrandparent from biomom grandparent
(10 real changes made)
Generating parent from biomom sibling
(0 real changes made)
Generating child_or_relative from biomom grandchild
(0 real changes made)
Generating other_rel from biomom spouse
(1,826 real changes made)
Generating other_rel_p from biomom partner
(38 real changes made)
Generating other_rel from biomom other_rel
(403 real changes made)
Generating other_rel from other_rel biomom
(11,747 real changes made)
Generating norel from biomom norel
(51 real changes made)
Generating norel from norel biomom
(6,428 real changes made)
Generating grandparent from stepmom mom
(0 real changes made)
Generating grandparent from stepmom biomom
(4,359 real changes made)
Generating grandparent from stepmom stepmom
(124 real changes made)
Generating grandparent from stepmom adoptmom
(12 real changes made)
Generating grandparent from stepmom dad
(0 real changes made)
Generating grandparent from stepmom biodad
(1,408 real changes made)
Generating grandparent from stepmom stepdad
(140 real changes made)
Generating grandparent from stepmom adoptdad
(73 real changes made)
Generating grandparent from stepmom parent
(0 real changes made)
Generating partner from stepmom child
(6 real changes made)
Generating partner from stepmom biochild
(7 real changes made)
Generating partner from stepmom stepchild
(4 real changes made)
Generating partner from stepmom adoptchild
(0 real changes made)
Generating greatgrandparent from stepmom grandparent
(351 real changes made)
Generating parent from stepmom sibling
(0 real changes made)
Generating child_or_relative from stepmom grandchild
(0 real changes made)
Generating other_rel from stepmom spouse
(2,419 real changes made)
Generating other_rel_p from stepmom partner
(185 real changes made)
Generating other_rel from stepmom other_rel
(780 real changes made)
Generating other_rel from other_rel stepmom
(620 real changes made)
Generating norel from stepmom norel
(201 real changes made)
Generating norel from norel stepmom
(231 real changes made)
Generating grandparent from adoptmom mom
(0 real changes made)
Generating grandparent from adoptmom biomom
(29 real changes made)
Generating grandparent from adoptmom stepmom
(1 real change made)
Generating grandparent from adoptmom adoptmom
(0 real changes made)
Generating grandparent from adoptmom dad
(0 real changes made)
Generating grandparent from adoptmom biodad
(17 real changes made)
Generating grandparent from adoptmom stepdad
(0 real changes made)
Generating grandparent from adoptmom adoptdad
(0 real changes made)
Generating grandparent from adoptmom parent
(0 real changes made)
Generating partner from adoptmom child
(0 real changes made)
Generating partner from adoptmom biochild
(0 real changes made)
Generating partner from adoptmom stepchild
(0 real changes made)
Generating partner from adoptmom adoptchild
(0 real changes made)
Generating greatgrandparent from adoptmom grandparent
(0 real changes made)
Generating parent from adoptmom sibling
(0 real changes made)
Generating child_or_relative from adoptmom grandchild
(0 real changes made)
Generating other_rel from adoptmom spouse
(14 real changes made)
Generating other_rel_p from adoptmom partner
(0 real changes made)
Generating other_rel from adoptmom other_rel
(0 real changes made)
Generating other_rel from other_rel adoptmom
(145 real changes made)
Generating norel from adoptmom norel
(0 real changes made)
Generating norel from norel adoptmom
(242 real changes made)
Generating grandparent from dad mom
(0 real changes made)
Generating grandparent from dad biomom
(0 real changes made)
Generating grandparent from dad stepmom
(0 real changes made)
Generating grandparent from dad adoptmom
(0 real changes made)
Generating grandparent from dad dad
(0 real changes made)
Generating grandparent from dad biodad
(12 real changes made)
Generating grandparent from dad stepdad
(0 real changes made)
Generating grandparent from dad adoptdad
(0 real changes made)
Generating grandparent from dad parent
(0 real changes made)
Generating partner from dad child
(0 real changes made)
Generating partner from dad biochild
(0 real changes made)
Generating partner from dad stepchild
(6 real changes made)
Generating partner from dad adoptchild
(0 real changes made)
Generating greatgrandparent from dad grandparent
(0 real changes made)
Generating parent from dad sibling
(0 real changes made)
Generating child_or_relative from dad grandchild
(0 real changes made)
Generating other_rel from dad spouse
(3 real changes made)
Generating other_rel_p from dad partner
(0 real changes made)
Generating other_rel from dad other_rel
(2 real changes made)
Generating other_rel from other_rel dad
(0 real changes made)
Generating norel from dad norel
(0 real changes made)
Generating norel from norel dad
(0 real changes made)
Generating grandparent from biodad mom
(0 real changes made)
Generating grandparent from biodad biomom
(3,547 real changes made)
Generating grandparent from biodad stepmom
(49 real changes made)
Generating grandparent from biodad adoptmom
(2 real changes made)
Generating grandparent from biodad dad
(0 real changes made)
Generating grandparent from biodad biodad
(925 real changes made)
Generating grandparent from biodad stepdad
(149 real changes made)
Generating grandparent from biodad adoptdad
(6 real changes made)
Generating grandparent from biodad parent
(0 real changes made)
Generating partner from biodad child
(0 real changes made)
Generating partner from biodad biochild
(1,129 real changes made)
Generating partner from biodad stepchild
(7 real changes made)
Generating partner from biodad adoptchild
(0 real changes made)
Generating greatgrandparent from biodad grandparent
(0 real changes made)
Generating parent from biodad sibling
(0 real changes made)
Generating child_or_relative from biodad grandchild
(0 real changes made)
Generating other_rel from biodad spouse
(782 real changes made)
Generating other_rel_p from biodad partner
(0 real changes made)
Generating other_rel from biodad other_rel
(1 real change made)
Generating other_rel from other_rel biodad
(9,868 real changes made)
Generating norel from biodad norel
(0 real changes made)
Generating norel from norel biodad
(4,705 real changes made)
Generating grandparent from stepdad mom
(0 real changes made)
Generating grandparent from stepdad biomom
(2,196 real changes made)
Generating grandparent from stepdad stepmom
(39 real changes made)
Generating grandparent from stepdad adoptmom
(12 real changes made)
Generating grandparent from stepdad dad
(0 real changes made)
Generating grandparent from stepdad biodad
(1,343 real changes made)
Generating grandparent from stepdad stepdad
(32 real changes made)
Generating grandparent from stepdad adoptdad
(6 real changes made)
Generating grandparent from stepdad parent
(0 real changes made)
Generating partner from stepdad child
(6 real changes made)
Generating partner from stepdad biochild
(87 real changes made)
Generating partner from stepdad stepchild
(4 real changes made)
Generating partner from stepdad adoptchild
(0 real changes made)
Generating greatgrandparent from stepdad grandparent
(63 real changes made)
Generating parent from stepdad sibling
(0 real changes made)
Generating child_or_relative from stepdad grandchild
(0 real changes made)
Generating other_rel from stepdad spouse
(1,163 real changes made)
Generating other_rel_p from stepdad partner
(103 real changes made)
Generating other_rel from stepdad other_rel
(644 real changes made)
Generating other_rel from other_rel stepdad
(1,286 real changes made)
Generating norel from stepdad norel
(127 real changes made)
Generating norel from norel stepdad
(542 real changes made)
Generating grandparent from adoptdad mom
(0 real changes made)
Generating grandparent from adoptdad biomom
(91 real changes made)
Generating grandparent from adoptdad stepmom
(0 real changes made)
Generating grandparent from adoptdad adoptmom
(0 real changes made)
Generating grandparent from adoptdad dad
(0 real changes made)
Generating grandparent from adoptdad biodad
(4 real changes made)
Generating grandparent from adoptdad stepdad
(0 real changes made)
Generating grandparent from adoptdad adoptdad
(0 real changes made)
Generating grandparent from adoptdad parent
(0 real changes made)
Generating partner from adoptdad child
(0 real changes made)
Generating partner from adoptdad biochild
(1 real change made)
Generating partner from adoptdad stepchild
(0 real changes made)
Generating partner from adoptdad adoptchild
(0 real changes made)
Generating greatgrandparent from adoptdad grandparent
(0 real changes made)
Generating parent from adoptdad sibling
(0 real changes made)
Generating child_or_relative from adoptdad grandchild
(0 real changes made)
Generating other_rel from adoptdad spouse
(27 real changes made)
Generating other_rel_p from adoptdad partner
(0 real changes made)
Generating other_rel from adoptdad other_rel
(0 real changes made)
Generating other_rel from other_rel adoptdad
(180 real changes made)
Generating norel from adoptdad norel
(0 real changes made)
Generating norel from norel adoptdad
(105 real changes made)
Generating grandparent from parent mom
(0 real changes made)
Generating grandparent from parent biomom
(0 real changes made)
Generating grandparent from parent stepmom
(0 real changes made)
Generating grandparent from parent adoptmom
(0 real changes made)
Generating grandparent from parent dad
(0 real changes made)
Generating grandparent from parent biodad
(0 real changes made)
Generating grandparent from parent stepdad
(0 real changes made)
Generating grandparent from parent adoptdad
(0 real changes made)
Generating grandparent from parent parent
(0 real changes made)
Generating partner from parent child
(0 real changes made)
Generating partner from parent biochild
(0 real changes made)
Generating partner from parent stepchild
(0 real changes made)
Generating partner from parent adoptchild
(0 real changes made)
Generating greatgrandparent from parent grandparent
(0 real changes made)
Generating parent from parent sibling
(0 real changes made)
Generating child_or_relative from parent grandchild
(0 real changes made)
Generating other_rel from parent spouse
(0 real changes made)
Generating other_rel_p from parent partner
(0 real changes made)
Generating other_rel from parent other_rel
(0 real changes made)
Generating other_rel from other_rel parent
(0 real changes made)
Generating norel from parent norel
(0 real changes made)
Generating norel from norel parent
(0 real changes made)

. 
.     foreach rel2 in `all_parent_types' {
  2.         generate_relationship "parent"                  "spouse" "`rel2'"
  3.         generate_relationship "parent"                  "partner" "`rel2'"
  4. 
.         generate_relationship "auntuncle"               "sibling" "`rel2'"
  5. 
.         generate_relationship "child_or_nephewniece" "grandchild" "`rel2'"
  6. 
.         generate_relationship "greatgrandparent" "grandparent" "`rel2'"
  7. 
.         generate_relationship "norel"                   "f_child" "`rel2'"
  8.     }
Generating parent from spouse mom
(0 real changes made)
Generating parent from partner mom
(0 real changes made)
Generating auntuncle from sibling mom
(0 real changes made)
Generating child_or_nephewniece from grandchild mom
(0 real changes made)
Generating greatgrandparent from grandparent mom
(0 real changes made)
Generating norel from f_child mom
(0 real changes made)
Generating parent from spouse biomom
(19 real changes made)
Generating parent from partner biomom
(5,390 real changes made)
Generating auntuncle from sibling biomom
(4,267 real changes made)
Generating child_or_nephewniece from grandchild biomom
(11,147 real changes made)
Generating greatgrandparent from grandparent biomom
(0 real changes made)
Generating norel from f_child biomom
(702 real changes made)
Generating parent from spouse stepmom
(0 real changes made)
Generating parent from partner stepmom
(188 real changes made)
Generating auntuncle from sibling stepmom
(110 real changes made)
Generating child_or_nephewniece from grandchild stepmom
(328 real changes made)
Generating greatgrandparent from grandparent stepmom
(0 real changes made)
Generating norel from f_child stepmom
(67 real changes made)
Generating parent from spouse adoptmom
(0 real changes made)
Generating parent from partner adoptmom
(96 real changes made)
Generating auntuncle from sibling adoptmom
(60 real changes made)
Generating child_or_nephewniece from grandchild adoptmom
(324 real changes made)
Generating greatgrandparent from grandparent adoptmom
(0 real changes made)
Generating norel from f_child adoptmom
(452 real changes made)
Generating parent from spouse dad
(0 real changes made)
Generating parent from partner dad
(0 real changes made)
Generating auntuncle from sibling dad
(0 real changes made)
Generating child_or_nephewniece from grandchild dad
(0 real changes made)
Generating greatgrandparent from grandparent dad
(0 real changes made)
Generating norel from f_child dad
(0 real changes made)
Generating parent from spouse biodad
(21 real changes made)
Generating parent from partner biodad
(1,377 real changes made)
Generating auntuncle from sibling biodad
(1,646 real changes made)
Generating child_or_nephewniece from grandchild biodad
(5,316 real changes made)
Generating greatgrandparent from grandparent biodad
(0 real changes made)
Generating norel from f_child biodad
(682 real changes made)
Generating parent from spouse stepdad
(10 real changes made)
Generating parent from partner stepdad
(140 real changes made)
Generating auntuncle from sibling stepdad
(151 real changes made)
Generating child_or_nephewniece from grandchild stepdad
(517 real changes made)
Generating greatgrandparent from grandparent stepdad
(0 real changes made)
Generating norel from f_child stepdad
(56 real changes made)
Generating parent from spouse adoptdad
(0 real changes made)
Generating parent from partner adoptdad
(33 real changes made)
Generating auntuncle from sibling adoptdad
(0 real changes made)
Generating child_or_nephewniece from grandchild adoptdad
(192 real changes made)
Generating greatgrandparent from grandparent adoptdad
(0 real changes made)
Generating norel from f_child adoptdad
(120 real changes made)
Generating parent from spouse parent
(0 real changes made)
Generating parent from partner parent
(0 real changes made)
Generating auntuncle from sibling parent
(0 real changes made)
Generating child_or_nephewniece from grandchild parent
(0 real changes made)
Generating greatgrandparent from grandparent parent
(0 real changes made)
Generating norel from f_child parent
(0 real changes made)

. 
. *** rel1 == grandchild
. generate_relationship "grandchild"                              "grandchild" "spouse"
Generating grandchild from grandchild spouse
(14,507 real changes made)

. generate_relationship "grandchild_P"                    "grandchild" "partner"
Generating grandchild_P from grandchild partner
(value label dereference "grandchild_P":relationship not found)
(0 real changes made)
(value label dereference "grandchild_P":relationship not found)
relationship not found in one of:  grandchild_P grandchild partner
r(111);

end of do-file

r(111);

. clear

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. //==============================================================================
. //=========== Children's Household Instability Project                                  
. //=========== Dataset: SIPP2008                                                 
. //=========== Purpose: Uses programs to compute relationships not 
. //=========== directly identifiable with parent pointers, spouse pointer, or ERRP  
. //================================================================================
. 
. ********************************************************************************
. **  Section: programs to process data to identify relationships transitively
. ********************************************************************************
. 
. * Program generates relationship from relationship1 and relatiosnhip2, 
. * where A is [relationship1] of person B.
. * Person B is [relationship2] of person C.
. * Therefore ego is [relationship] or [result_rel] of person C.
. capture program drop generate_relationship

. program define generate_relationship
  1.     args result_rel rel1 rel2 /* local macros: result_rel rel1 rels */
  2.     display "Generating `result_rel' from `rel1' `rel2'"
  3.     replace relationship = "`result_rel'":relationship if ((relationship1 == "`rel1'":relationship) & (relationship2 == "`rel2'":relationship))
  4.         *if any relationship is missing:
.     if (("`result_rel'":relationship == .) | ("`rel1'":relationship == .) | ("`rel2'":relationship == .)) {
  5.         display as error "relationship not found in one of:  `result_rel' `rel1' `rel2'"
  6.         exit 111
  7.     }
  8. end

. 
. * Program to make lists of values associated with each relationship type
. * For example, moms can be biomoms, stepmoms, adoptive moms, or moms.  
. capture program drop make_relationship_list

. program define make_relationship_list, rclass /* results are in r() vector */
  1.     * display `"make_relationship_list args:  `0'"'
.     local max_rel = "`1'":relationship
  2.     local my_rel_list "`max_rel'"
  3.     * display "first rel:  `my_rel_list'"
.     if (`max_rel' == .) {
  4.         display as error "relationship not found:  `my_rel_list' `max_rel' `1'"
  5.         exit 111
  6.     }
  7.     local i = 2
  8.     while ("``i''" != "") {
  9.         * display "next rel:  ``i''"
.         local rel_num = "``i''":relationship
 10.         if (`rel_num' == .) {
 11.             display as error "relationship not found:  `my_rel_list' `max_rel' ``i''"
 12.             exit 111
 13.         }
 14.         * display "next rel:  ``i''  `rel_num'"
.         if (`rel_num' < `max_rel') {
 15.             display as error "relationships out of order in make_relationship_list:  `my_rel_list' `max_rel' `rel_num'"
 16.             exit 111
 17.         }
 18.         local max_rel = `rel_num'
 19.         local my_rel_list "`my_rel_list',`rel_num'"
 20.         * display "new rel list:  `my_rel_list'  max: `max_rel'"
.         local ++i
 21.     }
 22.     return local rel_list `"`my_rel_list'"'
 23. end

. 
. ********************************************************************************
. **  Section: apply programs to data to identify relationships bewteen ego and
. **  every other person in ego's household in the wave.
. ********************************************************************************
. 
.     use "$tempdir/relationships_tc0_wide"

. 
.     * We're going to create a dataset that has all the transitive relationships we can find.  So, if we have A --> B and B --> C
.     * we generate a dataset that tells us A --> B --> C by joining on B.
.     rename relfrom intermediate_person

.     rename relationship relationship2

.     rename reason reason2

.     label variable relationship2 "rel2"

.     label variable reason2 "reason2"

.     tempfile relmerge

.     save `relmerge'
file C:\Users\Joanna\AppData\Local\Temp\ST_3f6c_000001.tmp saved

. 
. 
.     use "$tempdir/relationships_tc0_wide"

.     rename relto intermediate_person

.     rename relationship relationship1

.     rename reason reason1

.     label variable relationship1 "rel1"

.     label variable reason1 "reason1"

.         
.         tab relationship1, m

                rel1 |      Freq.     Percent        Cum.
---------------------+-----------------------------------
            biochild |    661,315       30.11       30.11
              biomom |    387,136       17.63       47.74
              biodad |    274,179       12.48       60.22
           stepchild |     47,022        2.14       62.36
             stepmom |     16,676        0.76       63.12
             stepdad |     30,346        1.38       64.50
          adoptchild |     12,988        0.59       65.10
            adoptmom |      6,740        0.31       65.40
            adoptdad |      6,248        0.28       65.69
                 mom |          6        0.00       65.69
                 dad |          6        0.00       65.69
              spouse |    516,182       23.50       89.19
          grandchild |     31,181        1.42       90.61
         grandparent |     31,181        1.42       92.03
             sibling |     21,962        1.00       93.03
             partner |     47,196        2.15       95.18
             f_child |      1,523        0.07       95.25
               child |         12        0.00       95.25
            f_parent |      1,523        0.07       95.32
           other_rel |     50,006        2.28       97.60
               norel |     52,382        2.39       99.98
                   . |        414        0.02      100.00
---------------------+-----------------------------------
               Total |  2,196,224      100.00

.         
.     * Joinby creates a record for every combination of records matching 
.         * ssuid shhadid swave and intermediate_person in the two files.
.     joinby ssuid shhadid swave intermediate_person using `relmerge'

. 
.         tab relationship1, m

                rel1 |      Freq.     Percent        Cum.
---------------------+-----------------------------------
            biochild |  2,267,867       40.74       40.74
              biomom |    716,329       12.87       53.61
              biodad |    551,166        9.90       63.51
           stepchild |    148,102        2.66       66.17
             stepmom |     37,052        0.67       66.84
             stepdad |     66,921        1.20       68.04
          adoptchild |     45,087        0.81       68.85
            adoptmom |     12,271        0.22       69.07
            adoptdad |     12,608        0.23       69.30
                 mom |         32        0.00       69.30
                 dad |         32        0.00       69.30
              spouse |  1,122,184       20.16       89.46
          grandchild |    128,965        2.32       91.77
         grandparent |     55,723        1.00       92.78
             sibling |     50,561        0.91       93.68
             partner |     84,413        1.52       95.20
             f_child |      7,005        0.13       95.33
               child |         15        0.00       95.33
            f_parent |      1,523        0.03       95.35
           other_rel |    149,297        2.68       98.04
               norel |    107,890        1.94       99.97
                   . |      1,423        0.03      100.00
---------------------+-----------------------------------
               Total |  5,566,466      100.00

.         tab relationship2, m

                rel2 |      Freq.     Percent        Cum.
---------------------+-----------------------------------
            biochild |  1,267,495       22.77       22.77
              biomom |  1,299,572       23.35       46.12
              biodad |    968,295       17.40       63.51
           stepchild |    103,973        1.87       65.38
             stepmom |     43,851        0.79       66.17
             stepdad |    104,251        1.87       68.04
          adoptchild |     24,879        0.45       68.49
            adoptmom |     22,793        0.41       68.90
            adoptdad |     22,294        0.40       69.30
                 mom |          6        0.00       69.30
                 dad |          9        0.00       69.30
              spouse |  1,122,184       20.16       89.46
          grandchild |     55,723        1.00       90.46
         grandparent |    128,965        2.32       92.78
             sibling |     50,561        0.91       93.68
             partner |     84,413        1.52       95.20
             f_child |      1,523        0.03       95.23
               child |         64        0.00       95.23
            f_parent |      7,005        0.13       95.35
           other_rel |    149,297        2.68       98.04
               norel |    107,890        1.94       99.97
                   . |      1,423        0.03      100.00
---------------------+-----------------------------------
               Total |  5,566,466      100.00

.         
.         * Flag records where we already know relationship of A to C.
.         * Using data is pairs for which we already know the relationship
.         merge m:1 ssuid shhadid swave relfrom relto using "$tempdir/relationships_tc0_wide"
(label relationship already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                     4,164,656
        from master                 3,573,770  (_merge==1)
        from using                    590,886  (_merge==2)

    matched                         1,992,696  (_merge==3)
    -----------------------------------------

. 
.         *drop  cases in base_relationships not matched in joinby data because they are in two-person households 
.         * and thus can never have an intermediated relationship
.         drop if _merge==2
(590,886 observations deleted)

. 
.     * We don't keep (or validate correctness of) relationship of self to self.
.         * Note that this effectively restricts the joinby data to households with 3 or more people.
.     display "Dropping self-relationships"
Dropping self-relationships

.     drop if (relfrom == relto)
(2,196,224 observations deleted)

.         
.         gen already_known=0 

.         replace already_known=1 if _merge==3
(1,992,696 real changes made)

.         drop _merge

.         
.         display "Is the relationship already known?"
Is the relationship already known?

.         tab already_known

already_kno |
         wn |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |  1,377,546       40.87       40.87
          1 |  1,992,696       59.13      100.00
------------+-----------------------------------
      Total |  3,370,242      100.00

.         
.         *drop if we already have a relationship type for the pair
.         keep if already_known==0
(1,992,696 observations deleted)

.         drop relationship reason numrels_tc0

.         
.     display "Tab of A -- > B and B --> C relationships, where we are trying to find A --> C, rowsort"
Tab of A -- > B and B --> C relationships, where we are trying to find A --> C, rowsort

.     tab relationship1 relationship2, rowsort m

                     |                                                                                 rel2
                rel1 |  biochild     biomom     biodad  stepchild    stepmom    stepdad  adoptchil   adoptmom   adoptdad     spouse  grandpare    sibling    partner      child   f_parent |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
            biochild |    13,605    527,420    370,836      9,306      8,786     19,290        141      3,449      3,717         40     16,463      5,913      6,767         23      1,384 | 1,020,021 
          grandchild |        10     11,147      5,316        414        328        517          0        324        192     14,507     33,792        464        699          3         55 |    73,242 
           stepchild |       527      8,786     19,290        335      5,926     20,316          1        170        429         10        845        261        328          0        123 |    60,044 
           other_rel |       404     11,747      9,868      1,424        620      1,286          0        145        180      9,307      3,671      2,417        696          4         97 |    56,521 
               norel |        51      6,428      4,705        328        231        542          0        242        105      4,105      1,791      1,050      1,356          1        185 |    39,452 
              spouse |     2,608         19         21      3,582          0         10         41          0          0          0     14,507      2,296          0          6      1,098 |    37,610 
          adoptchild |        51      3,449      3,717        103        170        429          0      5,600      4,924          0        516         60        129          0        572 |    20,392 
             sibling |         0      4,267      1,646          0        110        151          0         60          0      2,296        464      4,692        496          0          2 |    17,671 
              biomom |     1,129      6,680      2,453         87        243         86          1         19         24      1,826         10          0         38          0          1 |    13,052 
             partner |        38      5,390      1,377        288        188        140          0         96         33          0        699        496          0          0        114 |    10,911 
             stepmom |         7      4,359      1,408          4        124        140          0         12         73      2,419        351          0        185          6          6 |    10,086 
              biodad |     1,129      3,547        925          7         49        149          0          2          6        782          0          0          0          0          0 |     6,597 
             stepdad |        87      2,196      1,343          4         39         32          0         12          6      1,163         63          0        103          6          3 |     5,829 
             f_child |         1        702        682          9         67         56          0        452        120      1,098         55          2        114          0      1,842 |     5,482 
                   . |         1         30        103         12          3         15          0          0          0         10         12         20          0          0          0 |       403 
            adoptdad |         1         91          4          0          0          0          0          0          0         27          0          0          0          0          0 |       123 
            adoptmom |         0         29         17          0          1          0          0          0          0         14          0          0          0          0          0 |        61 
                 mom |         0          8          3          6          0          0          0          0          0          3          3          0          0          0          0 |        26 
                 dad |         0          0         12          6          0          0          0          0          0          3          0          0          0          0          0 |        23 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    19,649    596,295    423,726     15,915     16,885     43,159        184     10,583      9,809     37,610     73,242     17,671     10,911         49      5,482 | 1,377,546 


                     |               rel2
                rel1 | other_rel      norel          . |     Total
---------------------+---------------------------------+----------
            biochild |    21,615     11,133        133 | 1,020,021 
          grandchild |     3,671      1,791         12 |    73,242 
           stepchild |     1,906        773         18 |    60,044 
           other_rel |    12,292      2,288         75 |    56,521 
               norel |     2,288     16,024         20 |    39,452 
              spouse |     9,307      4,105         10 |    37,610 
          adoptchild |       325        347          0 |    20,392 
             sibling |     2,417      1,050         20 |    17,671 
              biomom |       403         51          1 |    13,052 
             partner |       696      1,356          0 |    10,911 
             stepmom |       780        201         11 |    10,086 
              biodad |         1          0          0 |     6,597 
             stepdad |       644        127          1 |     5,829 
             f_child |        97        185          0 |     5,482 
                   . |        75         20        102 |       403 
            adoptdad |         0          0          0 |       123 
            adoptmom |         0          0          0 |        61 
                 mom |         2          1          0 |        26 
                 dad |         2          0          0 |        23 
---------------------+---------------------------------+----------
               Total |    56,521     39,452        403 | 1,377,546 

. 
.     * Now given the A --> B --> C relationships, what can we figure out for A --> C?
.     gen relationship = .
(1,377,546 missing values generated)

.     label values relationship relationship

. 
.     local all_child_types child biochild stepchild adoptchild

.     local all_parent_types mom biomom stepmom adoptmom dad biodad stepdad adoptdad parent

. 
. foreach rel1 in `all_child_types' {
  2.   *read as set generate_relationship equal to child if rel1 is any of the child types and rel2 is spouse
.   generate_relationship "child"                                 "`rel1'"        "spouse"
  3.   generate_relationship "child"                                 "`rel1'"        "partner"
  4.   generate_relationship "greatgrandchild"               "`rel1'"        "grandchild"
  5.   generate_relationship "auntuncle_or_parent"   "`rel1'"        "grandparent"
  6.   generate_relationship "nephewniece"                   "`rel1'"        "sibling"
  7.   generate_relationship "cousin"                                "`rel1'"        "auntuncle"
  8.   generate_relationship "other_rel"                     "spouse"        "`rel1'" 
  9.   generate_relationship "other_rel_p"                   "partner"       "`rel1'" 
 10.   
.   foreach rel2 in `all_child_types' {
 11.      generate_relationship "grandchild"                 "`rel1'"        "`rel2'"
 12.   }
 13.   
.   foreach rel2 in `all_parent_types' {
 14.      generate_relationship "sibling"                    "`rel1'"        "`rel2'"
 15.   }
 16. 
.   generate_relationship "other_rel"                     "`rel1'"        "other_rel"
 17.   generate_relationship "other_rel"                     "other_rel" "`rel1'" 
 18.   generate_relationship "norel"                                 "`rel1'"        "norel"
 19.   generate_relationship "norel"                                 "norel"         "`rel1'" 
 20.   generate_relationship "f_sib"                                 "`rel1'"        "f_child"
 21.   generate_relationship "f_sib"                                 "f_child"       "`rel1'"
 22.   generate_relationship "f_sib"                                 "`rel1'"        "f_parent"
 23. }
Generating child from child spouse
(0 real changes made)
Generating child from child partner
(0 real changes made)
Generating greatgrandchild from child grandchild
(0 real changes made)
Generating auntuncle_or_parent from child grandparent
(0 real changes made)
Generating nephewniece from child sibling
(0 real changes made)
Generating cousin from child auntuncle
(0 real changes made)
Generating other_rel from spouse child
(6 real changes made)
Generating other_rel_p from partner child
(0 real changes made)
Generating grandchild from child child
(0 real changes made)
Generating grandchild from child biochild
(0 real changes made)
Generating grandchild from child stepchild
(0 real changes made)
Generating grandchild from child adoptchild
(0 real changes made)
Generating sibling from child mom
(0 real changes made)
Generating sibling from child biomom
(0 real changes made)
Generating sibling from child stepmom
(0 real changes made)
Generating sibling from child adoptmom
(0 real changes made)
Generating sibling from child dad
(0 real changes made)
Generating sibling from child biodad
(0 real changes made)
Generating sibling from child stepdad
(0 real changes made)
Generating sibling from child adoptdad
(0 real changes made)
Generating sibling from child parent
(0 real changes made)
Generating other_rel from child other_rel
(0 real changes made)
Generating other_rel from other_rel child
(4 real changes made)
Generating norel from child norel
(0 real changes made)
Generating norel from norel child
(1 real change made)
Generating f_sib from child f_child
(0 real changes made)
Generating f_sib from f_child child
(0 real changes made)
Generating f_sib from child f_parent
(0 real changes made)
Generating child from biochild spouse
(40 real changes made)
Generating child from biochild partner
(6,767 real changes made)
Generating greatgrandchild from biochild grandchild
(0 real changes made)
Generating auntuncle_or_parent from biochild grandparent
(16,463 real changes made)
Generating nephewniece from biochild sibling
(5,913 real changes made)
Generating cousin from biochild auntuncle
(0 real changes made)
Generating other_rel from spouse biochild
(2,608 real changes made)
Generating other_rel_p from partner biochild
(38 real changes made)
Generating grandchild from biochild child
(23 real changes made)
Generating grandchild from biochild biochild
(13,605 real changes made)
Generating grandchild from biochild stepchild
(9,306 real changes made)
Generating grandchild from biochild adoptchild
(141 real changes made)
Generating sibling from biochild mom
(0 real changes made)
Generating sibling from biochild biomom
(527,420 real changes made)
Generating sibling from biochild stepmom
(8,786 real changes made)
Generating sibling from biochild adoptmom
(3,449 real changes made)
Generating sibling from biochild dad
(0 real changes made)
Generating sibling from biochild biodad
(370,836 real changes made)
Generating sibling from biochild stepdad
(19,290 real changes made)
Generating sibling from biochild adoptdad
(3,717 real changes made)
Generating sibling from biochild parent
(0 real changes made)
Generating other_rel from biochild other_rel
(21,615 real changes made)
Generating other_rel from other_rel biochild
(404 real changes made)
Generating norel from biochild norel
(11,133 real changes made)
Generating norel from norel biochild
(51 real changes made)
Generating f_sib from biochild f_child
(0 real changes made)
Generating f_sib from f_child biochild
(1 real change made)
Generating f_sib from biochild f_parent
(1,384 real changes made)
Generating child from stepchild spouse
(10 real changes made)
Generating child from stepchild partner
(328 real changes made)
Generating greatgrandchild from stepchild grandchild
(0 real changes made)
Generating auntuncle_or_parent from stepchild grandparent
(845 real changes made)
Generating nephewniece from stepchild sibling
(261 real changes made)
Generating cousin from stepchild auntuncle
(0 real changes made)
Generating other_rel from spouse stepchild
(3,582 real changes made)
Generating other_rel_p from partner stepchild
(288 real changes made)
Generating grandchild from stepchild child
(0 real changes made)
Generating grandchild from stepchild biochild
(527 real changes made)
Generating grandchild from stepchild stepchild
(335 real changes made)
Generating grandchild from stepchild adoptchild
(1 real change made)
Generating sibling from stepchild mom
(0 real changes made)
Generating sibling from stepchild biomom
(8,786 real changes made)
Generating sibling from stepchild stepmom
(5,926 real changes made)
Generating sibling from stepchild adoptmom
(170 real changes made)
Generating sibling from stepchild dad
(0 real changes made)
Generating sibling from stepchild biodad
(19,290 real changes made)
Generating sibling from stepchild stepdad
(20,316 real changes made)
Generating sibling from stepchild adoptdad
(429 real changes made)
Generating sibling from stepchild parent
(0 real changes made)
Generating other_rel from stepchild other_rel
(1,906 real changes made)
Generating other_rel from other_rel stepchild
(1,424 real changes made)
Generating norel from stepchild norel
(773 real changes made)
Generating norel from norel stepchild
(328 real changes made)
Generating f_sib from stepchild f_child
(0 real changes made)
Generating f_sib from f_child stepchild
(9 real changes made)
Generating f_sib from stepchild f_parent
(123 real changes made)
Generating child from adoptchild spouse
(0 real changes made)
Generating child from adoptchild partner
(129 real changes made)
Generating greatgrandchild from adoptchild grandchild
(0 real changes made)
Generating auntuncle_or_parent from adoptchild grandparent
(516 real changes made)
Generating nephewniece from adoptchild sibling
(60 real changes made)
Generating cousin from adoptchild auntuncle
(0 real changes made)
Generating other_rel from spouse adoptchild
(41 real changes made)
Generating other_rel_p from partner adoptchild
(0 real changes made)
Generating grandchild from adoptchild child
(0 real changes made)
Generating grandchild from adoptchild biochild
(51 real changes made)
Generating grandchild from adoptchild stepchild
(103 real changes made)
Generating grandchild from adoptchild adoptchild
(0 real changes made)
Generating sibling from adoptchild mom
(0 real changes made)
Generating sibling from adoptchild biomom
(3,449 real changes made)
Generating sibling from adoptchild stepmom
(170 real changes made)
Generating sibling from adoptchild adoptmom
(5,600 real changes made)
Generating sibling from adoptchild dad
(0 real changes made)
Generating sibling from adoptchild biodad
(3,717 real changes made)
Generating sibling from adoptchild stepdad
(429 real changes made)
Generating sibling from adoptchild adoptdad
(4,924 real changes made)
Generating sibling from adoptchild parent
(0 real changes made)
Generating other_rel from adoptchild other_rel
(325 real changes made)
Generating other_rel from other_rel adoptchild
(0 real changes made)
Generating norel from adoptchild norel
(347 real changes made)
Generating norel from norel adoptchild
(0 real changes made)
Generating f_sib from adoptchild f_child
(0 real changes made)
Generating f_sib from f_child adoptchild
(0 real changes made)
Generating f_sib from adoptchild f_parent
(572 real changes made)

. 
. foreach rel2 in `all_child_types' {
  2.   generate_relationship "greatgrandchild"               "grandchild" "`rel2'"
  3.   generate_relationship "parent" "sibling"              "`rel2'"
  4.   generate_relationship "parent_or_relative"    "grandparent" "`rel2'"
  5.   generate_relationship "f_sib" "f_child"               "`rel2'"
  6. }
Generating greatgrandchild from grandchild child
(3 real changes made)
Generating parent from sibling child
(0 real changes made)
Generating parent_or_relative from grandparent child
(0 real changes made)
Generating f_sib from f_child child
(0 real changes made)
Generating greatgrandchild from grandchild biochild
(10 real changes made)
Generating parent from sibling biochild
(0 real changes made)
Generating parent_or_relative from grandparent biochild
(0 real changes made)
Generating f_sib from f_child biochild
(0 real changes made)
Generating greatgrandchild from grandchild stepchild
(414 real changes made)
Generating parent from sibling stepchild
(0 real changes made)
Generating parent_or_relative from grandparent stepchild
(0 real changes made)
Generating f_sib from f_child stepchild
(0 real changes made)
Generating greatgrandchild from grandchild adoptchild
(0 real changes made)
Generating parent from sibling adoptchild
(0 real changes made)
Generating parent_or_relative from grandparent adoptchild
(0 real changes made)
Generating f_sib from f_child adoptchild
(0 real changes made)

. 
. foreach rel1 in `all_parent_types' {
  2.    foreach rel2 in `all_parent_types' {
  3.       generate_relationship "grandparent"               "`rel1'"        "`rel2'"
  4.    }
  5.    
.    * Should we call these partnerS?  Or something less certain?
.    foreach rel2 in `all_child_types' {
  6.       generate_relationship "partner"                   "`rel1'"        "`rel2'"
  7.    }
  8. 
.    generate_relationship "greatgrandparent"     "`rel1'"        "grandparent"
  9.    generate_relationship "parent"                               "`rel1'"        "sibling"
 10.    generate_relationship "child_or_relative"    "`rel1'"        "grandchild"
 11.    generate_relationship "other_rel"                    "`rel1'"        "spouse"
 12.    generate_relationship "other_rel_p"                  "`rel1'"        "partner"
 13.    generate_relationship "other_rel"                    "`rel1'"        "other_rel"
 14.    generate_relationship "other_rel"                    "other_rel" "`rel1'" 
 15. 
.    generate_relationship "norel"                                "`rel1'"        "norel"
 16.    generate_relationship "norel"                                "norel"         "`rel1'" 
 17. }
Generating grandparent from mom mom
(0 real changes made)
Generating grandparent from mom biomom
(8 real changes made)
Generating grandparent from mom stepmom
(0 real changes made)
Generating grandparent from mom adoptmom
(0 real changes made)
Generating grandparent from mom dad
(0 real changes made)
Generating grandparent from mom biodad
(3 real changes made)
Generating grandparent from mom stepdad
(0 real changes made)
Generating grandparent from mom adoptdad
(0 real changes made)
Generating grandparent from mom parent
(0 real changes made)
Generating partner from mom child
(0 real changes made)
Generating partner from mom biochild
(0 real changes made)
Generating partner from mom stepchild
(6 real changes made)
Generating partner from mom adoptchild
(0 real changes made)
Generating greatgrandparent from mom grandparent
(3 real changes made)
Generating parent from mom sibling
(0 real changes made)
Generating child_or_relative from mom grandchild
(0 real changes made)
Generating other_rel from mom spouse
(3 real changes made)
Generating other_rel_p from mom partner
(0 real changes made)
Generating other_rel from mom other_rel
(2 real changes made)
Generating other_rel from other_rel mom
(0 real changes made)
Generating norel from mom norel
(1 real change made)
Generating norel from norel mom
(0 real changes made)
Generating grandparent from biomom mom
(0 real changes made)
Generating grandparent from biomom biomom
(6,680 real changes made)
Generating grandparent from biomom stepmom
(243 real changes made)
Generating grandparent from biomom adoptmom
(19 real changes made)
Generating grandparent from biomom dad
(0 real changes made)
Generating grandparent from biomom biodad
(2,453 real changes made)
Generating grandparent from biomom stepdad
(86 real changes made)
Generating grandparent from biomom adoptdad
(24 real changes made)
Generating grandparent from biomom parent
(0 real changes made)
Generating partner from biomom child
(0 real changes made)
Generating partner from biomom biochild
(1,129 real changes made)
Generating partner from biomom stepchild
(87 real changes made)
Generating partner from biomom adoptchild
(1 real change made)
Generating greatgrandparent from biomom grandparent
(10 real changes made)
Generating parent from biomom sibling
(0 real changes made)
Generating child_or_relative from biomom grandchild
(0 real changes made)
Generating other_rel from biomom spouse
(1,826 real changes made)
Generating other_rel_p from biomom partner
(38 real changes made)
Generating other_rel from biomom other_rel
(403 real changes made)
Generating other_rel from other_rel biomom
(11,747 real changes made)
Generating norel from biomom norel
(51 real changes made)
Generating norel from norel biomom
(6,428 real changes made)
Generating grandparent from stepmom mom
(0 real changes made)
Generating grandparent from stepmom biomom
(4,359 real changes made)
Generating grandparent from stepmom stepmom
(124 real changes made)
Generating grandparent from stepmom adoptmom
(12 real changes made)
Generating grandparent from stepmom dad
(0 real changes made)
Generating grandparent from stepmom biodad
(1,408 real changes made)
Generating grandparent from stepmom stepdad
(140 real changes made)
Generating grandparent from stepmom adoptdad
(73 real changes made)
Generating grandparent from stepmom parent
(0 real changes made)
Generating partner from stepmom child
(6 real changes made)
Generating partner from stepmom biochild
(7 real changes made)
Generating partner from stepmom stepchild
(4 real changes made)
Generating partner from stepmom adoptchild
(0 real changes made)
Generating greatgrandparent from stepmom grandparent
(351 real changes made)
Generating parent from stepmom sibling
(0 real changes made)
Generating child_or_relative from stepmom grandchild
(0 real changes made)
Generating other_rel from stepmom spouse
(2,419 real changes made)
Generating other_rel_p from stepmom partner
(185 real changes made)
Generating other_rel from stepmom other_rel
(780 real changes made)
Generating other_rel from other_rel stepmom
(620 real changes made)
Generating norel from stepmom norel
(201 real changes made)
Generating norel from norel stepmom
(231 real changes made)
Generating grandparent from adoptmom mom
(0 real changes made)
Generating grandparent from adoptmom biomom
(29 real changes made)
Generating grandparent from adoptmom stepmom
(1 real change made)
Generating grandparent from adoptmom adoptmom
(0 real changes made)
Generating grandparent from adoptmom dad
(0 real changes made)
Generating grandparent from adoptmom biodad
(17 real changes made)
Generating grandparent from adoptmom stepdad
(0 real changes made)
Generating grandparent from adoptmom adoptdad
(0 real changes made)
Generating grandparent from adoptmom parent
(0 real changes made)
Generating partner from adoptmom child
(0 real changes made)
Generating partner from adoptmom biochild
(0 real changes made)
Generating partner from adoptmom stepchild
(0 real changes made)
Generating partner from adoptmom adoptchild
(0 real changes made)
Generating greatgrandparent from adoptmom grandparent
(0 real changes made)
Generating parent from adoptmom sibling
(0 real changes made)
Generating child_or_relative from adoptmom grandchild
(0 real changes made)
Generating other_rel from adoptmom spouse
(14 real changes made)
Generating other_rel_p from adoptmom partner
(0 real changes made)
Generating other_rel from adoptmom other_rel
(0 real changes made)
Generating other_rel from other_rel adoptmom
(145 real changes made)
Generating norel from adoptmom norel
(0 real changes made)
Generating norel from norel adoptmom
(242 real changes made)
Generating grandparent from dad mom
(0 real changes made)
Generating grandparent from dad biomom
(0 real changes made)
Generating grandparent from dad stepmom
(0 real changes made)
Generating grandparent from dad adoptmom
(0 real changes made)
Generating grandparent from dad dad
(0 real changes made)
Generating grandparent from dad biodad
(12 real changes made)
Generating grandparent from dad stepdad
(0 real changes made)
Generating grandparent from dad adoptdad
(0 real changes made)
Generating grandparent from dad parent
(0 real changes made)
Generating partner from dad child
(0 real changes made)
Generating partner from dad biochild
(0 real changes made)
Generating partner from dad stepchild
(6 real changes made)
Generating partner from dad adoptchild
(0 real changes made)
Generating greatgrandparent from dad grandparent
(0 real changes made)
Generating parent from dad sibling
(0 real changes made)
Generating child_or_relative from dad grandchild
(0 real changes made)
Generating other_rel from dad spouse
(3 real changes made)
Generating other_rel_p from dad partner
(0 real changes made)
Generating other_rel from dad other_rel
(2 real changes made)
Generating other_rel from other_rel dad
(0 real changes made)
Generating norel from dad norel
(0 real changes made)
Generating norel from norel dad
(0 real changes made)
Generating grandparent from biodad mom
(0 real changes made)
Generating grandparent from biodad biomom
(3,547 real changes made)
Generating grandparent from biodad stepmom
(49 real changes made)
Generating grandparent from biodad adoptmom
(2 real changes made)
Generating grandparent from biodad dad
(0 real changes made)
Generating grandparent from biodad biodad
(925 real changes made)
Generating grandparent from biodad stepdad
(149 real changes made)
Generating grandparent from biodad adoptdad
(6 real changes made)
Generating grandparent from biodad parent
(0 real changes made)
Generating partner from biodad child
(0 real changes made)
Generating partner from biodad biochild
(1,129 real changes made)
Generating partner from biodad stepchild
(7 real changes made)
Generating partner from biodad adoptchild
(0 real changes made)
Generating greatgrandparent from biodad grandparent
(0 real changes made)
Generating parent from biodad sibling
(0 real changes made)
Generating child_or_relative from biodad grandchild
(0 real changes made)
Generating other_rel from biodad spouse
(782 real changes made)
Generating other_rel_p from biodad partner
(0 real changes made)
Generating other_rel from biodad other_rel
(1 real change made)
Generating other_rel from other_rel biodad
(9,868 real changes made)
Generating norel from biodad norel
(0 real changes made)
Generating norel from norel biodad
(4,705 real changes made)
Generating grandparent from stepdad mom
(0 real changes made)
Generating grandparent from stepdad biomom
(2,196 real changes made)
Generating grandparent from stepdad stepmom
(39 real changes made)
Generating grandparent from stepdad adoptmom
(12 real changes made)
Generating grandparent from stepdad dad
(0 real changes made)
Generating grandparent from stepdad biodad
(1,343 real changes made)
Generating grandparent from stepdad stepdad
(32 real changes made)
Generating grandparent from stepdad adoptdad
(6 real changes made)
Generating grandparent from stepdad parent
(0 real changes made)
Generating partner from stepdad child
(6 real changes made)
Generating partner from stepdad biochild
(87 real changes made)
Generating partner from stepdad stepchild
(4 real changes made)
Generating partner from stepdad adoptchild
(0 real changes made)
Generating greatgrandparent from stepdad grandparent
(63 real changes made)
Generating parent from stepdad sibling
(0 real changes made)
Generating child_or_relative from stepdad grandchild
(0 real changes made)
Generating other_rel from stepdad spouse
(1,163 real changes made)
Generating other_rel_p from stepdad partner
(103 real changes made)
Generating other_rel from stepdad other_rel
(644 real changes made)
Generating other_rel from other_rel stepdad
(1,286 real changes made)
Generating norel from stepdad norel
(127 real changes made)
Generating norel from norel stepdad
(542 real changes made)
Generating grandparent from adoptdad mom
(0 real changes made)
Generating grandparent from adoptdad biomom
(91 real changes made)
Generating grandparent from adoptdad stepmom
(0 real changes made)
Generating grandparent from adoptdad adoptmom
(0 real changes made)
Generating grandparent from adoptdad dad
(0 real changes made)
Generating grandparent from adoptdad biodad
(4 real changes made)
Generating grandparent from adoptdad stepdad
(0 real changes made)
Generating grandparent from adoptdad adoptdad
(0 real changes made)
Generating grandparent from adoptdad parent
(0 real changes made)
Generating partner from adoptdad child
(0 real changes made)
Generating partner from adoptdad biochild
(1 real change made)
Generating partner from adoptdad stepchild
(0 real changes made)
Generating partner from adoptdad adoptchild
(0 real changes made)
Generating greatgrandparent from adoptdad grandparent
(0 real changes made)
Generating parent from adoptdad sibling
(0 real changes made)
Generating child_or_relative from adoptdad grandchild
(0 real changes made)
Generating other_rel from adoptdad spouse
(27 real changes made)
Generating other_rel_p from adoptdad partner
(0 real changes made)
Generating other_rel from adoptdad other_rel
(0 real changes made)
Generating other_rel from other_rel adoptdad
(180 real changes made)
Generating norel from adoptdad norel
(0 real changes made)
Generating norel from norel adoptdad
(105 real changes made)
Generating grandparent from parent mom
(0 real changes made)
Generating grandparent from parent biomom
(0 real changes made)
Generating grandparent from parent stepmom
(0 real changes made)
Generating grandparent from parent adoptmom
(0 real changes made)
Generating grandparent from parent dad
(0 real changes made)
Generating grandparent from parent biodad
(0 real changes made)
Generating grandparent from parent stepdad
(0 real changes made)
Generating grandparent from parent adoptdad
(0 real changes made)
Generating grandparent from parent parent
(0 real changes made)
Generating partner from parent child
(0 real changes made)
Generating partner from parent biochild
(0 real changes made)
Generating partner from parent stepchild
(0 real changes made)
Generating partner from parent adoptchild
(0 real changes made)
Generating greatgrandparent from parent grandparent
(0 real changes made)
Generating parent from parent sibling
(0 real changes made)
Generating child_or_relative from parent grandchild
(0 real changes made)
Generating other_rel from parent spouse
(0 real changes made)
Generating other_rel_p from parent partner
(0 real changes made)
Generating other_rel from parent other_rel
(0 real changes made)
Generating other_rel from other_rel parent
(0 real changes made)
Generating norel from parent norel
(0 real changes made)
Generating norel from norel parent
(0 real changes made)

. 
.     foreach rel2 in `all_parent_types' {
  2.         generate_relationship "parent"                  "spouse" "`rel2'"
  3.         generate_relationship "parent"                  "partner" "`rel2'"
  4. 
.         generate_relationship "auntuncle"               "sibling" "`rel2'"
  5. 
.         generate_relationship "child_or_nephewniece" "grandchild" "`rel2'"
  6. 
.         generate_relationship "greatgrandparent" "grandparent" "`rel2'"
  7. 
.         generate_relationship "norel"                   "f_child" "`rel2'"
  8.     }
Generating parent from spouse mom
(0 real changes made)
Generating parent from partner mom
(0 real changes made)
Generating auntuncle from sibling mom
(0 real changes made)
Generating child_or_nephewniece from grandchild mom
(0 real changes made)
Generating greatgrandparent from grandparent mom
(0 real changes made)
Generating norel from f_child mom
(0 real changes made)
Generating parent from spouse biomom
(19 real changes made)
Generating parent from partner biomom
(5,390 real changes made)
Generating auntuncle from sibling biomom
(4,267 real changes made)
Generating child_or_nephewniece from grandchild biomom
(11,147 real changes made)
Generating greatgrandparent from grandparent biomom
(0 real changes made)
Generating norel from f_child biomom
(702 real changes made)
Generating parent from spouse stepmom
(0 real changes made)
Generating parent from partner stepmom
(188 real changes made)
Generating auntuncle from sibling stepmom
(110 real changes made)
Generating child_or_nephewniece from grandchild stepmom
(328 real changes made)
Generating greatgrandparent from grandparent stepmom
(0 real changes made)
Generating norel from f_child stepmom
(67 real changes made)
Generating parent from spouse adoptmom
(0 real changes made)
Generating parent from partner adoptmom
(96 real changes made)
Generating auntuncle from sibling adoptmom
(60 real changes made)
Generating child_or_nephewniece from grandchild adoptmom
(324 real changes made)
Generating greatgrandparent from grandparent adoptmom
(0 real changes made)
Generating norel from f_child adoptmom
(452 real changes made)
Generating parent from spouse dad
(0 real changes made)
Generating parent from partner dad
(0 real changes made)
Generating auntuncle from sibling dad
(0 real changes made)
Generating child_or_nephewniece from grandchild dad
(0 real changes made)
Generating greatgrandparent from grandparent dad
(0 real changes made)
Generating norel from f_child dad
(0 real changes made)
Generating parent from spouse biodad
(21 real changes made)
Generating parent from partner biodad
(1,377 real changes made)
Generating auntuncle from sibling biodad
(1,646 real changes made)
Generating child_or_nephewniece from grandchild biodad
(5,316 real changes made)
Generating greatgrandparent from grandparent biodad
(0 real changes made)
Generating norel from f_child biodad
(682 real changes made)
Generating parent from spouse stepdad
(10 real changes made)
Generating parent from partner stepdad
(140 real changes made)
Generating auntuncle from sibling stepdad
(151 real changes made)
Generating child_or_nephewniece from grandchild stepdad
(517 real changes made)
Generating greatgrandparent from grandparent stepdad
(0 real changes made)
Generating norel from f_child stepdad
(56 real changes made)
Generating parent from spouse adoptdad
(0 real changes made)
Generating parent from partner adoptdad
(33 real changes made)
Generating auntuncle from sibling adoptdad
(0 real changes made)
Generating child_or_nephewniece from grandchild adoptdad
(192 real changes made)
Generating greatgrandparent from grandparent adoptdad
(0 real changes made)
Generating norel from f_child adoptdad
(120 real changes made)
Generating parent from spouse parent
(0 real changes made)
Generating parent from partner parent
(0 real changes made)
Generating auntuncle from sibling parent
(0 real changes made)
Generating child_or_nephewniece from grandchild parent
(0 real changes made)
Generating greatgrandparent from grandparent parent
(0 real changes made)
Generating norel from f_child parent
(0 real changes made)

. 
. *** rel1 == grandchild
. generate_relationship "grandchild"                              "grandchild" "spouse"
Generating grandchild from grandchild spouse
(14,507 real changes made)

. generate_relationship "grandchild_p"                    "grandchild" "partner"
Generating grandchild_p from grandchild partner
(699 real changes made)

. generate_relationship "other_rel"                               "grandchild" "sibling"
Generating other_rel from grandchild sibling
(464 real changes made)

. generate_relationship "sibling_OR_cousin"               "grandchild" "grandparent"
Generating sibling_OR_cousin from grandchild grandparent
(value label dereference "sibling_OR_cousin":relationship not found)
(0 real changes made)
(value label dereference "sibling_OR_cousin":relationship not found)
relationship not found in one of:  sibling_OR_cousin grandchild grandparent
r(111);

end of do-file

r(111);

. class

. clear

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. //==============================================================================
. //=========== Children's Household Instability Project                                  
. //=========== Dataset: SIPP2008                                                 
. //=========== Purpose: Uses programs to compute relationships not 
. //=========== directly identifiable with parent pointers, spouse pointer, or ERRP  
. //================================================================================
. 
. ********************************************************************************
. **  Section: programs to process data to identify relationships transitively
. ********************************************************************************
. 
. * Program generates relationship from relationship1 and relatiosnhip2, 
. * where A is [relationship1] of person B.
. * Person B is [relationship2] of person C.
. * Therefore ego is [relationship] or [result_rel] of person C.
. capture program drop generate_relationship

. program define generate_relationship
  1.     args result_rel rel1 rel2 /* local macros: result_rel rel1 rels */
  2.     display "Generating `result_rel' from `rel1' `rel2'"
  3.     replace relationship = "`result_rel'":relationship if ((relationship1 == "`rel1'":relationship) & (relationship2 == "`rel2'":relationship))
  4.         *if any relationship is missing:
.     if (("`result_rel'":relationship == .) | ("`rel1'":relationship == .) | ("`rel2'":relationship == .)) {
  5.         display as error "relationship not found in one of:  `result_rel' `rel1' `rel2'"
  6.         exit 111
  7.     }
  8. end

. 
. * Program to make lists of values associated with each relationship type
. * For example, moms can be biomoms, stepmoms, adoptive moms, or moms.  
. capture program drop make_relationship_list

. program define make_relationship_list, rclass /* results are in r() vector */
  1.     * display `"make_relationship_list args:  `0'"'
.     local max_rel = "`1'":relationship
  2.     local my_rel_list "`max_rel'"
  3.     * display "first rel:  `my_rel_list'"
.     if (`max_rel' == .) {
  4.         display as error "relationship not found:  `my_rel_list' `max_rel' `1'"
  5.         exit 111
  6.     }
  7.     local i = 2
  8.     while ("``i''" != "") {
  9.         * display "next rel:  ``i''"
.         local rel_num = "``i''":relationship
 10.         if (`rel_num' == .) {
 11.             display as error "relationship not found:  `my_rel_list' `max_rel' ``i''"
 12.             exit 111
 13.         }
 14.         * display "next rel:  ``i''  `rel_num'"
.         if (`rel_num' < `max_rel') {
 15.             display as error "relationships out of order in make_relationship_list:  `my_rel_list' `max_rel' `rel_num'"
 16.             exit 111
 17.         }
 18.         local max_rel = `rel_num'
 19.         local my_rel_list "`my_rel_list',`rel_num'"
 20.         * display "new rel list:  `my_rel_list'  max: `max_rel'"
.         local ++i
 21.     }
 22.     return local rel_list `"`my_rel_list'"'
 23. end

. 
. ********************************************************************************
. **  Section: apply programs to data to identify relationships bewteen ego and
. **  every other person in ego's household in the wave.
. ********************************************************************************
. 
.     use "$tempdir/relationships_tc0_wide"

. 
.     * We're going to create a dataset that has all the transitive relationships we can find.  So, if we have A --> B and B --> C
.     * we generate a dataset that tells us A --> B --> C by joining on B.
.     rename relfrom intermediate_person

.     rename relationship relationship2

.     rename reason reason2

.     label variable relationship2 "rel2"

.     label variable reason2 "reason2"

.     tempfile relmerge

.     save `relmerge'
file C:\Users\Joanna\AppData\Local\Temp\ST_3f6c_000001.tmp saved

. 
. 
.     use "$tempdir/relationships_tc0_wide"

.     rename relto intermediate_person

.     rename relationship relationship1

.     rename reason reason1

.     label variable relationship1 "rel1"

.     label variable reason1 "reason1"

.         
.         tab relationship1, m

                rel1 |      Freq.     Percent        Cum.
---------------------+-----------------------------------
            biochild |    661,315       30.11       30.11
              biomom |    387,136       17.63       47.74
              biodad |    274,179       12.48       60.22
           stepchild |     47,022        2.14       62.36
             stepmom |     16,676        0.76       63.12
             stepdad |     30,346        1.38       64.50
          adoptchild |     12,988        0.59       65.10
            adoptmom |      6,740        0.31       65.40
            adoptdad |      6,248        0.28       65.69
                 mom |          6        0.00       65.69
                 dad |          6        0.00       65.69
              spouse |    516,182       23.50       89.19
          grandchild |     31,181        1.42       90.61
         grandparent |     31,181        1.42       92.03
             sibling |     21,962        1.00       93.03
             partner |     47,196        2.15       95.18
             f_child |      1,523        0.07       95.25
               child |         12        0.00       95.25
            f_parent |      1,523        0.07       95.32
           other_rel |     50,006        2.28       97.60
               norel |     52,382        2.39       99.98
                   . |        414        0.02      100.00
---------------------+-----------------------------------
               Total |  2,196,224      100.00

.         
.     * Joinby creates a record for every combination of records matching 
.         * ssuid shhadid swave and intermediate_person in the two files.
.     joinby ssuid shhadid swave intermediate_person using `relmerge'

. 
.         tab relationship1, m

                rel1 |      Freq.     Percent        Cum.
---------------------+-----------------------------------
            biochild |  2,267,867       40.74       40.74
              biomom |    716,329       12.87       53.61
              biodad |    551,166        9.90       63.51
           stepchild |    148,102        2.66       66.17
             stepmom |     37,052        0.67       66.84
             stepdad |     66,921        1.20       68.04
          adoptchild |     45,087        0.81       68.85
            adoptmom |     12,271        0.22       69.07
            adoptdad |     12,608        0.23       69.30
                 mom |         32        0.00       69.30
                 dad |         32        0.00       69.30
              spouse |  1,122,184       20.16       89.46
          grandchild |    128,965        2.32       91.77
         grandparent |     55,723        1.00       92.78
             sibling |     50,561        0.91       93.68
             partner |     84,413        1.52       95.20
             f_child |      7,005        0.13       95.33
               child |         15        0.00       95.33
            f_parent |      1,523        0.03       95.35
           other_rel |    149,297        2.68       98.04
               norel |    107,890        1.94       99.97
                   . |      1,423        0.03      100.00
---------------------+-----------------------------------
               Total |  5,566,466      100.00

.         tab relationship2, m

                rel2 |      Freq.     Percent        Cum.
---------------------+-----------------------------------
            biochild |  1,267,495       22.77       22.77
              biomom |  1,299,572       23.35       46.12
              biodad |    968,295       17.40       63.51
           stepchild |    103,973        1.87       65.38
             stepmom |     43,851        0.79       66.17
             stepdad |    104,251        1.87       68.04
          adoptchild |     24,879        0.45       68.49
            adoptmom |     22,793        0.41       68.90
            adoptdad |     22,294        0.40       69.30
                 mom |          6        0.00       69.30
                 dad |          9        0.00       69.30
              spouse |  1,122,184       20.16       89.46
          grandchild |     55,723        1.00       90.46
         grandparent |    128,965        2.32       92.78
             sibling |     50,561        0.91       93.68
             partner |     84,413        1.52       95.20
             f_child |      1,523        0.03       95.23
               child |         64        0.00       95.23
            f_parent |      7,005        0.13       95.35
           other_rel |    149,297        2.68       98.04
               norel |    107,890        1.94       99.97
                   . |      1,423        0.03      100.00
---------------------+-----------------------------------
               Total |  5,566,466      100.00

.         
.         * Flag records where we already know relationship of A to C.
.         * Using data is pairs for which we already know the relationship
.         merge m:1 ssuid shhadid swave relfrom relto using "$tempdir/relationships_tc0_wide"
(label relationship already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                     4,164,656
        from master                 3,573,770  (_merge==1)
        from using                    590,886  (_merge==2)

    matched                         1,992,696  (_merge==3)
    -----------------------------------------

. 
.         *drop  cases in base_relationships not matched in joinby data because they are in two-person households 
.         * and thus can never have an intermediated relationship
.         drop if _merge==2
(590,886 observations deleted)

. 
.     * We don't keep (or validate correctness of) relationship of self to self.
.         * Note that this effectively restricts the joinby data to households with 3 or more people.
.     display "Dropping self-relationships"
Dropping self-relationships

.     drop if (relfrom == relto)
(2,196,224 observations deleted)

.         
.         gen already_known=0 

.         replace already_known=1 if _merge==3
(1,992,696 real changes made)

.         drop _merge

.         
.         display "Is the relationship already known?"
Is the relationship already known?

.         tab already_known

already_kno |
         wn |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |  1,377,546       40.87       40.87
          1 |  1,992,696       59.13      100.00
------------+-----------------------------------
      Total |  3,370,242      100.00

.         
.         *drop if we already have a relationship type for the pair
.         keep if already_known==0
(1,992,696 observations deleted)

.         drop relationship reason numrels_tc0

.         
.     display "Tab of A -- > B and B --> C relationships, where we are trying to find A --> C, rowsort"
Tab of A -- > B and B --> C relationships, where we are trying to find A --> C, rowsort

.     tab relationship1 relationship2, rowsort m

                     |                                                                                 rel2
                rel1 |  biochild     biomom     biodad  stepchild    stepmom    stepdad  adoptchil   adoptmom   adoptdad     spouse  grandpare    sibling    partner      child   f_parent |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
            biochild |    13,605    527,420    370,836      9,306      8,786     19,290        141      3,449      3,717         40     16,463      5,913      6,767         23      1,384 | 1,020,021 
          grandchild |        10     11,147      5,316        414        328        517          0        324        192     14,507     33,792        464        699          3         55 |    73,242 
           stepchild |       527      8,786     19,290        335      5,926     20,316          1        170        429         10        845        261        328          0        123 |    60,044 
           other_rel |       404     11,747      9,868      1,424        620      1,286          0        145        180      9,307      3,671      2,417        696          4         97 |    56,521 
               norel |        51      6,428      4,705        328        231        542          0        242        105      4,105      1,791      1,050      1,356          1        185 |    39,452 
              spouse |     2,608         19         21      3,582          0         10         41          0          0          0     14,507      2,296          0          6      1,098 |    37,610 
          adoptchild |        51      3,449      3,717        103        170        429          0      5,600      4,924          0        516         60        129          0        572 |    20,392 
             sibling |         0      4,267      1,646          0        110        151          0         60          0      2,296        464      4,692        496          0          2 |    17,671 
              biomom |     1,129      6,680      2,453         87        243         86          1         19         24      1,826         10          0         38          0          1 |    13,052 
             partner |        38      5,390      1,377        288        188        140          0         96         33          0        699        496          0          0        114 |    10,911 
             stepmom |         7      4,359      1,408          4        124        140          0         12         73      2,419        351          0        185          6          6 |    10,086 
              biodad |     1,129      3,547        925          7         49        149          0          2          6        782          0          0          0          0          0 |     6,597 
             stepdad |        87      2,196      1,343          4         39         32          0         12          6      1,163         63          0        103          6          3 |     5,829 
             f_child |         1        702        682          9         67         56          0        452        120      1,098         55          2        114          0      1,842 |     5,482 
                   . |         1         30        103         12          3         15          0          0          0         10         12         20          0          0          0 |       403 
            adoptdad |         1         91          4          0          0          0          0          0          0         27          0          0          0          0          0 |       123 
            adoptmom |         0         29         17          0          1          0          0          0          0         14          0          0          0          0          0 |        61 
                 mom |         0          8          3          6          0          0          0          0          0          3          3          0          0          0          0 |        26 
                 dad |         0          0         12          6          0          0          0          0          0          3          0          0          0          0          0 |        23 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |    19,649    596,295    423,726     15,915     16,885     43,159        184     10,583      9,809     37,610     73,242     17,671     10,911         49      5,482 | 1,377,546 


                     |               rel2
                rel1 | other_rel      norel          . |     Total
---------------------+---------------------------------+----------
            biochild |    21,615     11,133        133 | 1,020,021 
          grandchild |     3,671      1,791         12 |    73,242 
           stepchild |     1,906        773         18 |    60,044 
           other_rel |    12,292      2,288         75 |    56,521 
               norel |     2,288     16,024         20 |    39,452 
              spouse |     9,307      4,105         10 |    37,610 
          adoptchild |       325        347          0 |    20,392 
             sibling |     2,417      1,050         20 |    17,671 
              biomom |       403         51          1 |    13,052 
             partner |       696      1,356          0 |    10,911 
             stepmom |       780        201         11 |    10,086 
              biodad |         1          0          0 |     6,597 
             stepdad |       644        127          1 |     5,829 
             f_child |        97        185          0 |     5,482 
                   . |        75         20        102 |       403 
            adoptdad |         0          0          0 |       123 
            adoptmom |         0          0          0 |        61 
                 mom |         2          1          0 |        26 
                 dad |         2          0          0 |        23 
---------------------+---------------------------------+----------
               Total |    56,521     39,452        403 | 1,377,546 

. 
.     * Now given the A --> B --> C relationships, what can we figure out for A --> C?
.     gen relationship = .
(1,377,546 missing values generated)

.     label values relationship relationship

. 
.     local all_child_types child biochild stepchild adoptchild

.     local all_parent_types mom biomom stepmom adoptmom dad biodad stepdad adoptdad parent

. 
. foreach rel1 in `all_child_types' {
  2.   *read as set generate_relationship equal to child if rel1 is any of the child types and rel2 is spouse
.   generate_relationship "child"                                 "`rel1'"        "spouse"
  3.   generate_relationship "child"                                 "`rel1'"        "partner"
  4.   generate_relationship "greatgrandchild"               "`rel1'"        "grandchild"
  5.   generate_relationship "auntuncle_or_parent"   "`rel1'"        "grandparent"
  6.   generate_relationship "nephewniece"                   "`rel1'"        "sibling"
  7.   generate_relationship "cousin"                                "`rel1'"        "auntuncle"
  8.   generate_relationship "other_rel"                     "spouse"        "`rel1'" 
  9.   generate_relationship "other_rel_p"                   "partner"       "`rel1'" 
 10.   
.   foreach rel2 in `all_child_types' {
 11.      generate_relationship "grandchild"                 "`rel1'"        "`rel2'"
 12.   }
 13.   
.   foreach rel2 in `all_parent_types' {
 14.      generate_relationship "sibling"                    "`rel1'"        "`rel2'"
 15.   }
 16. 
.   generate_relationship "other_rel"                     "`rel1'"        "other_rel"
 17.   generate_relationship "other_rel"                     "other_rel" "`rel1'" 
 18.   generate_relationship "norel"                                 "`rel1'"        "norel"
 19.   generate_relationship "norel"                                 "norel"         "`rel1'" 
 20.   generate_relationship "f_sib"                                 "`rel1'"        "f_child"
 21.   generate_relationship "f_sib"                                 "f_child"       "`rel1'"
 22.   generate_relationship "f_sib"                                 "`rel1'"        "f_parent"
 23. }
Generating child from child spouse
(0 real changes made)
Generating child from child partner
(0 real changes made)
Generating greatgrandchild from child grandchild
(0 real changes made)
Generating auntuncle_or_parent from child grandparent
(0 real changes made)
Generating nephewniece from child sibling
(0 real changes made)
Generating cousin from child auntuncle
(0 real changes made)
Generating other_rel from spouse child
(6 real changes made)
Generating other_rel_p from partner child
(0 real changes made)
Generating grandchild from child child
(0 real changes made)
Generating grandchild from child biochild
(0 real changes made)
Generating grandchild from child stepchild
(0 real changes made)
Generating grandchild from child adoptchild
(0 real changes made)
Generating sibling from child mom
(0 real changes made)
Generating sibling from child biomom
(0 real changes made)
Generating sibling from child stepmom
(0 real changes made)
Generating sibling from child adoptmom
(0 real changes made)
Generating sibling from child dad
(0 real changes made)
Generating sibling from child biodad
(0 real changes made)
Generating sibling from child stepdad
(0 real changes made)
Generating sibling from child adoptdad
(0 real changes made)
Generating sibling from child parent
(0 real changes made)
Generating other_rel from child other_rel
(0 real changes made)
Generating other_rel from other_rel child
(4 real changes made)
Generating norel from child norel
(0 real changes made)
Generating norel from norel child
(1 real change made)
Generating f_sib from child f_child
(0 real changes made)
Generating f_sib from f_child child
(0 real changes made)
Generating f_sib from child f_parent
(0 real changes made)
Generating child from biochild spouse
(40 real changes made)
Generating child from biochild partner
(6,767 real changes made)
Generating greatgrandchild from biochild grandchild
(0 real changes made)
Generating auntuncle_or_parent from biochild grandparent
(16,463 real changes made)
Generating nephewniece from biochild sibling
(5,913 real changes made)
Generating cousin from biochild auntuncle
(0 real changes made)
Generating other_rel from spouse biochild
(2,608 real changes made)
Generating other_rel_p from partner biochild
(38 real changes made)
Generating grandchild from biochild child
(23 real changes made)
Generating grandchild from biochild biochild
(13,605 real changes made)
Generating grandchild from biochild stepchild
(9,306 real changes made)
Generating grandchild from biochild adoptchild
(141 real changes made)
Generating sibling from biochild mom
(0 real changes made)
Generating sibling from biochild biomom
(527,420 real changes made)
Generating sibling from biochild stepmom
(8,786 real changes made)
Generating sibling from biochild adoptmom
(3,449 real changes made)
Generating sibling from biochild dad
(0 real changes made)
Generating sibling from biochild biodad
(370,836 real changes made)
Generating sibling from biochild stepdad
(19,290 real changes made)
Generating sibling from biochild adoptdad
(3,717 real changes made)
Generating sibling from biochild parent
(0 real changes made)
Generating other_rel from biochild other_rel
(21,615 real changes made)
Generating other_rel from other_rel biochild
(404 real changes made)
Generating norel from biochild norel
(11,133 real changes made)
Generating norel from norel biochild
(51 real changes made)
Generating f_sib from biochild f_child
(0 real changes made)
Generating f_sib from f_child biochild
(1 real change made)
Generating f_sib from biochild f_parent
(1,384 real changes made)
Generating child from stepchild spouse
(10 real changes made)
Generating child from stepchild partner
(328 real changes made)
Generating greatgrandchild from stepchild grandchild
(0 real changes made)
Generating auntuncle_or_parent from stepchild grandparent
(845 real changes made)
Generating nephewniece from stepchild sibling
(261 real changes made)
Generating cousin from stepchild auntuncle
(0 real changes made)
Generating other_rel from spouse stepchild
(3,582 real changes made)
Generating other_rel_p from partner stepchild
(288 real changes made)
Generating grandchild from stepchild child
(0 real changes made)
Generating grandchild from stepchild biochild
(527 real changes made)
Generating grandchild from stepchild stepchild
(335 real changes made)
Generating grandchild from stepchild adoptchild
(1 real change made)
Generating sibling from stepchild mom
(0 real changes made)
Generating sibling from stepchild biomom
(8,786 real changes made)
Generating sibling from stepchild stepmom
(5,926 real changes made)
Generating sibling from stepchild adoptmom
(170 real changes made)
Generating sibling from stepchild dad
(0 real changes made)
Generating sibling from stepchild biodad
(19,290 real changes made)
Generating sibling from stepchild stepdad
(20,316 real changes made)
Generating sibling from stepchild adoptdad
(429 real changes made)
Generating sibling from stepchild parent
(0 real changes made)
Generating other_rel from stepchild other_rel
(1,906 real changes made)
Generating other_rel from other_rel stepchild
(1,424 real changes made)
Generating norel from stepchild norel
(773 real changes made)
Generating norel from norel stepchild
(328 real changes made)
Generating f_sib from stepchild f_child
(0 real changes made)
Generating f_sib from f_child stepchild
(9 real changes made)
Generating f_sib from stepchild f_parent
(123 real changes made)
Generating child from adoptchild spouse
(0 real changes made)
Generating child from adoptchild partner
(129 real changes made)
Generating greatgrandchild from adoptchild grandchild
(0 real changes made)
Generating auntuncle_or_parent from adoptchild grandparent
(516 real changes made)
Generating nephewniece from adoptchild sibling
(60 real changes made)
Generating cousin from adoptchild auntuncle
(0 real changes made)
Generating other_rel from spouse adoptchild
(41 real changes made)
Generating other_rel_p from partner adoptchild
(0 real changes made)
Generating grandchild from adoptchild child
(0 real changes made)
Generating grandchild from adoptchild biochild
(51 real changes made)
Generating grandchild from adoptchild stepchild
(103 real changes made)
Generating grandchild from adoptchild adoptchild
(0 real changes made)
Generating sibling from adoptchild mom
(0 real changes made)
Generating sibling from adoptchild biomom
(3,449 real changes made)
Generating sibling from adoptchild stepmom
(170 real changes made)
Generating sibling from adoptchild adoptmom
(5,600 real changes made)
Generating sibling from adoptchild dad
(0 real changes made)
Generating sibling from adoptchild biodad
(3,717 real changes made)
Generating sibling from adoptchild stepdad
(429 real changes made)
Generating sibling from adoptchild adoptdad
(4,924 real changes made)
Generating sibling from adoptchild parent
(0 real changes made)
Generating other_rel from adoptchild other_rel
(325 real changes made)
Generating other_rel from other_rel adoptchild
(0 real changes made)
Generating norel from adoptchild norel
(347 real changes made)
Generating norel from norel adoptchild
(0 real changes made)
Generating f_sib from adoptchild f_child
(0 real changes made)
Generating f_sib from f_child adoptchild
(0 real changes made)
Generating f_sib from adoptchild f_parent
(572 real changes made)

. 
. foreach rel2 in `all_child_types' {
  2.   generate_relationship "greatgrandchild"               "grandchild" "`rel2'"
  3.   generate_relationship "parent" "sibling"              "`rel2'"
  4.   generate_relationship "parent_or_relative"    "grandparent" "`rel2'"
  5.   generate_relationship "f_sib" "f_child"               "`rel2'"
  6. }
Generating greatgrandchild from grandchild child
(3 real changes made)
Generating parent from sibling child
(0 real changes made)
Generating parent_or_relative from grandparent child
(0 real changes made)
Generating f_sib from f_child child
(0 real changes made)
Generating greatgrandchild from grandchild biochild
(10 real changes made)
Generating parent from sibling biochild
(0 real changes made)
Generating parent_or_relative from grandparent biochild
(0 real changes made)
Generating f_sib from f_child biochild
(0 real changes made)
Generating greatgrandchild from grandchild stepchild
(414 real changes made)
Generating parent from sibling stepchild
(0 real changes made)
Generating parent_or_relative from grandparent stepchild
(0 real changes made)
Generating f_sib from f_child stepchild
(0 real changes made)
Generating greatgrandchild from grandchild adoptchild
(0 real changes made)
Generating parent from sibling adoptchild
(0 real changes made)
Generating parent_or_relative from grandparent adoptchild
(0 real changes made)
Generating f_sib from f_child adoptchild
(0 real changes made)

. 
. foreach rel1 in `all_parent_types' {
  2.    foreach rel2 in `all_parent_types' {
  3.       generate_relationship "grandparent"               "`rel1'"        "`rel2'"
  4.    }
  5.    
.    * Should we call these partnerS?  Or something less certain?
.    foreach rel2 in `all_child_types' {
  6.       generate_relationship "partner"                   "`rel1'"        "`rel2'"
  7.    }
  8. 
.    generate_relationship "greatgrandparent"     "`rel1'"        "grandparent"
  9.    generate_relationship "parent"                               "`rel1'"        "sibling"
 10.    generate_relationship "child_or_relative"    "`rel1'"        "grandchild"
 11.    generate_relationship "other_rel"                    "`rel1'"        "spouse"
 12.    generate_relationship "other_rel_p"                  "`rel1'"        "partner"
 13.    generate_relationship "other_rel"                    "`rel1'"        "other_rel"
 14.    generate_relationship "other_rel"                    "other_rel" "`rel1'" 
 15. 
.    generate_relationship "norel"                                "`rel1'"        "norel"
 16.    generate_relationship "norel"                                "norel"         "`rel1'" 
 17. }
Generating grandparent from mom mom
(0 real changes made)
Generating grandparent from mom biomom
(8 real changes made)
Generating grandparent from mom stepmom
(0 real changes made)
Generating grandparent from mom adoptmom
(0 real changes made)
Generating grandparent from mom dad
(0 real changes made)
Generating grandparent from mom biodad
(3 real changes made)
Generating grandparent from mom stepdad
(0 real changes made)
Generating grandparent from mom adoptdad
(0 real changes made)
Generating grandparent from mom parent
(0 real changes made)
Generating partner from mom child
(0 real changes made)
Generating partner from mom biochild
(0 real changes made)
Generating partner from mom stepchild
(6 real changes made)
Generating partner from mom adoptchild
(0 real changes made)
Generating greatgrandparent from mom grandparent
(3 real changes made)
Generating parent from mom sibling
(0 real changes made)
Generating child_or_relative from mom grandchild
(0 real changes made)
Generating other_rel from mom spouse
(3 real changes made)
Generating other_rel_p from mom partner
(0 real changes made)
Generating other_rel from mom other_rel
(2 real changes made)
Generating other_rel from other_rel mom
(0 real changes made)
Generating norel from mom norel
(1 real change made)
Generating norel from norel mom
(0 real changes made)
Generating grandparent from biomom mom
(0 real changes made)
Generating grandparent from biomom biomom
(6,680 real changes made)
Generating grandparent from biomom stepmom
(243 real changes made)
Generating grandparent from biomom adoptmom
(19 real changes made)
Generating grandparent from biomom dad
(0 real changes made)
Generating grandparent from biomom biodad
(2,453 real changes made)
Generating grandparent from biomom stepdad
(86 real changes made)
Generating grandparent from biomom adoptdad
(24 real changes made)
Generating grandparent from biomom parent
(0 real changes made)
Generating partner from biomom child
(0 real changes made)
Generating partner from biomom biochild
(1,129 real changes made)
Generating partner from biomom stepchild
(87 real changes made)
Generating partner from biomom adoptchild
(1 real change made)
Generating greatgrandparent from biomom grandparent
(10 real changes made)
Generating parent from biomom sibling
(0 real changes made)
Generating child_or_relative from biomom grandchild
(0 real changes made)
Generating other_rel from biomom spouse
(1,826 real changes made)
Generating other_rel_p from biomom partner
(38 real changes made)
Generating other_rel from biomom other_rel
(403 real changes made)
Generating other_rel from other_rel biomom
(11,747 real changes made)
Generating norel from biomom norel
(51 real changes made)
Generating norel from norel biomom
(6,428 real changes made)
Generating grandparent from stepmom mom
(0 real changes made)
Generating grandparent from stepmom biomom
(4,359 real changes made)
Generating grandparent from stepmom stepmom
(124 real changes made)
Generating grandparent from stepmom adoptmom
(12 real changes made)
Generating grandparent from stepmom dad
(0 real changes made)
Generating grandparent from stepmom biodad
(1,408 real changes made)
Generating grandparent from stepmom stepdad
(140 real changes made)
Generating grandparent from stepmom adoptdad
(73 real changes made)
Generating grandparent from stepmom parent
(0 real changes made)
Generating partner from stepmom child
(6 real changes made)
Generating partner from stepmom biochild
(7 real changes made)
Generating partner from stepmom stepchild
(4 real changes made)
Generating partner from stepmom adoptchild
(0 real changes made)
Generating greatgrandparent from stepmom grandparent
(351 real changes made)
Generating parent from stepmom sibling
(0 real changes made)
Generating child_or_relative from stepmom grandchild
(0 real changes made)
Generating other_rel from stepmom spouse
(2,419 real changes made)
Generating other_rel_p from stepmom partner
(185 real changes made)
Generating other_rel from stepmom other_rel
(780 real changes made)
Generating other_rel from other_rel stepmom
(620 real changes made)
Generating norel from stepmom norel
(201 real changes made)
Generating norel from norel stepmom
(231 real changes made)
Generating grandparent from adoptmom mom
(0 real changes made)
Generating grandparent from adoptmom biomom
(29 real changes made)
Generating grandparent from adoptmom stepmom
(1 real change made)
Generating grandparent from adoptmom adoptmom
(0 real changes made)
Generating grandparent from adoptmom dad
(0 real changes made)
Generating grandparent from adoptmom biodad
(17 real changes made)
Generating grandparent from adoptmom stepdad
(0 real changes made)
Generating grandparent from adoptmom adoptdad
(0 real changes made)
Generating grandparent from adoptmom parent
(0 real changes made)
Generating partner from adoptmom child
(0 real changes made)
Generating partner from adoptmom biochild
(0 real changes made)
Generating partner from adoptmom stepchild
(0 real changes made)
Generating partner from adoptmom adoptchild
(0 real changes made)
Generating greatgrandparent from adoptmom grandparent
(0 real changes made)
Generating parent from adoptmom sibling
(0 real changes made)
Generating child_or_relative from adoptmom grandchild
(0 real changes made)
Generating other_rel from adoptmom spouse
(14 real changes made)
Generating other_rel_p from adoptmom partner
(0 real changes made)
Generating other_rel from adoptmom other_rel
(0 real changes made)
Generating other_rel from other_rel adoptmom
(145 real changes made)
Generating norel from adoptmom norel
(0 real changes made)
Generating norel from norel adoptmom
(242 real changes made)
Generating grandparent from dad mom
(0 real changes made)
Generating grandparent from dad biomom
(0 real changes made)
Generating grandparent from dad stepmom
(0 real changes made)
Generating grandparent from dad adoptmom
(0 real changes made)
Generating grandparent from dad dad
(0 real changes made)
Generating grandparent from dad biodad
(12 real changes made)
Generating grandparent from dad stepdad
(0 real changes made)
Generating grandparent from dad adoptdad
(0 real changes made)
Generating grandparent from dad parent
(0 real changes made)
Generating partner from dad child
(0 real changes made)
Generating partner from dad biochild
(0 real changes made)
Generating partner from dad stepchild
(6 real changes made)
Generating partner from dad adoptchild
(0 real changes made)
Generating greatgrandparent from dad grandparent
(0 real changes made)
Generating parent from dad sibling
(0 real changes made)
Generating child_or_relative from dad grandchild
(0 real changes made)
Generating other_rel from dad spouse
(3 real changes made)
Generating other_rel_p from dad partner
(0 real changes made)
Generating other_rel from dad other_rel
(2 real changes made)
Generating other_rel from other_rel dad
(0 real changes made)
Generating norel from dad norel
(0 real changes made)
Generating norel from norel dad
(0 real changes made)
Generating grandparent from biodad mom
(0 real changes made)
Generating grandparent from biodad biomom
(3,547 real changes made)
Generating grandparent from biodad stepmom
(49 real changes made)
Generating grandparent from biodad adoptmom
(2 real changes made)
Generating grandparent from biodad dad
(0 real changes made)
Generating grandparent from biodad biodad
(925 real changes made)
Generating grandparent from biodad stepdad
(149 real changes made)
Generating grandparent from biodad adoptdad
(6 real changes made)
Generating grandparent from biodad parent
(0 real changes made)
Generating partner from biodad child
(0 real changes made)
Generating partner from biodad biochild
(1,129 real changes made)
Generating partner from biodad stepchild
(7 real changes made)
Generating partner from biodad adoptchild
(0 real changes made)
Generating greatgrandparent from biodad grandparent
(0 real changes made)
Generating parent from biodad sibling
(0 real changes made)
Generating child_or_relative from biodad grandchild
(0 real changes made)
Generating other_rel from biodad spouse
(782 real changes made)
Generating other_rel_p from biodad partner
(0 real changes made)
Generating other_rel from biodad other_rel
(1 real change made)
Generating other_rel from other_rel biodad
(9,868 real changes made)
Generating norel from biodad norel
(0 real changes made)
Generating norel from norel biodad
(4,705 real changes made)
Generating grandparent from stepdad mom
(0 real changes made)
Generating grandparent from stepdad biomom
(2,196 real changes made)
Generating grandparent from stepdad stepmom
(39 real changes made)
Generating grandparent from stepdad adoptmom
(12 real changes made)
Generating grandparent from stepdad dad
(0 real changes made)
Generating grandparent from stepdad biodad
(1,343 real changes made)
Generating grandparent from stepdad stepdad
(32 real changes made)
Generating grandparent from stepdad adoptdad
(6 real changes made)
Generating grandparent from stepdad parent
(0 real changes made)
Generating partner from stepdad child
(6 real changes made)
Generating partner from stepdad biochild
(87 real changes made)
Generating partner from stepdad stepchild
(4 real changes made)
Generating partner from stepdad adoptchild
(0 real changes made)
Generating greatgrandparent from stepdad grandparent
(63 real changes made)
Generating parent from stepdad sibling
(0 real changes made)
Generating child_or_relative from stepdad grandchild
(0 real changes made)
Generating other_rel from stepdad spouse
(1,163 real changes made)
Generating other_rel_p from stepdad partner
(103 real changes made)
Generating other_rel from stepdad other_rel
(644 real changes made)
Generating other_rel from other_rel stepdad
(1,286 real changes made)
Generating norel from stepdad norel
(127 real changes made)
Generating norel from norel stepdad
(542 real changes made)
Generating grandparent from adoptdad mom
(0 real changes made)
Generating grandparent from adoptdad biomom
(91 real changes made)
Generating grandparent from adoptdad stepmom
(0 real changes made)
Generating grandparent from adoptdad adoptmom
(0 real changes made)
Generating grandparent from adoptdad dad
(0 real changes made)
Generating grandparent from adoptdad biodad
(4 real changes made)
Generating grandparent from adoptdad stepdad
(0 real changes made)
Generating grandparent from adoptdad adoptdad
(0 real changes made)
Generating grandparent from adoptdad parent
(0 real changes made)
Generating partner from adoptdad child
(0 real changes made)
Generating partner from adoptdad biochild
(1 real change made)
Generating partner from adoptdad stepchild
(0 real changes made)
Generating partner from adoptdad adoptchild
(0 real changes made)
Generating greatgrandparent from adoptdad grandparent
(0 real changes made)
Generating parent from adoptdad sibling
(0 real changes made)
Generating child_or_relative from adoptdad grandchild
(0 real changes made)
Generating other_rel from adoptdad spouse
(27 real changes made)
Generating other_rel_p from adoptdad partner
(0 real changes made)
Generating other_rel from adoptdad other_rel
(0 real changes made)
Generating other_rel from other_rel adoptdad
(180 real changes made)
Generating norel from adoptdad norel
(0 real changes made)
Generating norel from norel adoptdad
(105 real changes made)
Generating grandparent from parent mom
(0 real changes made)
Generating grandparent from parent biomom
(0 real changes made)
Generating grandparent from parent stepmom
(0 real changes made)
Generating grandparent from parent adoptmom
(0 real changes made)
Generating grandparent from parent dad
(0 real changes made)
Generating grandparent from parent biodad
(0 real changes made)
Generating grandparent from parent stepdad
(0 real changes made)
Generating grandparent from parent adoptdad
(0 real changes made)
Generating grandparent from parent parent
(0 real changes made)
Generating partner from parent child
(0 real changes made)
Generating partner from parent biochild
(0 real changes made)
Generating partner from parent stepchild
(0 real changes made)
Generating partner from parent adoptchild
(0 real changes made)
Generating greatgrandparent from parent grandparent
(0 real changes made)
Generating parent from parent sibling
(0 real changes made)
Generating child_or_relative from parent grandchild
(0 real changes made)
Generating other_rel from parent spouse
(0 real changes made)
Generating other_rel_p from parent partner
(0 real changes made)
Generating other_rel from parent other_rel
(0 real changes made)
Generating other_rel from other_rel parent
(0 real changes made)
Generating norel from parent norel
(0 real changes made)
Generating norel from norel parent
(0 real changes made)

. 
.     foreach rel2 in `all_parent_types' {
  2.         generate_relationship "parent"                  "spouse" "`rel2'"
  3.         generate_relationship "parent"                  "partner" "`rel2'"
  4. 
.         generate_relationship "auntuncle"               "sibling" "`rel2'"
  5. 
.         generate_relationship "child_or_nephewniece" "grandchild" "`rel2'"
  6. 
.         generate_relationship "greatgrandparent" "grandparent" "`rel2'"
  7. 
.         generate_relationship "norel"                   "f_child" "`rel2'"
  8.     }
Generating parent from spouse mom
(0 real changes made)
Generating parent from partner mom
(0 real changes made)
Generating auntuncle from sibling mom
(0 real changes made)
Generating child_or_nephewniece from grandchild mom
(0 real changes made)
Generating greatgrandparent from grandparent mom
(0 real changes made)
Generating norel from f_child mom
(0 real changes made)
Generating parent from spouse biomom
(19 real changes made)
Generating parent from partner biomom
(5,390 real changes made)
Generating auntuncle from sibling biomom
(4,267 real changes made)
Generating child_or_nephewniece from grandchild biomom
(11,147 real changes made)
Generating greatgrandparent from grandparent biomom
(0 real changes made)
Generating norel from f_child biomom
(702 real changes made)
Generating parent from spouse stepmom
(0 real changes made)
Generating parent from partner stepmom
(188 real changes made)
Generating auntuncle from sibling stepmom
(110 real changes made)
Generating child_or_nephewniece from grandchild stepmom
(328 real changes made)
Generating greatgrandparent from grandparent stepmom
(0 real changes made)
Generating norel from f_child stepmom
(67 real changes made)
Generating parent from spouse adoptmom
(0 real changes made)
Generating parent from partner adoptmom
(96 real changes made)
Generating auntuncle from sibling adoptmom
(60 real changes made)
Generating child_or_nephewniece from grandchild adoptmom
(324 real changes made)
Generating greatgrandparent from grandparent adoptmom
(0 real changes made)
Generating norel from f_child adoptmom
(452 real changes made)
Generating parent from spouse dad
(0 real changes made)
Generating parent from partner dad
(0 real changes made)
Generating auntuncle from sibling dad
(0 real changes made)
Generating child_or_nephewniece from grandchild dad
(0 real changes made)
Generating greatgrandparent from grandparent dad
(0 real changes made)
Generating norel from f_child dad
(0 real changes made)
Generating parent from spouse biodad
(21 real changes made)
Generating parent from partner biodad
(1,377 real changes made)
Generating auntuncle from sibling biodad
(1,646 real changes made)
Generating child_or_nephewniece from grandchild biodad
(5,316 real changes made)
Generating greatgrandparent from grandparent biodad
(0 real changes made)
Generating norel from f_child biodad
(682 real changes made)
Generating parent from spouse stepdad
(10 real changes made)
Generating parent from partner stepdad
(140 real changes made)
Generating auntuncle from sibling stepdad
(151 real changes made)
Generating child_or_nephewniece from grandchild stepdad
(517 real changes made)
Generating greatgrandparent from grandparent stepdad
(0 real changes made)
Generating norel from f_child stepdad
(56 real changes made)
Generating parent from spouse adoptdad
(0 real changes made)
Generating parent from partner adoptdad
(33 real changes made)
Generating auntuncle from sibling adoptdad
(0 real changes made)
Generating child_or_nephewniece from grandchild adoptdad
(192 real changes made)
Generating greatgrandparent from grandparent adoptdad
(0 real changes made)
Generating norel from f_child adoptdad
(120 real changes made)
Generating parent from spouse parent
(0 real changes made)
Generating parent from partner parent
(0 real changes made)
Generating auntuncle from sibling parent
(0 real changes made)
Generating child_or_nephewniece from grandchild parent
(0 real changes made)
Generating greatgrandparent from grandparent parent
(0 real changes made)
Generating norel from f_child parent
(0 real changes made)

. 
. *** rel1 == grandchild
. generate_relationship "grandchild"                              "grandchild" "spouse"
Generating grandchild from grandchild spouse
(14,507 real changes made)

. generate_relationship "grandchild_p"                    "grandchild" "partner"
Generating grandchild_p from grandchild partner
(699 real changes made)

. generate_relationship "other_rel"                               "grandchild" "sibling"
Generating other_rel from grandchild sibling
(464 real changes made)

. generate_relationship "sibling_or_cousin"               "grandchild" "grandparent"
Generating sibling_or_cousin from grandchild grandparent
(33,792 real changes made)

. generate_relationship "norel"                                   "grandchild" "norel"
Generating norel from grandchild norel
(1,791 real changes made)

. generate_relationship "other_rel"                               "grandchild" "other_rel"
Generating other_rel from grandchild other_rel
(3,671 real changes made)

. 
. *** rel2 == grandchild
. generate_relationship "norel"                                   "norel" "grandchild" 
Generating norel from norel grandchild
(0 real changes made)

. 
. 
. *** rel1 == grandparent
. generate_relationship "other_rel"                               "grandparent" "spouse"
Generating other_rel from grandparent spouse
(0 real changes made)

. generate_relationship "other_rel_p"                     "grandparent" "partner"
Generating other_rel_p from grandparent partner
(0 real changes made)

. generate_relationship "norel"                                   "grandparent" "norel"
Generating norel from grandparent norel
(0 real changes made)

. 
. *** rel2 == grandparent
. generate_relationship "other_rel"                               "other_rel" "grandparent" 
Generating other_rel from other_rel grandparent
(3,671 real changes made)

. generate_relationship "norel"                                   "norel" "grandparent" 
Generating norel from norel grandparent
(1,791 real changes made)

. 
. 
. *** rel1 == sibling
. generate_relationship "sibling"                                 "sibling" "sibling"
Generating sibling from sibling sibling
(4,692 real changes made)

. generate_relationship "other_rel"                               "sibling" "spouse"
Generating other_rel from sibling spouse
(2,296 real changes made)

. generate_relationship "other_rel_p"                     "sibling" "partner"
Generating other_rel_p from sibling partner
(496 real changes made)

. generate_relationship "other_rel"                               "sibling" "grandparent"
Generating other_rel from sibling grandparent
(464 real changes made)

. generate_relationship "other_rel"                               "sibling" "other_rel"
Generating other_rel from sibling other_rel
(2,417 real changes made)

. generate_relationship "norel"                                   "sibling" "norel"
Generating norel from sibling norel
(1,050 real changes made)

. 
. *** rel2 == sibling
. generate_relationship "other_rel"                               "other_rel" "sibling" 
Generating other_rel from other_rel sibling
(2,417 real changes made)

. generate_relationship "norel"                                   "norel" "sibling" 
Generating norel from norel sibling
(1,050 real changes made)

. 
. *** rel1 == spouse / partner
. generate_relationship "grandparent"                     "spouse" "grandparent"
Generating grandparent from spouse grandparent
(14,507 real changes made)

. generate_relationship "grandparent_p"                   "partner" "grandparent"
Generating grandparent_p from partner grandparent
(699 real changes made)

. generate_relationship "other_rel"                               "spouse" "grandchild"
Generating other_rel from spouse grandchild
(0 real changes made)

. generate_relationship "other_rel_p"                     "partner" "grandchild"
Generating other_rel_p from partner grandchild
(0 real changes made)

. generate_relationship "other_rel"                               "spouse" "sibling"
Generating other_rel from spouse sibling
(2,296 real changes made)

. generate_relationship "other_rel_p"                     "partner" "sibling"
Generating other_rel_p from partner sibling
(496 real changes made)

. generate_relationship "other_rel"                               "spouse" "other_rel"
Generating other_rel from spouse other_rel
(9,307 real changes made)

. generate_relationship "other_rel_p"                     "partner" "other_rel"
Generating other_rel_p from partner other_rel
(696 real changes made)

. generate_relationship "norel"                                   "spouse" "norel"
Generating norel from spouse norel
(4,105 real changes made)

. generate_relationship "dontknow"                                "partner" "norel"
Generating dontknow from partner norel
(1,356 real changes made)

. 
. *** rel2 == spouse / partner
. generate_relationship "other_rel_p"                     "other_rel" "partner" 
Generating other_rel_p from other_rel partner
(696 real changes made)

. generate_relationship "other_rel"                               "other_rel" "spouse" 
Generating other_rel from other_rel spouse
(9,307 real changes made)

. generate_relationship "norel"                                   "norel" "spouse" 
Generating norel from norel spouse
(4,105 real changes made)

. generate_relationship "dontknow"                                "norel" "partner" 
Generating dontknow from norel partner
(1,356 real changes made)

. 
. *** rel1 == f_child
. generate_relationship "f_child"                                 "f_child" "spouse" 
Generating f_child from f_child spouse
(1,098 real changes made)

. generate_relationship "f_parent"                                "spouse" "f_child"
Generating f_parent from spouse f_child
(0 real changes made)

. generate_relationship "f_parent"                                "f_child" "partner"
Generating f_parent from f_child partner
(114 real changes made)

. 
. *** rel2 == f_parent
. generate_relationship "f_sib"                                   "f_child" "f_parent"
Generating f_sib from f_child f_parent
(1,842 real changes made)

. generate_relationship "f_parent"                                "spouse" "f_parent"
Generating f_parent from spouse f_parent
(1,098 real changes made)

. generate_relationship "f_parent"                                "partner" "f_parent"
Generating f_parent from partner f_parent
(114 real changes made)

.         
. *** Other
. generate_relationship "other_rel"                               "other_rel" "other_rel" 
Generating other_rel from other_rel other_rel
(12,292 real changes made)

. 
. generate_relationship "norel"                                   "other_rel" "norel"
Generating norel from other_rel norel
(2,288 real changes made)

. generate_relationship "norel"                                   "norel" "other_rel" 
Generating norel from norel other_rel
(2,288 real changes made)

. 
. generate_relationship "dontknow"                                "norel" "norel"
Generating dontknow from norel norel
(16,024 real changes made)

. 
. display "How are we doing at finding relationships?"
How are we doing at finding relationships?

. mdesc relationship 

    Variable    |     Missing          Total     Percent Missing
----------------+-----------------------------------------------
   relationship |       1,392      1,377,546           0.10
----------------+-----------------------------------------------

. 
. * Report relationship pairs we're not handling yet.
.  preserve

.         display "Keeping just missing relationships so we can show the pairs"
Keeping just missing relationships so we can show the pairs

.         keep if (missing(relationship))
(1,376,154 observations deleted)

.         display "Relationship pairs we do not currently handle, rowsort"
Relationship pairs we do not currently handle, rowsort

.         tab relationship1 relationship2, rowsort m

                     |                                                                      rel2
                rel1 |  biochild     biomom     biodad  stepchild    stepmom    stepdad     spouse  grandpare    sibling   f_parent  other_rel      norel          . |     Total
---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+----------
                   . |         1         30        103         12          3         15         10         12         20          0         75         20        102 |       403 
             f_child |         0          0          0          0          0          0          0         55          2          0         97        185          0 |       339 
               norel |         0          0          0          0          0          0          0          0          0        185          0          0         20 |       205 
           other_rel |         0          0          0          0          0          0          0          0          0         97          0          0         75 |       172 
            biochild |         0          0          0          0          0          0          0          0          0          0          0          0        133 |       133 
          grandchild |         0          0          0          0          0          0          0          0          0         55          0          0         12 |        67 
             sibling |         0          0          0          0          0          0          0          0          0          2          0          0         20 |        22 
           stepchild |         0          0          0          0          0          0          0          0          0          0          0          0         18 |        18 
             stepmom |         0          0          0          0          0          0          0          0          0          6          0          0         11 |        17 
              spouse |         0          0          0          0          0          0          0          0          0          0          0          0         10 |        10 
             stepdad |         0          0          0          0          0          0          0          0          0          3          0          0          1 |         4 
              biomom |         0          0          0          0          0          0          0          0          0          1          0          0          1 |         2 
---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |         1         30        103         12          3         15         10         67         22        349        172        205        403 |     1,392 

.  restore

. 
.  * Save just records for which we understand A --> C.
.  display "Keeping only those pairs for which we understand relationships"
Keeping only those pairs for which we understand relationships

.  keep if (!missing(relationship))
(1,392 observations deleted)

. 
.  * We force the drop because we don't care about the details if the end result is the same.
.  duplicates drop ssuid shhadid swave relfrom relto relationship, force

Duplicates in terms of ssuid shhadid swave relfrom relto relationship

(451,210 observations deleted)

. 
.  gen reason = string(relationship1) + " " + string(relationship2) + " via " + string(intermediate_person)

.  drop intermediate_person relationship1 relationship2 reason1 reason2

. 
. ********************************************************************************
. * Section: Checking records with more than one relationship in a wave
. *          and select "best" relationship when more than one relationship type.
. ********************************************************************************
. 
. sort ssuid shhadid swave relfrom relto

. by ssuid shhadid swave relfrom relto:  gen numrels_tc1 = _N

. by ssuid shhadid swave relfrom relto:  gen relnum_tc1 = _n

. 
. display "How many relationships have we generated per person-wave?"
How many relationships have we generated per person-wave?

. tab numrels_tc1

numrels_tc1 |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |    847,528       91.63       91.63
          2 |     77,380        8.37      100.00
          3 |         36        0.00      100.00
------------+-----------------------------------
      Total |    924,944      100.00

. 
. *reshape so that we can compare relationships for pairs (within wave) with more than one relationship type      
. reshape wide relationship reason, i(ssuid shhadid swave relfrom relto) j(relnum_tc1)
(note: j = 1 2 3)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                   924944   ->  886230
Number of variables                  10   ->      13
j variable (3 values)        relnum_tc1   ->   (dropped)
xij variables:
                           relationship   ->   relationship1 relationship2 relationship3
                                 reason   ->   reason1 reason2 reason3
-----------------------------------------------------------------------------

. 
. save "$tempdir/relationships_tc1_wide", $replace
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/relationships_tc1_wide.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/relationships_tc1_wide.dta saved

. 
. *Make the easy decision that if there is only one piece of information we will take it.
. gen relationship:relationship=relationship1 if missing(relationship2)
(38,702 missing values generated)

. 
. display "Relationships for which there is only one candidate"
Relationships for which there is only one candidate

. tab relationship

        relationship |      Freq.     Percent        Cum.
---------------------+-----------------------------------
          grandchild |     24,470        2.89        2.89
        grandchild_p |        599        0.07        2.96
         grandparent |     24,470        2.89        5.85
       grandparent_p |        599        0.07        5.92
             sibling |    556,750       65.69       71.61
             partner |        152        0.02       71.62
             f_child |      1,098        0.13       71.75
               child |      7,218        0.85       72.61
            f_parent |      1,326        0.16       72.76
              parent |      7,218        0.85       73.61
           auntuncle |      6,234        0.74       74.35
 auntuncle_or_parent |     17,793        2.10       76.45
     greatgrandchild |        427        0.05       76.50
    greatgrandparent |        427        0.05       76.55
         nephewniece |      6,234        0.74       77.29
child_or_nephewniece |     17,793        2.10       79.38
   sibling_or_cousin |     15,468        1.83       81.21
               f_sib |      3,931        0.46       81.67
           other_rel |     94,150       11.11       92.78
         other_rel_p |      2,990        0.35       93.14
               norel |     42,777        5.05       98.18
            dontknow |     15,404        1.82      100.00
---------------------+-----------------------------------
               Total |    847,528      100.00

.         
. * These are lists of relationships. The preferred description of the relationship is the earlier one
. * So, for example, if the same relationship is coded as biodad stepdad and auntuncle_or_parent, we'll choose biodad (below)
. local dad_relations " biodad stepdad adoptdad dad f_parent parent auntuncle_or_parent other_rel other_rel_p confused dontknow "

. local mom_relations " biomom stepmom adoptmom mom f_parent parent auntuncle_or_parent other_rel other_rel_p confused dontknow "

. local child_relations " biochild stepchild adoptchild childofpartner f_child child child_or_nephewniece child_or_relative other_rel other_rel_p confused dontknow "

. local spouse_relations " spouse partner other_rel other_rel_p norel confused dontknow "

. local sibling_relations " sibling sibling_or_cousin  f_sib other_rel other_rel_p norel confused dontknow "

. local cousin_relations " cousin sibling_or_cousin other_rel other_rel_p confused dontknow "

. local grandparent_relations " grandparent grandparent_p other_rel other_rel_p confused dontknow "

. local grandchild_relations " grandchild grandchild_p other_rel other_rel_p confused dontknow "

. local greatgrandchild_relations " greatgrandchild other_rel other_rel_p confused dontknow "

. local nephewniece_relations " nephewniece other_rel other_rel_p confused dontknow "

. local norel_relations " norel confused dontknow "

. local otherrel_relations " other_rel other_rel_p confused dontknow "

. 
. foreach r in dad mom child spouse sibling cousin grandparent grandchild greatgrandchild nephewniece norel otherrel {
  2.    make_relationship_list ``r'_relations'
  3.    * The error statement does nothing if no error was returned.  If there was, it passes the error back to the caller.
.    error _rc
  4.    
.    local `r'_rel_list = "`r(rel_list)'"
  5.    display "`r'_rel_list = ``r'_rel_list'"
  6. }
dad_rel_list = 3,6,9,11,22,23,25,35,36,39,40
mom_rel_list = 2,5,8,10,22,23,25,35,36,39,40
child_rel_list = 1,4,7,19,20,21,30,31,35,36,39,40
spouse_rel_list = 12,18,35,36,37,39,40
sibling_rel_list = 17,33,34,35,36,37,39,40
cousin_rel_list = 32,33,35,36,39,40
grandparent_rel_list = 15,16,35,36,39,40
grandchild_rel_list = 13,14,35,36,39,40
greatgrandchild_rel_list = 27,35,36,39,40
nephewniece_rel_list = 29,35,36,39,40
norel_rel_list = 37,39,40
otherrel_rel_list = 35,36,39,40

. 
. display "Relationship 1 and 2 where there is more than one relationship"
Relationship 1 and 2 where there is more than one relationship

. tab relationship1 relationship2 if missing(relationship)

                     |                                                                            2 relationship
      1 relationship | grandchil  grandchil  grandpare  grandpare    sibling    partner      child     parent  auntuncle  child_or_  sibling_o  other_rel  other_rel      norel   dontknow |     Total
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
          grandchild |         0         46          0          0          4          1          0          0          0          2          0      2,310          4         60         89 |     2,516 
        grandchild_p |        53          0          0          0          0          1          0          0          0          0          0          0          0          0          0 |        54 
         grandparent |         0          0          0         55          6          1          0          0          3          0          0      2,255          3         59         79 |     2,461 
       grandparent_p |         0          0         44          0          0          0          0          0          0          0          0          0          0          0          0 |        44 
             sibling |         4          0          2          0          0          2          1          3          7          4     10,243      2,195          0        887      1,474 |    14,822 
             partner |         1          0          1          1          0          0          3          2          0          0          0        306          5        543         47 |       909 
               child |         0          0          0          0          3          2          0          0          0          7          0          8          0          3          7 |        30 
              parent |         0          0          0          0          1          3          0          0          7          0          0         11          0          1         11 |        34 
 auntuncle_or_parent |         0          0          2          0          7          0          0          5          0          0          0          0          0          0          0 |        14 
child_or_nephewniece |         3          0          0          0         10          0          5          0          0          0          0          0          0          0          0 |        18 
   sibling_or_cousin |         0          0          0          0      8,081          0          0          0          0          0          0          0          0          0          0 |     8,081 
           other_rel |     2,295          0      2,351          0      1,687        231          9          6          0          0          0          0         14          1         39 |     6,633 
         other_rel_p |         3          0          4          0          0          3          0          0          0          0          0         10          0          0          0 |        20 
               norel |        64          0         65          0        889        459          0          2          0          0          0          1          0          0          0 |     1,480 
            dontknow |        65          0         75          0      1,374         23          8          4          0          0          0         37          0          0          0 |     1,586 
---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------
               Total |     2,488         46      2,544         56     12,062        726         26         22         17         13     10,243      7,133         26      1,554      1,746 |    38,702 

. 
. display "Now working on resolving relationships"
Now working on resolving relationships

.  foreach r in dad mom child spouse sibling grandparent grandchild greatgrandchild nephewniece norel otherrel {
  2.    display "Looking for `r'"
  3.    gen best_rel = .
  4.    
.    * Going through each identified relationship, starting with relationship1
.    * set bestrel to equal that relationship if it is not missing and it has a lower value
.    * in the set of relations in this set of `r' relationship types.
.    * For example, if the relationship is biodad and stepdad, set to biodad.
.    foreach v of varlist relationship* {
  5.      display "Processing `v'"
  6.      replace best_rel = `v' if ((!missing(`v')) & (`v' < best_rel) & inlist(`v', ``r'_rel_list'))
  7.      replace best_rel = 0 if ((!missing(`v')) & (!inlist(`v', ``r'_rel_list')))
  8.    }
  9.    replace relationship = best_rel if (missing(relationship) & (best_rel > 0))
 10.    drop best_rel
 11. }
Looking for dad
(886,230 missing values generated)
Processing relationship1
(147,168 real changes made)
(739,062 real changes made)
Processing relationship2
(62 real changes made)
(8,143 real changes made)
Processing relationship3
(0 real changes made)
(0 real changes made)
Processing relationship
(0 real changes made)
(0 real changes made)
(144 real changes made)
Looking for mom
(886,230 missing values generated)
Processing relationship1
(147,168 real changes made)
(739,062 real changes made)
Processing relationship2
(62 real changes made)
(8,143 real changes made)
Processing relationship3
(0 real changes made)
(0 real changes made)
Processing relationship
(0 real changes made)
(0 real changes made)
(0 real changes made)
Looking for child
(886,230 missing values generated)
Processing relationship1
(146,940 real changes made)
(739,290 real changes made)
Processing relationship2
(69 real changes made)
(8,143 real changes made)
Processing relationship3
(0 real changes made)
(0 real changes made)
Processing relationship
(0 real changes made)
(0 real changes made)
(44 real changes made)
Looking for spouse
(886,230 missing values generated)
Processing relationship1
(166,101 real changes made)
(720,129 real changes made)
Processing relationship2
(764 real changes made)
(8,909 real changes made)
Processing relationship3
(0 real changes made)
(5 real changes made)
Processing relationship
(0 real changes made)
(0 real changes made)
(1,614 real changes made)
Looking for sibling
(886,230 missing values generated)
Processing relationship1
(764,092 real changes made)
(122,138 real changes made)
Processing relationship2
(12,079 real changes made)
(5,690 real changes made)
Processing relationship3
(0 real changes made)
(0 real changes made)
Processing relationship
(0 real changes made)
(0 real changes made)
(26,830 real changes made)
Looking for grandparent
(886,230 missing values generated)
Processing relationship1
(148,357 real changes made)
(737,873 real changes made)
Processing relationship2
(2,521 real changes made)
(5,778 real changes made)
Processing relationship3
(0 real changes made)
(1 real change made)
Processing relationship
(0 real changes made)
(0 real changes made)
(4,865 real changes made)
Looking for grandchild
(886,230 missing values generated)
Processing relationship1
(148,422 real changes made)
(737,808 real changes made)
Processing relationship2
(2,463 real changes made)
(5,844 real changes made)
Processing relationship3
(0 real changes made)
(0 real changes made)
Processing relationship
(0 real changes made)
(0 real changes made)
(4,865 real changes made)
Looking for greatgrandchild
(886,230 missing values generated)
Processing relationship1
(121,210 real changes made)
(765,020 real changes made)
Processing relationship2
(47 real changes made)
(8,139 real changes made)
Processing relationship3
(0 real changes made)
(0 real changes made)
Processing relationship
(0 real changes made)
(0 real changes made)
(0 real changes made)
Looking for nephewniece
(886,230 missing values generated)
Processing relationship1
(127,017 real changes made)
(759,213 real changes made)
Processing relationship2
(47 real changes made)
(8,139 real changes made)
Processing relationship3
(0 real changes made)
(0 real changes made)
Processing relationship
(0 real changes made)
(0 real changes made)
(0 real changes made)
Looking for norel
(886,230 missing values generated)
Processing relationship1
(61,247 real changes made)
(824,983 real changes made)
Processing relationship2
(0 real changes made)
(3,066 real changes made)
Processing relationship3
(0 real changes made)
(0 real changes made)
Processing relationship
(0 real changes made)
(0 real changes made)
(0 real changes made)
Looking for otherrel
(886,230 missing values generated)
Processing relationship1
(120,783 real changes made)
(765,447 real changes made)
Processing relationship2
(47 real changes made)
(8,139 real changes made)
Processing relationship3
(0 real changes made)
(0 real changes made)
Processing relationship
(0 real changes made)
(0 real changes made)
(0 real changes made)

. 
. display "Where do we stand with relationships?"
Where do we stand with relationships?

. tab relationship, m

        relationship |      Freq.     Percent        Cum.
---------------------+-----------------------------------
          grandchild |     29,335        3.31        3.31
        grandchild_p |        599        0.07        3.38
         grandparent |     29,335        3.31        6.69
       grandparent_p |        599        0.07        6.76
             sibling |    583,580       65.85       72.61
             partner |      1,764        0.20       72.80
             f_child |      1,098        0.12       72.93
               child |      7,262        0.82       73.75
            f_parent |      1,326        0.15       73.90
              parent |      7,262        0.82       74.72
           auntuncle |      6,234        0.70       75.42
 auntuncle_or_parent |     17,793        2.01       77.43
     greatgrandchild |        427        0.05       77.48
    greatgrandparent |        427        0.05       77.52
         nephewniece |      6,234        0.70       78.23
child_or_nephewniece |     17,793        2.01       80.24
   sibling_or_cousin |     15,468        1.75       81.98
               f_sib |      3,931        0.44       82.42
           other_rel |     94,252       10.64       93.06
         other_rel_p |      2,990        0.34       93.40
               norel |     42,777        4.83       98.22
            dontknow |     15,404        1.74       99.96
                   . |        340        0.04      100.00
---------------------+-----------------------------------
               Total |    886,230      100.00

. 
. tab relationship1 relationship2 if missing(relationship)

                     |                                                2 relationship
      1 relationship | grandchil  grandpare  grandpare    sibling    partner      child     parent  auntuncle  child_or_      norel |     Total
---------------------+--------------------------------------------------------------------------------------------------------------+----------
          grandchild |         0          0          0          4          1          0          0          0          2         60 |        67 
        grandchild_p |         0          0          0          0          1          0          0          0          0          0 |         1 
         grandparent |         0          0          0          6          1          0          0          3          0         59 |        69 
             sibling |         4          2          0          0          2          1          3          7          4          0 |        23 
             partner |         1          1          1          0          0          3          2          0          0          1 |         9 
               child |         0          0          0          3          2          0          0          0          0          3 |         8 
              parent |         0          0          0          1          3          0          0          0          0          1 |         5 
 auntuncle_or_parent |         0          2          0          7          0          0          0          0          0          0 |         9 
child_or_nephewniece |         3          0          0         10          0          0          0          0          0          0 |        13 
           other_rel |         0          1          0          0          3          0          0          0          0          0 |         4 
               norel |        64         65          0          0          1          0          2          0          0          0 |       132 
---------------------+--------------------------------------------------------------------------------------------------------------+----------
               Total |        72         71          1         31         14          4          7         10          6        124 |       340 

. 
. drop relationship1 relationship2 relationship3 numrels_tc1

. 
. *Append base relationships file (iteration 0). No overlap because dropped matched cases earlier.
. append using "$tempdir/relationships_tc0_wide"
(label relationship already defined)

. 
. tab relationship, m

        relationship |      Freq.     Percent        Cum.
---------------------+-----------------------------------
            biochild |    661,315       21.45       21.45
              biomom |    387,136       12.56       34.01
              biodad |    274,179        8.89       42.91
           stepchild |     47,022        1.53       44.43
             stepmom |     16,676        0.54       44.97
             stepdad |     30,346        0.98       45.96
          adoptchild |     12,988        0.42       46.38
            adoptmom |      6,740        0.22       46.60
            adoptdad |      6,248        0.20       46.80
                 mom |          6        0.00       46.80
                 dad |          6        0.00       46.80
              spouse |    516,182       16.75       63.55
          grandchild |     60,516        1.96       65.51
        grandchild_p |        599        0.02       65.53
         grandparent |     60,516        1.96       67.49
       grandparent_p |        599        0.02       67.51
             sibling |    605,542       19.64       87.16
             partner |     48,960        1.59       88.75
             f_child |      2,621        0.09       88.83
               child |      7,274        0.24       89.07
            f_parent |      2,849        0.09       89.16
              parent |      7,262        0.24       89.40
           auntuncle |      6,234        0.20       89.60
 auntuncle_or_parent |     17,793        0.58       90.18
     greatgrandchild |        427        0.01       90.19
    greatgrandparent |        427        0.01       90.20
         nephewniece |      6,234        0.20       90.41
child_or_nephewniece |     17,793        0.58       90.98
   sibling_or_cousin |     15,468        0.50       91.48
               f_sib |      3,931        0.13       91.61
           other_rel |    144,258        4.68       96.29
         other_rel_p |      2,990        0.10       96.39
               norel |     95,159        3.09       99.48
            dontknow |     15,404        0.50       99.98
                   . |        754        0.02      100.00
---------------------+-----------------------------------
               Total |  3,082,454      100.00

. 
. save "$tempdir/relationship_pairs_bywave", $replace
(note: file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/relationship_pairs_bywave.dta not found)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/relationship_pairs_bywave.dta saved

. 
. ********************************************************************************
. *Note: File still has one observation per pair PER WAVE. 
. ********************************************************************************
. 
end of do-file

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. do "$childhh_base_code/do_and_log" "$sipp2008_code" "$sipp2008_logs" create_comp_change 

. * This file executes do files, but first executes
. * standard startup boilerplate and last executes
. * standard completion boilerplate.
. 
. * It takes three parameters, 
. *  1. the directory where the project code lives.
. *  2. the directory where log files should go.
. *  3. the basename of the do file.  
. *
. * "Basename" just means the name without the .do or .log on the end.
. * The basename is also used as the basename of the log file.
. 
. 
. 
. args codedir logdir fname

. 
. 
. do "$childhh_base_code/childhh_prolog" "`logdir'" "`fname'"

. * Boilerplate prolog for ChildHH project.
. * This should be executed at least once at the
. * beginning of running (sub)project code.
. 
. * It takes two parameters, the log directory and the basename of the log file.  
. * "Basename" just means the name without the .log on the end.
. 
. 
. args logdir fname

. 
. capture log close
