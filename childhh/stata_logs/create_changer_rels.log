-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_logs/create_changer_rels.log
  log type:  text
 opened on:   5 Dec 2019, 19:37:22

. 
. 
. * I would love to turn off line wrap so the state is a single
. * continuous string.  This seems not to be possible.  The best
. * we can do is set the line length to 255.  That's about 20 times
. * too short so why bother.
. *
. * Also, I considered saving the state as a note in the dataset
. * but this generic do file can't assume there is a dataset at all.
. display "Starting random number generator state"
Starting random number generator state

. display "`c(rngstate)'"
XAA0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 000000000000000000000000000000000000000000000000000000000000000000000001000001391839

. 
. 
. set varabbrev off

. 
. macro list
S_FNDATE:        5 Dec 2019 19:19
S_FN:           C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/leaver_rels.dta
ReS_Call:       version 15.1:
max_tc:         1
refmon:         4
adult_age:      18
penultimate_wave:
                14
second_wave:    2
final_wave:     15
first_wave:     1
replace:        replace
SIPP08keep:     C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/SIPP08_Processed
tempdir:        C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp
results:        C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//results
sipp2008_logs:  C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_logs
sipp2008_code:  C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//SIPP2008
childhh_base_code:
                C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh/
SIPP2008:       C:\Users\Joanna/Dropbox/Data/SIPP/SIPP2008
homedir:        C:\Users\Joanna
S_level:        95
F1:             help advice;
F2:             describe;
F7:             save
F8:             use
S_ADO:          BASE;SITE;.;PERSONAL;PLUS;OLDPLACE
S_StataMP:      MP
S_StataSE:      SE
S_FLAVOR:       Intercooled
S_OS:           Windows
S_OSDTL:        64-bit
S_MACH:         PC (64-bit x86-64)
_fname:         create_changer_rels
_logdir:        C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_logs
_2:             create_changer_rels
_1:             C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_logs
_0:             "C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_logs" "create_changer_rels"

. 
. pwd
C:\Users\Joanna\Dropbox\Repositories\SIPP_Breadwinning\childhh

. 
end of do-file

. 
. 
. do "`codedir'/`fname'"

. //==============================================================================
. //===== Children's Household Instability Project
. //===== Dataset: SIPP2008
. //===== Purpose:  Link individuals identified as entering, leaving, or staying in
. //===== a person's (ego's) household to their relationship to ego.
. //==============================================================================
. 
. use "$SIPP08keep/comp_change.dta", clear

. 
. keep ssuid epppnum shhadid* arrivers* leavers* stayers* comp_change* comp_change_reason* adj_age* 

. 
. reshape long shhadid adj_age arrivers leavers stayers comp_change comp_change_reason, i(ssuid epppnum) j(swave)
(note: j = 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15)
(note: arrivers15 not found)
(note: leavers15 not found)
(note: stayers15 not found)
(note: comp_change15 not found)
(note: comp_change_reason15 not found)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                   130851   -> 2.0e+06
Number of variables                 117   ->      25
j variable (15 values)                    ->   swave
xij variables:
        shhadid1 shhadid2 ... shhadid15   ->   shhadid
        adj_age1 adj_age2 ... adj_age15   ->   adj_age
     arrivers1 arrivers2 ... arrivers15   ->   arrivers
        leavers1 leavers2 ... leavers15   ->   leavers
        stayers1 stayers2 ... stayers15   ->   stayers
comp_change1 comp_change2 ... comp_change15->  comp_change
comp_change_reason1 comp_change_reason2 ... comp_change_reason15->comp_change_reason
-----------------------------------------------------------------------------

. 
. gen have_arrivers = (indexnot(arrivers, " ") != 0)

. gen have_leavers = (indexnot(leavers, " ") != 0)

. 
. gen have_changers = (have_arrivers | have_leavers)

. 
. tab comp_change have_changers

comp_chang |     have_changers
         e |         0          1 |     Total
-----------+----------------------+----------
         0 | 1,060,888          0 | 1,060,888 
         1 |         0    127,421 |   127,421 
-----------+----------------------+----------
     Total | 1,060,888    127,421 | 1,188,309 

. 
. assert (have_changers == 0) if (comp_change == 0)

. assert (have_changers == 0) if missing(comp_change)

. assert (have_changers == 1) if (comp_change == 1)

. 
. drop if missing(comp_change)
(774,456 observations deleted)

. 
. drop if (comp_change == 0)
(1,060,888 observations deleted)

. 
. save "$tempdir/comp_change_onlychangers", $replace
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/comp_change_onlychangers.dta saved

. 
. ********************************************************************************
. * Section: create long file where each record is a person who started or stopped
. *          living with ego (and stayed living with ego).
. ********************************************************************************
. 
. foreach changer in leaver arriver stayer {
  2.     clear
  3. 
.     use "$tempdir/comp_change_onlychangers"
  4. 
.     * Compute max number of leavers/arrivers.
.     gen n_`changer's = wordcount(`changer's)
  5.     egen max_`changer's = max(n_`changer's)
  6. 
.     forvalues my_`changer'_num = 1/`=max_`changer's' {
  7.         gen `changer'`my_`changer'_num' = word(`changer's, `my_`changer'_num')
  8.     }
  9.     drop `changer's max_`changer's
 10. 
.     keep ssuid epppnum shhadid swave adj_age comp_change_reason n_`changer's `changer'* 
 11. 
.     reshape long `changer', i(ssuid epppnum swave) j(`changer'_num)
 12. 
.     drop if missing(`changer')
 13. 
.     save "$tempdir/hh_`changer's", $replace
 14. }
(62,346 missing values generated)
(102,220 missing values generated)
(114,567 missing values generated)
(120,941 missing values generated)
(124,527 missing values generated)
(126,176 missing values generated)
(126,897 missing values generated)
(127,202 missing values generated)
(127,320 missing values generated)
(127,382 missing values generated)
(127,397 missing values generated)
(127,407 missing values generated)
(127,410 missing values generated)
(note: j = 1 2 3 4 5 6 7 8 9 10 11 12 13)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                   127421   -> 1.7e+06
Number of variables                  20   ->       9
j variable (13 values)                    ->   leaver_num
xij variables:
           leaver1 leaver2 ... leaver13   ->   leaver
-----------------------------------------------------------------------------
(1,541,792 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/hh_leavers.dta saved
(57,911 missing values generated)
(104,759 missing values generated)
(116,871 missing values generated)
(122,224 missing values generated)
(125,114 missing values generated)
(126,436 missing values generated)
(127,049 missing values generated)
(127,257 missing values generated)
(127,351 missing values generated)
(127,406 missing values generated)
(127,415 missing values generated)
(127,420 missing values generated)
(127,420 missing values generated)
(note: j = 1 2 3 4 5 6 7 8 9 10 11 12 13)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                   127421   -> 1.7e+06
Number of variables                  20   ->       9
j variable (13 values)                    ->   arriver_num
xij variables:
        arriver1 arriver2 ... arriver13   ->   arriver
-----------------------------------------------------------------------------
(1,544,633 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/hh_arrivers.dta saved
(43,180 missing values generated)
(57,331 missing values generated)
(75,849 missing values generated)
(94,659 missing values generated)
(109,427 missing values generated)
(118,412 missing values generated)
(123,056 missing values generated)
(125,233 missing values generated)
(126,313 missing values generated)
(126,943 missing values generated)
(127,143 missing values generated)
(127,297 missing values generated)
(127,369 missing values generated)
(note: j = 1 2 3 4 5 6 7 8 9 10 11 12 13)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                   127421   -> 1.7e+06
Number of variables                  20   ->       9
j variable (13 values)                    ->   stayer_num
xij variables:
           stayer1 stayer2 ... stayer13   ->   stayer
-----------------------------------------------------------------------------
(1,382,212 observations deleted)
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/hh_stayers.dta saved

. 
. ********************************************************************************
. * Section: Linking those who leave to relationships in that wave
. ********************************************************************************
. 
. use "$tempdir/hh_leavers", clear

. drop if missing(leaver)
(0 observations deleted)

. gen relfrom = real(epppnum)

. destring leaver, gen(relto)
leaver: all characters numeric; relto generated as int

. merge 1:1 ssuid relfrom relto swave using "$tempdir/relationship_pairs_bywave", keepusing(relationship)
(note: variable relto was int, now float to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                     2,968,011
        from master                       119  (_merge==1)
        from using                  2,967,892  (_merge==2)

    matched                           114,562  (_merge==3)
    -----------------------------------------

.         
. display "deleting relationships to self"
deleting relationships to self

. drop if relfrom==relto
(0 observations deleted)

. 
. replace relationship=40 if _merge==1
(119 real changes made)

. 
. drop if _merge == 2
(2,967,892 observations deleted)

. drop _merge

. 
. display "Relationships for leavers"
Relationships for leavers

. tab relationship, m sort

        relationship |      Freq.     Percent        Cum.
---------------------+-----------------------------------
           other_rel |     18,754       16.35       16.35
               norel |     16,463       14.36       30.71
             sibling |     15,067       13.14       43.85
            biochild |     13,211       11.52       55.37
              biomom |      7,286        6.35       61.72
              spouse |      6,375        5.56       67.28
              biodad |      5,935        5.18       72.45
         grandparent |      5,198        4.53       76.99
          grandchild |      5,189        4.52       81.51
           stepchild |      2,974        2.59       84.10
            dontknow |      2,643        2.30       86.41
             partner |      2,541        2.22       88.62
child_or_nephewniece |      1,915        1.67       90.29
 auntuncle_or_parent |      1,907        1.66       91.96
             stepdad |      1,844        1.61       93.57
   sibling_or_cousin |      1,148        1.00       94.57
             stepmom |      1,134        0.99       95.56
           auntuncle |        830        0.72       96.28
         nephewniece |        825        0.72       97.00
              parent |        615        0.54       97.53
               child |        613        0.53       98.07
         other_rel_p |        467        0.41       98.48
          adoptchild |        315        0.27       98.75
               f_sib |        277        0.24       98.99
            f_parent |        222        0.19       99.19
             f_child |        200        0.17       99.36
            adoptdad |        169        0.15       99.51
            adoptmom |        147        0.13       99.64
       grandparent_p |         99        0.09       99.72
        grandchild_p |         98        0.09       99.81
                   . |         84        0.07       99.88
    greatgrandparent |         68        0.06       99.94
     greatgrandchild |         67        0.06      100.00
                 mom |          1        0.00      100.00
---------------------+-----------------------------------
               Total |    114,681      100.00

. save "$tempdir/leaver_rels", $replace
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/leaver_rels.dta saved

. 
. ********************************************************************************
. * Section: Linking those who arrive to relationships
. *          We have to link in wave+n because they aren't with ego in the current 
. *          wave else they wouldn't be arrivers 
. ********************************************************************************
. 
. use "$tempdir/hh_arrivers", clear

. 
. * We link to relationship in next wave, since they aren't together in this wave
. replace swave=swave+1
(111,840 real changes made)

. drop if missing(arriver)
(0 observations deleted)

. gen relfrom = real(epppnum)

. destring arriver, gen(relto)
arriver: all characters numeric; relto generated as int

. merge 1:1 ssuid relfrom relto swave using "$tempdir/relationship_pairs_bywave", keepusing(relationship)
(note: variable relto was int, now float to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                     2,986,000
        from master                     7,693  (_merge==1)
        from using                  2,978,307  (_merge==2)

    matched                           104,147  (_merge==3)
    -----------------------------------------

. 
. * return swave to its original value. (Yiwen, this is the silly error I made 
. * that broke the code. I forgot to put swave back to its original value).       
. replace swave=swave-1
(3,090,147 real changes made)

. 
. display "deleting relationships to self"
deleting relationships to self

. drop if relfrom==relto
(0 observations deleted)

. 
. replace relationship=40 if _merge==1
(7,693 real changes made)

. 
. drop if _merge == 2
(2,978,307 observations deleted)

. drop _merge

. 
. display "Relationships for arrivers"
Relationships for arrivers

. tab relationship, m sort

        relationship |      Freq.     Percent        Cum.
---------------------+-----------------------------------
           other_rel |     15,714       14.05       14.05
               norel |     15,584       13.93       27.98
             sibling |     13,281       11.88       39.86
            dontknow |      9,896        8.85       48.71
            biochild |      9,381        8.39       57.10
              biomom |      8,642        7.73       64.82
              biodad |      6,610        5.91       70.73
         grandparent |      5,571        4.98       75.71
          grandchild |      4,488        4.01       79.73
              spouse |      3,999        3.58       83.30
             partner |      3,553        3.18       86.48
           stepchild |      2,678        2.39       88.87
 auntuncle_or_parent |      2,064        1.85       90.72
             stepdad |      1,742        1.56       92.28
child_or_nephewniece |      1,407        1.26       93.54
             stepmom |      1,142        1.02       94.56
   sibling_or_cousin |        941        0.84       95.40
              parent |        862        0.77       96.17
           auntuncle |        857        0.77       96.93
               child |        769        0.69       97.62
         nephewniece |        742        0.66       98.29
         other_rel_p |        432        0.39       98.67
               f_sib |        270        0.24       98.91
            f_parent |        228        0.20       99.12
          adoptchild |        205        0.18       99.30
             f_child |        192        0.17       99.47
            adoptdad |        110        0.10       99.57
            adoptmom |        102        0.09       99.66
       grandparent_p |         97        0.09       99.75
    greatgrandparent |         82        0.07       99.82
        grandchild_p |         78        0.07       99.89
                   . |         62        0.06       99.95
     greatgrandchild |         55        0.05      100.00
                 mom |          3        0.00      100.00
                 dad |          1        0.00      100.00
---------------------+-----------------------------------
               Total |    111,840      100.00

. save "$tempdir/arriver_rels", $replace
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/arriver_rels.dta saved

. 
. ********************************************************************************
. * Section: getting the age of each person so that we can calculate an age difference
. ********************************************************************************
. foreach changer in leaver arriver {
  2.         clear
  3.     display "Processing `changer's"
  4.         
.         use "$tempdir/`changer'_rels"
  5. 
.     rename adj_age from_age
  6. 
.         drop epppnum
  7.         
.         * get changer age *
.     gen epppnum = string(relto)
  8.     merge m:1 ssuid epppnum swave using "$tempdir/demo_long_all", keepusing(adj_age)
  9.     drop if (_merge == 2)
 10.     assert (_merge == 3) /* ASSERTION IS FALSE! */
 11.         
.     drop _merge
 12.     drop epppnum
 13.     rename adj_age to_age
 14.         
.         * bring back ego's person number
.         rename relfrom epppnum
 15.         
.         save "$tempdir/`changer'_rels_withage", $replace
 16. }    
Processing leavers

    Result                           # of obs.
    -----------------------------------------
    not matched                     2,070,244
        from master                   109,881  (_merge==1)
        from using                  1,960,363  (_merge==2)

    matched                             4,800  (_merge==3)
    -----------------------------------------
(1,960,363 observations deleted)
109,881 contradictions in 114,681 observations
assertion is false
r(9);

end of do-file
r(9);

end of do-file
r(9);

end of do-file

r(9);

. do "C:\Users\Joanna\AppData\Local\Temp\STD3f6c_000000.tmp"

. //==============================================================================//
. //===== Children's Household Instability Project
. //===== Dataset: SIPP2008
. //===== Purpose: Executes do files to create core datafiles:
. //===== 
. 
. //=========================================================================//
. //== Purpose: Preparation for running the program.
. //== 
. //== Note: This program requires the mdesc and confirmdir packages. If you do not have this, type ssc install mdesc/confirmdir before running.
. //=========================================================================//
. 
. ***************************************************************************
. ** Section: The following code attempts to make sure these packages are installed before allowing execution.
. ***************************************************************************
. capture findfile mdesc.ado

. if ("`r(fn)'" == "") {
.     display as error "It appears the mdesc package is not installed."
.     display as error "Try 'ssc install mdesc' to acquire it."
.     exit
. }

. 
. capture findfile confirmdir.ado

. if ("`r(fn)'" == "") {
.     display as error "It appears the confirmdir package is not installed."
.     display as error "Try 'ssc install confirmdir' to acquire it."
.     exit
. }

. 
. ***************************************************************************
. ** Section: Creates macros for wave, age, month, relationships
. ***************************************************************************
. do "$childhh_base_code/SIPP2008/project_macros" /* this do-file contains macros of wave, age, month, relationships */

. //================================================================================================//
. //===== Children's Household Instability Project                                               
. //===== Dataset: SIPP2008                                                                    
. //===== Purpose: Create macros of waves, age, month, relationships. 
. //===== Also, create program executed by multiple do files to reduce number of relationship categories.
. //================================================================================================//
. 
. global first_wave 1

. global final_wave 15

. global second_wave = ${first_wave} + 1

. global penultimate_wave = ${final_wave} - 1

. 
. global adult_age 18

. 
. global refmon 4

. 
. ** A global macro for the number of transitive closure passes we want to do.
. global max_tc 1

. 
. //==============================================================================//
. //== Function: Computes simplified relationships from the more complex ones
. //==
. //== Arguments Created: 
. //     input_rel - The name of the existing relationship variable.
. //     simplified_rel - The name of the variable to be created containing the intermediate simplification of relationships.
. //     ultra_simple_rel - The name of the variable to be created containing the most compact form of relationships.
. //
. //== Note: The program assumes that input_rel uses the value label "relationships".
. //==============================================================================//
. capture program drop simplify_relationships

. program define simplify_relationships
  1.     args input_rel simplified_rel ultra_simple_rel
  2.     * TODO:  It would be friendly to check that all three args are provided and to error out if not.
.     gen `simplified_rel' = .
  3.     label values `simplified_rel' relationship
  4.     replace `simplified_rel' = "CHILD":relationship if inlist(`input_rel', "BIOCHILD":relationship, "STEPCHILD":relationship, "ADOPTCHILD":relationship, "CHILDOFPARTNER":relationship, "CHILD":re
> lationship)
  5.     replace `simplified_rel' = "PARENT":relationship if inlist(`input_rel', "BIOMOM":relationship, "STEPMOM":relationship, "ADOPTMOM":relationship, "BIODAD":relationship, "STEPDAD":relationship,
>  "ADOPTDAD":relationship, "PARENT":relationship)
  6.     replace `simplified_rel' = "GRANDCHILD":relationship if inlist(`input_rel', "GRANDCHILD":relationship, "GREATGRANDCHILD":relationship)
  7.     replace `simplified_rel' = "GRANDPARENT":relationship if inlist(`input_rel', "GRANDPARENT":relationship, "GREATGRANDPARENT":relationship)
  8.     replace `simplified_rel' = "SIBLING":relationship if inlist(`input_rel', "SIBLING":relationship)
  9.     replace `simplified_rel' = "OTHER_REL":relationship if inlist(`input_rel', "OTHER_REL":relationship, "SPOUSE":relationship, "AUNTUNCLE_OR_PARENT":relationship, "AUNTUNCLE":relationship, "NEP
> HEWNIECE":relationship, "SIBLING_OR_COUSIN":relationship, "CHILD_OR_NEPHEWNIECE":relationship)
 10.     replace `simplified_rel' = "NOREL":relationship if inlist(`input_rel', "NOREL":relationship, "PARTNER":relationship)
 11. 
.         replace `simplified_rel' = "FOSTER":relationship if inlist(`input_rel', "F_CHILD":relationship, "F_PARENT":relationship, "F_SIB":relationship)
 12.     replace `simplified_rel' = "GRANDCHILD_P":relationship if inlist(`input_rel', "GRANDCHILD_P":relationship)
 13.     replace `simplified_rel' = "GRANDPARENT_P":relationship if inlist(`input_rel', "GRANDPARENT_P":relationship)
 14.     replace `simplified_rel' = "OTHER_REL_P":relationship if inlist(`input_rel', "OTHER_REL_P":relationship)
 15. 
.     replace `simplified_rel' = "DONTKNOW":relationship if inlist(`input_rel', "DONTKNOW":relationship)
 16. 
.     replace `simplified_rel' = "CONFUSED":relationship if inlist(`input_rel', "CONFUSED":relationship, .a, .m)
 17. 
.     gen `ultra_simple_rel' = .
 18.     label values `ultra_simple_rel' ultra_simple_rel
 19.     replace `ultra_simple_rel' = "CHILD":ultra_simple_rel if (`simplified_rel' == "CHILD":relationship)
 20.     replace `ultra_simple_rel' = "SIBLING":ultra_simple_rel if (`simplified_rel' == "SIBLING":relationship)
 21.     replace `ultra_simple_rel' = "GRANDCHILD":ultra_simple_rel if (`simplified_rel' == "GRANDCHILD":relationship)
 22.     replace `ultra_simple_rel' = "OTHER_CHILD":ultra_simple_rel if (missing(`ultra_simple_rel') & (to_age < $adult_age))
 23.     replace `ultra_simple_rel' = "OTHER_ADULT":ultra_simple_rel if (missing(`ultra_simple_rel'))
 24. end

. 
end of do-file

. 
. ***************************************************************************
. ** Section: Check to make sure the required directories exist.
. ***************************************************************************
. 
. if ("$sipp2008_code" == "") {
.     display as error "sipp2008_code macro not set."
.     display as error "This macro tells us where to find the project code."
.     exit
. }

. 
. if ("$sipp2008_logs" == "") {
.     display as error "sipp2008_logs macro not set."
.     display as error "This macro tells us where to put the log files."
.     exit
. }

. 
. confirmdir "$sipp2008_logs"

. if `r(confirmdir)' {
.     display as error "The sipp2008_logs macro specifies a directory that does not exist:  $sipp2008_logs"
.     exit
. }

. 
. confirmdir "$sipp2008_code"

. if `r(confirmdir)' {
.     display as error "The sipp2008_code macro specifies a directory that does not exist:  $sipp2008_code"
.     exit
. }

. 
. ********************************************************************************
. * Execute scripts to process data.
. ********************************************************************************
. ** Combines all the waves into a long file where every person-wave is a record. 
. do "$childhh_base_code/do_and_log" "$sipp2008_code" "$sipp2008_logs" merge_waves  

. * This file executes do files, but first executes
. * standard startup boilerplate and last executes
. * standard completion boilerplate.
. 
. * It takes three parameters, 
. *  1. the directory where the project code lives.
. *  2. the directory where log files should go.
. *  3. the basename of the do file.  
. *
. * "Basename" just means the name without the .do or .log on the end.
. * The basename is also used as the basename of the log file.
. 
. 
. 
. args codedir logdir fname

. 
. 
. do "$childhh_base_code/childhh_prolog" "`logdir'" "`fname'"

. * Boilerplate prolog for ChildHH project.
. * This should be executed at least once at the
. * beginning of running (sub)project code.
. 
. * It takes two parameters, the log directory and the basename of the log file.  
. * "Basename" just means the name without the .log on the end.
. 
. 
. args logdir fname

. 
. capture log close
