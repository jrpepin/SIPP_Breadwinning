-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_logs/normalize_ages.log
  log type:  text
 opened on:   5 Dec 2019, 19:55:06

. 
. 
. * I would love to turn off line wrap so the state is a single
. * continuous string.  This seems not to be possible.  The best
. * we can do is set the line length to 255.  That's about 20 times
. * too short so why bother.
. *
. * Also, I considered saving the state as a note in the dataset
. * but this generic do file can't assume there is a dataset at all.
. display "Starting random number generator state"
Starting random number generator state

. display "`c(rngstate)'"
XAA0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 000000000000000000000000000000000000000000000000000000000000000000000001000001391839

. 
. 
. set varabbrev off

. 
. macro list
S_FNDATE:        5 Dec 2019 19:55
S_FN:           C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/person_wide.dta
ReS_jv2:        1 2 3 4 5 6 7 8 9 10 11 12 13 14 15
ReS_Call:       version 15.1:
max_tc:         1
refmon:         4
adult_age:      18
penultimate_wave:
                14
second_wave:    2
final_wave:     15
first_wave:     1
replace:        replace
SIPP08keep:     C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/SIPP08_Processed
tempdir:        C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp
results:        C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//results
sipp2008_logs:  C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_logs
sipp2008_code:  C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//SIPP2008
childhh_base_code:
                C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh/
SIPP2008:       C:\Users\Joanna/Dropbox/Data/SIPP/SIPP2008
homedir:        C:\Users\Joanna
S_level:        95
F1:             help advice;
F2:             describe;
F7:             save
F8:             use
S_ADO:          BASE;SITE;.;PERSONAL;PLUS;OLDPLACE
S_StataMP:      MP
S_StataSE:      SE
S_FLAVOR:       Intercooled
S_OS:           Windows
S_OSDTL:        64-bit
S_MACH:         PC (64-bit x86-64)
_fname:         normalize_ages
_logdir:        C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_logs
_2:             normalize_ages
_1:             C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_logs
_0:             "C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_logs" "normalize_ages"

. 
. pwd
C:\Users\Joanna\Dropbox\Repositories\SIPP_Breadwinning\childhh

. 
end of do-file

. 
. 
. do "`codedir'/`fname'"

. //========================================================================================================================//
. //=================== Children's Household Instability Project                    ========================================//
. //=================== Dataset: SIPP2008                                           ========================================//
. //=================== Purpose: This file fixes up age so the waves are consistent ========================================//
. //========================================================================================================================//
. use "$tempdir/person_wide"

. 
. gen num_ages = 0

. forvalues wave = $first_wave/$final_wave {
  2.     replace num_ages = num_ages + 1 if (!missing(tage`wave'))
  3. }
(105,663 real changes made)
(98,504 real changes made)
(95,252 real changes made)
(91,219 real changes made)
(90,477 real changes made)
(88,164 real changes made)
(85,397 real changes made)
(84,400 real changes made)
(82,260 real changes made)
(79,321 real changes made)
(78,101 real changes made)
(77,287 real changes made)
(76,034 real changes made)
(74,918 real changes made)
(72,474 real changes made)

. 
. ******************************************************************************
. *Section: create expected age variables based on age at first observation and 
. *          aging the person one year every 3 observations or based on last observation
. *          and decrementing one year every 3 observations 
. ******************************************************************************
. 
. *** We make a simple projection of expected age from the first reported age
. * and from the last reported age.  
. gen expected_age_fwd = tage$first_wave
(25,188 missing values generated)

. gen expected_age_fwd$first_wave = expected_age_fwd
(25,188 missing values generated)

. 
. * a counter; after 3 observations at current age, increase by 1
. gen num_curr_age = 0

. replace num_curr_age = 1 if (!missing(expected_age_fwd))
(105,663 real changes made)

. 
. forvalues wave = $second_wave/$final_wave {
  2.     * Increment counter of age runs if we have established an age.
.     * Set the counter to 1 if we are just now establishing an age.
.     replace num_curr_age = num_curr_age + 1 if (!missing(expected_age_fwd))
  3.     replace num_curr_age = 1 if ((!missing(tage`wave')) & (missing(expected_age_fwd)))
  4.     replace expected_age_fwd = tage`wave' if ((!missing(tage`wave')) & (missing(expected_age_fwd)))
  5. 
.     * Increment the age if we've already used it three times. Reset counter.
.     replace expected_age_fwd = expected_age_fwd + 1 if (num_curr_age > 3)
  6.     replace num_curr_age = 1 if (num_curr_age > 3)
  7. 
.     gen expected_age_fwd`wave' = expected_age_fwd
  8. }
(105,663 real changes made)
(2,616 real changes made)
(2,616 real changes made)
(0 real changes made)
(0 real changes made)
(22,572 missing values generated)
(108,279 real changes made)
(2,542 real changes made)
(2,542 real changes made)
(0 real changes made)
(0 real changes made)
(20,030 missing values generated)
(110,821 real changes made)
(2,505 real changes made)
(2,505 real changes made)
(105,663 real changes made)
(105,663 real changes made)
(17,525 missing values generated)
(113,326 real changes made)
(2,264 real changes made)
(2,264 real changes made)
(2,616 real changes made)
(2,616 real changes made)
(15,261 missing values generated)
(115,590 real changes made)
(2,113 real changes made)
(2,113 real changes made)
(2,542 real changes made)
(2,542 real changes made)
(13,148 missing values generated)
(117,703 real changes made)
(1,878 real changes made)
(1,878 real changes made)
(108,168 real changes made)
(108,168 real changes made)
(11,270 missing values generated)
(119,581 real changes made)
(1,660 real changes made)
(1,660 real changes made)
(4,880 real changes made)
(4,880 real changes made)
(9,610 missing values generated)
(121,241 real changes made)
(1,673 real changes made)
(1,673 real changes made)
(4,655 real changes made)
(4,655 real changes made)
(7,937 missing values generated)
(122,914 real changes made)
(1,597 real changes made)
(1,597 real changes made)
(110,046 real changes made)
(110,046 real changes made)
(6,340 missing values generated)
(124,511 real changes made)
(1,368 real changes made)
(1,368 real changes made)
(6,540 real changes made)
(6,540 real changes made)
(4,972 missing values generated)
(125,879 real changes made)
(1,350 real changes made)
(1,350 real changes made)
(6,328 real changes made)
(6,328 real changes made)
(3,622 missing values generated)
(127,229 real changes made)
(1,532 real changes made)
(1,532 real changes made)
(111,643 real changes made)
(111,643 real changes made)
(2,090 missing values generated)
(128,761 real changes made)
(1,161 real changes made)
(1,161 real changes made)
(7,908 real changes made)
(7,908 real changes made)
(929 missing values generated)
(129,922 real changes made)
(929 real changes made)
(929 real changes made)
(7,678 real changes made)
(7,678 real changes made)

. drop num_curr_age expected_age_fwd

. 
. * backward projection.
. gen expected_age_bkwd = tage$final_wave
(58,377 missing values generated)

. gen expected_age_bkwd$final_wave = expected_age_bkwd
(58,377 missing values generated)

. 
. gen num_curr_age = 0

. replace num_curr_age = 1 if (!missing(expected_age_bkwd))
(72,474 real changes made)

. 
. forvalues wave = $penultimate_wave (-1) $first_wave {
  2.     * Increment counter of age runs if we have established an age.
.     * Set the counter to 1 if we are just now establishing an age.
.     replace num_curr_age = num_curr_age + 1 if (!missing(expected_age_bkwd))
  3.     replace num_curr_age = 1 if ((!missing(tage`wave')) & (missing(expected_age_bkwd)))
  4.     replace expected_age_bkwd = tage`wave' if ((!missing(tage`wave')) & (missing(expected_age_bkwd)))
  5. 
.     * Decrement the age if we've already used it three times.
.     replace expected_age_bkwd = expected_age_bkwd - 1 if (num_curr_age > 3)
  6.     replace num_curr_age = 1 if (num_curr_age > 3)
  7. 
.     gen expected_age_bkwd`wave' = expected_age_bkwd
  8. }
(72,474 real changes made)
(5,880 real changes made)
(5,880 real changes made)
(0 real changes made)
(0 real changes made)
(52,497 missing values generated)
(78,354 real changes made)
(4,743 real changes made)
(4,743 real changes made)
(0 real changes made)
(0 real changes made)
(47,754 missing values generated)
(83,097 real changes made)
(5,375 real changes made)
(5,375 real changes made)
(72,474 real changes made)
(72,474 real changes made)
(42,379 missing values generated)
(88,472 real changes made)
(4,181 real changes made)
(4,181 real changes made)
(5,880 real changes made)
(5,880 real changes made)
(38,198 missing values generated)
(92,653 real changes made)
(3,937 real changes made)
(3,937 real changes made)
(4,743 real changes made)
(4,743 real changes made)
(34,261 missing values generated)
(96,590 real changes made)
(4,163 real changes made)
(4,163 real changes made)
(77,849 real changes made)
(77,849 real changes made)
(30,098 missing values generated)
(100,753 real changes made)
(3,934 real changes made)
(3,934 real changes made)
(10,061 real changes made)
(10,061 real changes made)
(26,164 missing values generated)
(104,687 real changes made)
(3,886 real changes made)
(3,886 real changes made)
(8,680 real changes made)
(8,680 real changes made)
(22,278 missing values generated)
(108,573 real changes made)
(3,964 real changes made)
(3,964 real changes made)
(82,012 real changes made)
(82,012 real changes made)
(18,314 missing values generated)
(112,537 real changes made)
(3,816 real changes made)
(3,816 real changes made)
(13,995 real changes made)
(13,995 real changes made)
(14,498 missing values generated)
(116,353 real changes made)
(3,462 real changes made)
(3,462 real changes made)
(12,566 real changes made)
(12,566 real changes made)
(11,036 missing values generated)
(119,815 real changes made)
(3,708 real changes made)
(3,708 real changes made)
(85,976 real changes made)
(85,976 real changes made)
(7,328 missing values generated)
(123,523 real changes made)
(3,572 real changes made)
(3,572 real changes made)
(17,811 real changes made)
(17,811 real changes made)
(3,756 missing values generated)
(127,095 real changes made)
(3,756 real changes made)
(3,756 real changes made)
(16,028 real changes made)
(16,028 real changes made)

. drop num_curr_age expected_age_bkwd

. 
. ********************************************************************************
. * Section: Check backwards and forwards projections against what is coded
. ********************************************************************************
. 
. *** Count the number of times age matches each projection (within one, in the correct direction).
. gen num_fwd_matches = 0

. gen num_bkwd_matches = 0

. forvalues wave = $first_wave/$final_wave {
  2.     gen fwd_match`wave' = ((!missing(tage`wave')) & (tage`wave' >= expected_age_fwd`wave') & (tage`wave' <= expected_age_fwd`wave' + 1))
  3.     replace num_fwd_matches = num_fwd_matches + 1 if (fwd_match`wave' == 1)
  4.     gen bkwd_match`wave' = ((!missing(tage`wave')) & (tage`wave' <= expected_age_bkwd`wave') & (tage`wave' >= expected_age_bkwd`wave' - 1))
  5.     replace num_bkwd_matches = num_bkwd_matches + 1 if (bkwd_match`wave' == 1)
  6. }
(105,663 real changes made)
(102,780 real changes made)
(97,314 real changes made)
(96,320 real changes made)
(93,506 real changes made)
(93,540 real changes made)
(88,641 real changes made)
(89,786 real changes made)
(88,351 real changes made)
(89,210 real changes made)
(85,975 real changes made)
(86,922 real changes made)
(82,660 real changes made)
(84,259 real changes made)
(82,135 real changes made)
(83,345 real changes made)
(79,927 real changes made)
(81,296 real changes made)
(76,659 real changes made)
(78,474 real changes made)
(75,851 real changes made)
(77,372 real changes made)
(74,953 real changes made)
(76,523 real changes made)
(73,362 real changes made)
(75,557 real changes made)
(72,670 real changes made)
(74,591 real changes made)
(70,198 real changes made)
(72,474 real changes made)

. 
. *check against number of observed waves to create problem flag 
. gen num_fwd_problem=num_ages-num_fwd_matches

. gen num_bkwd_problem=num_ages-num_bkwd_matches

. 
. gen anyproblem=0

. replace anyproblem=1 if num_fwd_problem > 0 | num_bkwd_problem > 0
(6,713 real changes made)

. 
. tab anyproblem

 anyproblem |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    124,138       94.87       94.87
          1 |      6,713        5.13      100.00
------------+-----------------------------------
      Total |    130,851      100.00

. 
. ********************************************************************************
. * Section: adjust age to projection if backwards and forwards projection are within 1
. ********************************************************************************
. 
. gen adj_age$first_wave = tage$first_wave
(25,188 missing values generated)

. forvalues wave = $second_wave/$final_wave {
  2. 
. * fix age when it is out of line with backwards and forwards projections
.     gen adj_age`wave' = tage`wave'
  3.     replace adj_age`wave' = expected_age_fwd`wave' if ((!missing(tage`wave')) & (fwd_match`wave' == 0) & (bkwd_match`wave' == 0) & (abs(expected_age_fwd`wave' - expected_age_bkwd`wave') <= 1))
  4.         
. * fix age when it is missing. Take forward projection first. If no forward projection, then take backward projection.   
.         replace adj_age`wave'= expected_age_fwd`wave' if missing(adj_age`wave') & !missing(expected_age_fwd`wave')
  5.         replace adj_age`wave'=expected_age_bkwd`wave' if missing(adj_age`wave') & !missing(expected_age_bkwd`wave')
  6. }
(32,347 missing values generated)
(186 real changes made)
(9,775 real changes made)
(22,572 real changes made)
(35,599 missing values generated)
(194 real changes made)
(15,569 real changes made)
(20,030 real changes made)
(39,632 missing values generated)
(268 real changes made)
(22,107 real changes made)
(17,525 real changes made)
(40,374 missing values generated)
(149 real changes made)
(25,113 real changes made)
(15,261 real changes made)
(42,687 missing values generated)
(141 real changes made)
(29,539 real changes made)
(13,148 real changes made)
(45,454 missing values generated)
(195 real changes made)
(34,184 real changes made)
(11,270 real changes made)
(46,451 missing values generated)
(134 real changes made)
(36,841 real changes made)
(9,610 real changes made)
(48,591 missing values generated)
(110 real changes made)
(40,654 real changes made)
(7,937 real changes made)
(51,530 missing values generated)
(139 real changes made)
(45,190 real changes made)
(6,340 real changes made)
(52,750 missing values generated)
(94 real changes made)
(47,778 real changes made)
(4,972 real changes made)
(53,564 missing values generated)
(90 real changes made)
(49,942 real changes made)
(3,622 real changes made)
(54,817 missing values generated)
(107 real changes made)
(52,727 real changes made)
(2,090 real changes made)
(55,933 missing values generated)
(47 real changes made)
(55,004 real changes made)
(929 real changes made)
(58,377 missing values generated)
(0 real changes made)
(58,377 real changes made)
(0 real changes made)

. 
. * The plan will be to replace adjusted ages when adj_age is missing and expected_age_fwd/expected_age_bkwd are not.
. 
. ********************************************************************************
. * Section: Check backwards and forwards projections against adjusted age
. ********************************************************************************
. gen num_adjfwd_matches = 0

. gen num_adjbkwd_matches = 0

. forvalues wave = $first_wave/$final_wave {
  2.     gen adjfwd_match`wave' = ((!missing(adj_age`wave')) & (adj_age`wave' >= expected_age_fwd`wave') & (adj_age`wave' <= expected_age_fwd`wave' + 1))
  3.     replace num_adjfwd_matches = num_adjfwd_matches + 1 if (adjfwd_match`wave' == 1)
  4.     gen adjbkwd_match`wave' = ((!missing(adj_age`wave')) & (adj_age`wave' <= expected_age_bkwd`wave') & (adj_age`wave' >= expected_age_bkwd`wave' - 1))
  5.     replace num_adjbkwd_matches = num_adjbkwd_matches + 1 if (adjbkwd_match`wave' == 1)
  6. }
(105,663 real changes made)
(102,780 real changes made)
(107,275 real changes made)
(124,735 real changes made)
(109,269 real changes made)
(121,046 real changes made)
(111,016 real changes made)
(118,082 real changes made)
(113,613 real changes made)
(114,745 real changes made)
(115,655 real changes made)
(110,262 real changes made)
(117,039 real changes made)
(107,025 real changes made)
(119,110 real changes made)
(103,307 real changes made)
(120,691 real changes made)
(98,919 real changes made)
(121,988 real changes made)
(95,335 real changes made)
(123,723 real changes made)
(91,620 real changes made)
(124,985 real changes made)
(87,153 real changes made)
(126,196 real changes made)
(82,462 real changes made)
(127,721 real changes made)
(77,970 real changes made)
(128,575 real changes made)
(72,474 real changes made)

. 
. gen num_adjfwd_problem=num_ages-num_adjfwd_matches

. gen num_adjbkwd_problem=num_ages-num_adjbkwd_matches

. 
. gen any_adj_problem=0

. replace any_adj_problem=1 if num_adjfwd_problem > 0 | num_adjbkwd_problem > 0
(4,770 real changes made)

. 
. *******************************************************************************
. * Section: create flags for data that remain problematic. 
. *******************************************************************************
. 
. gen monotonic = 1 /* dpes age always increase? */

. gen ageproblem=0 /* are there deviations in age from one observation to the next greater than 5 */

. gen childageproblem=0

. gen curr_age = adj_age$first_wave
(25,188 missing values generated)

. forvalues wave = $second_wave/$final_wave {
  2.     replace monotonic = 0 if ((!missing(adj_age`wave')) & (!missing(curr_age)) & (adj_age`wave' < curr_age))
  3.         replace ageproblem=1 if ((!missing(adj_age`wave')) & (!missing(curr_age)) & (abs(adj_age`wave'-curr_age) > 5))
  4.         replace childageproblem=1 if ((!missing(adj_age`wave')) & (!missing(curr_age)) & (abs(adj_age`wave'-curr_age) > 5)) & (curr_age < 18)
  5.     replace curr_age = adj_age`wave' if (!missing(adj_age`wave'))
  6. }
(534 real changes made)
(261 real changes made)
(38 real changes made)
(57,457 real changes made)
(3,627 real changes made)
(361 real changes made)
(57 real changes made)
(39,221 real changes made)
(757 real changes made)
(181 real changes made)
(40 real changes made)
(59,783 real changes made)
(662 real changes made)
(129 real changes made)
(35 real changes made)
(34,547 real changes made)
(2,799 real changes made)
(104 real changes made)
(22 real changes made)
(36,434 real changes made)
(490 real changes made)
(108 real changes made)
(32 real changes made)
(65,193 real changes made)
(476 real changes made)
(74 real changes made)
(43 real changes made)
(32,955 real changes made)
(2,165 real changes made)
(64 real changes made)
(21 real changes made)
(34,236 real changes made)
(334 real changes made)
(68 real changes made)
(23 real changes made)
(68,465 real changes made)
(426 real changes made)
(54 real changes made)
(24 real changes made)
(31,221 real changes made)
(1,762 real changes made)
(91 real changes made)
(29 real changes made)
(32,889 real changes made)
(305 real changes made)
(55 real changes made)
(34 real changes made)
(70,866 real changes made)
(352 real changes made)
(48 real changes made)
(23 real changes made)
(30,803 real changes made)
(1,140 real changes made)
(19 real changes made)
(19 real changes made)
(30,315 real changes made)

. 
. tab ageproblem anyproblem

           |      anyproblem
ageproblem |         0          1 |     Total
-----------+----------------------+----------
         0 |   124,138      5,096 |   129,234 
         1 |         0      1,617 |     1,617 
-----------+----------------------+----------
     Total |   124,138      6,713 |   130,851 

. tab childageproblem

childagepro |
       blem |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    130,411       99.66       99.66
          1 |        440        0.34      100.00
------------+-----------------------------------
      Total |    130,851      100.00

. 
. tab ageproblem any_adj_problem

           |    any_adj_problem
ageproblem |         0          1 |     Total
-----------+----------------------+----------
         0 |   125,872      3,362 |   129,234 
         1 |       209      1,408 |     1,617 
-----------+----------------------+----------
     Total |   126,081      4,770 |   130,851 

. 
. drop curr_age

. drop expected_age_bkwd* expected_age_fwd*

. drop adjbkwd* adjfwd*

. drop bkwd* fwd*

. drop monotonic

. drop num_adjbkwd_matches num_adjfwd_matches 

. drop anyproblem

. drop any_adj_problem

. drop tage*

. 
. 
. * Create dummies for whether in this interview to be able to create an indicator for whether in interview next wave
. forvalues w=1/$final_wave {
  2.   gen in`w'=0
  3.   replace in`w'=1 if !missing(errp`w')
  4.   }
(105,663 real changes made)
(98,504 real changes made)
(95,252 real changes made)
(91,219 real changes made)
(90,477 real changes made)
(88,164 real changes made)
(85,397 real changes made)
(84,400 real changes made)
(82,260 real changes made)
(79,321 real changes made)
(78,101 real changes made)
(77,287 real changes made)
(76,034 real changes made)
(74,918 real changes made)
(72,474 real changes made)

.   
. forvalues w=1/$penultimate_wave {
  2.   local x=`w'+1
  3.   gen innext`w'=0
  4.   replace innext`w'=1 if in`x'==1
  5.  }
(98,504 real changes made)
(95,252 real changes made)
(91,219 real changes made)
(90,477 real changes made)
(88,164 real changes made)
(85,397 real changes made)
(84,400 real changes made)
(82,260 real changes made)
(79,321 real changes made)
(78,101 real changes made)
(77,287 real changes made)
(76,034 real changes made)
(74,918 real changes made)
(72,474 real changes made)

. 
. save "$tempdir/person_wide_adjusted_ages", $replace
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/person_wide_adjusted_ages.dta saved

. 
. keep ssuid epppnum ems* errp* wpfinwgt* eorigin* ebornus* etypmom* etypdad* my_race my_racealt my_sex mom_educ* dad_educ* mom_immigrant* dad_immigrant* adj_age* mom_age* biomom_age* biomom_educ* da
> d_age* biodad_age* innext* ref_person* ref_person_sex* ref_person_educ* biomom_ed_first mom_ed_first dad_ed_first par_ed_first mom_measure

. 
. save "$tempdir/demo_wide.dta", $replace
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/demo_wide.dta saved

. 
. reshape long adj_age ems errp wpfinwgt eorigin ebornus etypmom etypdad mom_educ dad_educ mom_immigrant dad_immigrant mom_age biomom_age biomom_educ dad_age biodad_age innext ref_person ref_person_s
> ex ref_person_educ, i(ssuid epppnum) j(swave)
(note: j = 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15)
(note: innext15 not found)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                   130851   -> 2.0e+06
Number of variables                 324   ->      32
j variable (15 values)                    ->   swave
xij variables:
        adj_age1 adj_age2 ... adj_age15   ->   adj_age
                    ems1 ems2 ... ems15   ->   ems
                 errp1 errp2 ... errp15   ->   errp
     wpfinwgt1 wpfinwgt2 ... wpfinwgt15   ->   wpfinwgt
        eorigin1 eorigin2 ... eorigin15   ->   eorigin
        ebornus1 ebornus2 ... ebornus15   ->   ebornus
        etypmom1 etypmom2 ... etypmom15   ->   etypmom
        etypdad1 etypdad2 ... etypdad15   ->   etypdad
     mom_educ1 mom_educ2 ... mom_educ15   ->   mom_educ
     dad_educ1 dad_educ2 ... dad_educ15   ->   dad_educ
mom_immigrant1 mom_immigrant2 ... mom_immigrant15->mom_immigrant
dad_immigrant1 dad_immigrant2 ... dad_immigrant15->dad_immigrant
        mom_age1 mom_age2 ... mom_age15   ->   mom_age
biomom_age1 biomom_age2 ... biomom_age15  ->   biomom_age
biomom_educ1 biomom_educ2 ... biomom_educ15->  biomom_educ
        dad_age1 dad_age2 ... dad_age15   ->   dad_age
biodad_age1 biodad_age2 ... biodad_age15  ->   biodad_age
           innext1 innext2 ... innext15   ->   innext
ref_person1 ref_person2 ... ref_person15  ->   ref_person
ref_person_sex1 ref_person_sex2 ... ref_person_sex15->ref_person_sex
ref_person_educ1 ref_person_educ2 ... ref_person_educ15->ref_person_educ
-----------------------------------------------------------------------------

. 
. label variable adj_age "Adjusted Age"

. label variable innext "Is this person interviewed in next wave?"

. 
. * now includes all observations, even when missing interview. errp is missing when no interview.
. tab errp,m 

        PE: Household relationship |      Freq.     Percent        Cum.
-----------------------------------+-----------------------------------
     Reference person with related |    340,052       17.33       17.33
  Reference Person without related |    166,826        8.50       25.82
        Spouse of reference person |    251,028       12.79       38.61
         Child of reference person |    391,373       19.94       58.55
    Grandchild of reference person |     31,181        1.59       60.14
        Parent of reference person |     11,590        0.59       60.73
Brother/sister of reference person |     10,981        0.56       61.29
Other relative of reference person |     25,128        1.28       62.57
  Foster child of reference person |      1,523        0.08       62.65
    Unmarried partner of reference |     23,598        1.20       63.85
                Housemate/roommate |     10,989        0.56       64.41
                    Roomer/boarder |      3,286        0.17       64.58
   Other non-relative of reference |     11,916        0.61       65.19
                                 . |    683,294       34.81      100.00
-----------------------------------+-----------------------------------
                             Total |  1,962,765      100.00

. 
. * most important for linking to arrivers who have missing data 
. save "$tempdir/demo_long_all", $replace
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/demo_long_all.dta saved

. 
. drop if missing(errp)
(683,294 observations deleted)

. 
. save "$tempdir/demo_long_interviews", $replace
file C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_data/stata_tmp/demo_long_interviews.dta saved

. 
end of do-file

. 
. 
. do "$childhh_base_code/childhh_epilog" "`logdir'" "`fname'"

. * Boilerplate epilog for ChildHH project.
. 
. display "Ending random number generator state"
Ending random number generator state

. display "`c(rngstate)'"
XAA0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> 000000000000000000000000000000000000000000000000000000000000000000000001000001391839

. log close
      name:  <unnamed>
       log:  C:\Users\Joanna/Dropbox/Repositories/SIPP_Breadwinning/childhh//stata_logs/normalize_ages.log
  log type:  text
 closed on:   5 Dec 2019, 19:55:53
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
